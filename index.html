<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BabyHouse</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #07080f;
      --surface:   #10121e;
      --surface2:  #181b2e;
      --border:    #252840;
      --text:      #eef0ff;
      --muted:     #7b82a8;
      --proj-a: #a855f7;
      --proj-b: #ec4899;
      --qdr-a:  #06b6d4;
      --qdr-b:  #84cc16;
      --radius: 12px;
      --card-radius: 10px;
      --header-bg:  rgba(16,18,30,.85);
      --tabbar-bg:  rgba(16,18,30,.7);
      --bg-glow-a:  rgba(168,85,247,.12);
      --bg-glow-b:  rgba(6,182,212,.10);
      --bg-glow-c:  rgba(236,72,153,.08);
      --warn-a: #ef4444;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg); color: var(--text);
      height: 100vh; display: flex; flex-direction: column;
      overflow: hidden; position: relative;
    }
    body::before {
      content: ''; position: fixed; inset: 0;
      background:
        radial-gradient(ellipse 60% 50% at 20% 20%, var(--bg-glow-a) 0%, transparent 70%),
        radial-gradient(ellipse 60% 50% at 80% 80%, var(--bg-glow-b) 0%, transparent 70%),
        radial-gradient(ellipse 40% 40% at 50% 0%,  var(--bg-glow-c) 0%, transparent 60%);
      pointer-events: none; z-index: 0;
    }

    /* ── Header ── */
    header {
      position: relative; z-index: 10;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 32px; height: 58px; flex-shrink: 0;
      background: var(--header-bg); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }
    header::after {
      content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg,
        transparent 0%, var(--proj-a) 25%, var(--proj-b) 45%,
        var(--qdr-a) 55%, var(--qdr-b) 75%, transparent 100%);
      opacity: .7;
    }
    header h1 {
      font-size: 1.35rem; font-weight: 800; letter-spacing: 1px;
      background: linear-gradient(90deg, var(--proj-a), var(--proj-b), var(--qdr-a), var(--qdr-b));
      background-size: 300% 100%;
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      animation: shimmer 4s linear infinite;
    }
    @keyframes shimmer { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
    .header-right { display: flex; align-items: center; gap: 18px; }
    .header-stats { display: flex; gap: 10px; }
    .hstat { font-size: .72rem; font-weight: 600; padding: 3px 10px; border-radius: 20px; letter-spacing: .4px; }
    .hstat-proj { background: rgba(168,85,247,.18); color: var(--proj-a); border: 1px solid rgba(168,85,247,.35); }
    .hstat-qdr  { background: rgba(6,182,212,.15);  color: var(--qdr-a);  border: 1px solid rgba(6,182,212,.3);   }
    .hstat-task { background: rgba(132,204,22,.1);  color: #bef264;       border: 1px solid rgba(132,204,22,.28); }
    header .date { font-size: .75rem; color: var(--muted); }
    #sync-status { font-size: .65rem; color: var(--muted); font-weight: 600; letter-spacing: .3px; }

    /* ── Board ── */
    .board { display: grid; grid-template-columns: 1fr 1fr; flex: 1; overflow: hidden; position: relative; z-index: 1; min-height: 0; }
    .panel { display: flex; flex-direction: column; overflow: hidden; min-height: 0; }
    .panel--proj { border-right: 1px solid var(--border); }

    .panel-stripe { height: 3px; flex-shrink: 0; }
    .panel--proj .panel-stripe { background: linear-gradient(90deg, var(--proj-a), var(--proj-b)); box-shadow: 0 0 16px rgba(168,85,247,.5); }
    .panel--qdr  .panel-stripe { background: linear-gradient(90deg, var(--qdr-a),  var(--qdr-b));  box-shadow: 0 0 16px rgba(6,182,212,.45); }

    .panel-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 22px 10px; flex-shrink: 0; }
    .panel-title { display: flex; align-items: center; gap: 10px; font-size: .95rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; }
    .panel--proj .panel-title { background: linear-gradient(90deg, var(--proj-a), var(--proj-b)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .panel--qdr  .panel-title { background: linear-gradient(90deg, var(--qdr-a),  var(--qdr-b));  -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .panel-icon { font-size: 1.1rem; filter: drop-shadow(0 0 6px currentColor); }

    .count-badge { font-size: .7rem; font-weight: 700; padding: 2px 9px; border-radius: 20px; letter-spacing: 0; text-transform: none; }
    .panel--proj .count-badge { background: rgba(168,85,247,.2); color: var(--proj-a); border: 1px solid rgba(168,85,247,.4); }
    .panel--qdr  .count-badge { background: rgba(6,182,212,.15); color: var(--qdr-a);  border: 1px solid rgba(6,182,212,.35); }

    .btn-add {
      font-size: .78rem; font-weight: 700; padding: 7px 16px;
      border-radius: 20px; border: none; cursor: pointer; letter-spacing: .3px; color: #fff;
      transition: transform .12s, filter .12s;
    }
    .btn-add:hover { transform: translateY(-1px); filter: brightness(1.15); }
    .btn-add:active { transform: translateY(0); }
    .panel--proj .btn-add { background: linear-gradient(135deg, var(--proj-a), var(--proj-b)); box-shadow: 0 4px 14px rgba(168,85,247,.45); }
    .panel--qdr  .btn-add { background: linear-gradient(135deg, var(--qdr-a),  var(--qdr-b));  box-shadow: 0 4px 14px rgba(6,182,212,.4);  color: #031214; }

    /* ── Card list ── */
    .card-list { flex: 1; overflow-y: auto; padding: 2px 18px 18px; display: flex; flex-direction: column; gap: 10px; }
    .card-list::-webkit-scrollbar { width: 4px; }
    .card-list::-webkit-scrollbar-track { background: transparent; }
    .panel--proj .card-list::-webkit-scrollbar-thumb { background: linear-gradient(var(--proj-a), var(--proj-b)); border-radius: 4px; }
    .panel--qdr  .card-list::-webkit-scrollbar-thumb { background: linear-gradient(var(--qdr-a),  var(--qdr-b));  border-radius: 4px; }

    .empty-state { text-align: center; color: var(--muted); font-size: .83rem; padding: 44px 24px; border: 1.5px dashed var(--border); border-radius: var(--card-radius); line-height: 1.7; }

    /* ── Card ── */
    .card {
      border-radius: var(--card-radius); padding: 13px 14px 11px 16px;
      position: relative; border: 1px solid var(--border); overflow: hidden;
      transition: transform .13s, box-shadow .13s, border-color .13s;
      display: flex; flex-direction: column; gap: 0;
      flex-shrink: 0;
    }
    .card-top { display: flex; gap: 8px; align-items: flex-start; }
    .card-body { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 5px; }
    .card-actions { flex-shrink: 0; display: flex; flex-direction: column; gap: 3px; align-items: flex-end; }

    .card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; border-radius: 10px 0 0 10px; }
    .panel--proj .card::before { background: linear-gradient(180deg, var(--proj-a), var(--proj-b)); }
    .panel--qdr  .card::before { background: linear-gradient(180deg, var(--qdr-a),  var(--qdr-b));  }

    .card:hover { transform: translateX(3px); }
    @keyframes cardPulse { 0%,100%{box-shadow:none} 30%,70%{box-shadow:-4px 0 0 3px var(--qdr-a),0 0 28px color-mix(in srgb,var(--qdr-a) 45%,transparent)} }
    .card--found { animation: cardPulse 1.1s ease 2; }
    .panel--proj .card:hover { box-shadow: -4px 0 20px rgba(168,85,247,.25), 0 4px 20px rgba(168,85,247,.1); border-color: rgba(168,85,247,.4); }
    .panel--qdr  .card:hover { box-shadow: -4px 0 20px rgba(6,182,212,.2),   0 4px 20px rgba(6,182,212,.08);  border-color: rgba(6,182,212,.35); }

    .panel--proj .card { background: linear-gradient(135deg, rgba(168,85,247,.05) 0%, var(--surface) 40%); }
    .panel--qdr  .card { background: linear-gradient(135deg, rgba(6,182,212,.04) 0%, var(--surface) 40%); }

    /* Priority QDR card */
    .panel--qdr .card.card--priority {
      border-color: rgba(251,191,36,.55);
      background: linear-gradient(135deg, rgba(251,191,36,.08) 0%, var(--surface) 45%);
    }
    .panel--qdr .card.card--priority::before { background: linear-gradient(180deg, #f59e0b, #fbbf24); }
    .panel--qdr .card.card--priority:hover {
      box-shadow: -4px 0 22px rgba(251,191,36,.32), 0 4px 20px rgba(251,191,36,.16);
      border-color: rgba(251,191,36,.75);
    }

    /* Completed card */
    .card--done { opacity: .5; border-color: var(--border) !important; background: var(--surface) !important; transition: opacity .2s; }
    .card--done::before { background: var(--muted) !important; opacity: .3; }
    .card--done .card-title { text-decoration: line-through; color: var(--muted); }
    .card--done:hover { transform: none !important; box-shadow: none !important; opacity: .72; }

    /* Complete button */
    .btn-complete {
      font-size: .62rem; font-weight: 700; padding: 3px 8px;
      border-radius: 20px; border: 1px solid var(--border);
      background: transparent; color: var(--muted);
      cursor: pointer; letter-spacing: .2px; white-space: nowrap;
      transition: color .13s, border-color .13s, background .13s, box-shadow .13s;
    }
    .btn-complete:hover { color: #4ade80; border-color: rgba(74,222,128,.5); }
    .btn-complete.is-done { background: linear-gradient(135deg, #15803d, #4ade80); color: #052e16; border-color: transparent; box-shadow: 0 2px 8px rgba(74,222,128,.4); }
    .btn-complete.is-done:hover { filter: brightness(1.1); }

    /* Infinite scroll sentinel */
    .load-sentinel { display: flex; justify-content: center; padding: 14px 0 6px; }
    .load-more-dots { font-size: .9rem; color: var(--muted); letter-spacing: 4px; animation: blink-dots 1.3s ease-in-out infinite; }
    @keyframes blink-dots { 0%,100%{opacity:.2;} 50%{opacity:.9;} }

    /* ── Todo display modes ──────────────────────────────── */
    /* always: body is always visible */
    body.tdm-always .todo-body    { display: flex !important; }
    body.tdm-always .todo-chevron { transform: rotate(180deg) !important; }
    body.tdm-always .todo-header  { cursor: default; }
    /* hover: body appears on hover */
    body.tdm-hover .todo-header               { cursor: pointer; }
    body.tdm-hover .card:hover .todo-body    { display: flex; }
    body.tdm-hover .card:hover .todo-chevron { transform: rotate(180deg); }
    /* never: body is always hidden */
    body.tdm-never .todo-body   { display: none !important; }
    body.tdm-never .todo-header { cursor: default; }
    /* manual modes: use existing open/closed class logic, cursor stays pointer */

    /* Todo display settings grid */
    .tdm-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-top: 4px; }
    .tdm-card {
      border-radius: var(--card-radius); border: 2px solid var(--border);
      background: var(--surface); cursor: pointer; padding: 12px 14px;
      transition: border-color .15s, transform .13s, box-shadow .15s;
      display: flex; flex-direction: column; gap: 4px;
    }
    .tdm-card:hover { transform: translateY(-2px); border-color: var(--proj-a); }
    .tdm-card.selected { border-color: var(--proj-a); box-shadow: 0 0 0 3px rgba(168,85,247,.22), 0 4px 16px rgba(168,85,247,.15); }
    .tdm-card-top { display: flex; align-items: center; justify-content: space-between; gap: 6px; }
    .tdm-card-icon { font-size: 1rem; }
    .tdm-card-check { color: var(--proj-a); font-size: .85rem; }
    .tdm-card-label { font-size: .83rem; font-weight: 700; color: var(--fg); }
    .tdm-card-desc  { font-size: .72rem; color: var(--muted); line-height: 1.4; }

    /* Priority button */
    .btn-priority {
      font-size: .62rem; font-weight: 700; padding: 3px 8px;
      border-radius: 20px; border: 1px solid var(--border);
      background: transparent; color: var(--muted);
      cursor: pointer; letter-spacing: .2px; white-space: nowrap;
      transition: color .13s, border-color .13s, background .13s, box-shadow .13s;
    }
    .btn-priority:hover { color: #fbbf24; border-color: rgba(251,191,36,.5); }
    .btn-priority.is-priority {
      background: linear-gradient(135deg, #d97706, #fbbf24);
      color: #1a0e00; border-color: transparent;
      box-shadow: 0 2px 8px rgba(251,191,36,.4);
    }
    .btn-priority.is-priority:hover { filter: brightness(1.1); }

    .card-title { font-size: .9rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .card-meta  { display: flex; align-items: center; gap: 7px; flex-wrap: wrap; }

    /* Days circle */
    .days-circle {
      width: 34px; height: 34px; border-radius: 50%;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      font-weight: 800; line-height: 1.1; flex-shrink: 0; border: 2px solid;
    }
    .days-circle .dc-num { font-size: .82rem; line-height: 1; }
    .days-circle .dc-lbl { font-size: .48rem; opacity: .85; letter-spacing: .3px; }

    /* Status pills */
    .status-pill { font-size: .64rem; font-weight: 800; text-transform: uppercase; letter-spacing: .8px; padding: 3px 9px; border-radius: 20px; }
    .status-running { background: linear-gradient(90deg, #0891b2, #06b6d4); color: #e0f9ff; box-shadow: 0 2px 8px rgba(6,182,212,.45); }
    .status-paused  { background: linear-gradient(90deg, #c2410c, #fb923c); color: #fff7ed; box-shadow: 0 2px 8px rgba(251,146,60,.4); }
    .status-pending { background: linear-gradient(90deg, #a16207, #facc15); color: #1a0f00; box-shadow: 0 2px 8px rgba(250,204,21,.4); }
    .status-done    { background: linear-gradient(90deg, #15803d, #4ade80); color: #052e16; box-shadow: 0 2px 8px rgba(74,222,128,.35); }

    .card-date { font-size: .7rem; color: var(--muted); background: var(--surface2); padding: 2px 7px; border-radius: 6px; white-space: nowrap; flex-shrink: 0; }
    .card-desc { font-size: .77rem; color: #9ba4c0; line-height: 1.5; white-space: pre-wrap; word-break: break-word; }

    /* QDR two-column layout */
    .card-split { display: flex; gap: 0; align-items: stretch; }
    .card-left  { display: flex; flex-direction: column; gap: 5px; flex: 1; min-width: 0; padding-right: 12px; }
    .card-right { flex: 1; min-width: 0; border-left: 1px solid var(--border); padding-left: 12px; display: flex; align-items: center; }
    .card-right .card-desc { margin: 0; }

    .card-link { font-size: .7rem; display: flex; align-items: center; gap: 4px; }
    .card-link a { text-decoration: none; word-break: break-all; font-weight: 600; }
    .panel--proj .card-link a { color: var(--proj-a); }
    .panel--qdr  .card-link a { color: var(--qdr-a);  }
    .card-link a:hover { text-decoration: underline; }

    .btn-icon { background: none; border: none; cursor: pointer; color: var(--muted); padding: 4px 5px; border-radius: 5px; font-size: .78rem; line-height: 1; transition: color .13s, background .13s; }
    .btn-icon:hover { color: var(--text); background: var(--surface2); }
    .btn-icon.del:hover { color: #f87171; background: rgba(248,113,113,.1); }

    /* Drag handle */
    .drag-handle {
      flex-shrink: 0; cursor: grab; color: var(--muted);
      font-size: .9rem; padding: 2px 4px 2px 0;
      user-select: none; opacity: .35;
      transition: opacity .13s;
      align-self: center;
      letter-spacing: -1px;
    }
    .drag-handle:hover { opacity: 1; }
    .drag-handle:active { cursor: grabbing; }

    /* Drag states */
    .panel--proj .card.dragging  { opacity: .3; border-style: dashed; }
    .panel--proj .card.drag-over {
      border-color: var(--proj-a) !important;
      box-shadow: 0 0 0 2px rgba(168,85,247,.35), -4px 0 18px rgba(168,85,247,.2) !important;
      transform: translateX(4px);
    }

    /* ── Todo section ── */
    .todo-section { margin-top: 10px; border-top: 1px solid var(--border); padding-top: 7px; }
    .todo-header { display: flex; align-items: center; gap: 7px; cursor: pointer; user-select: none; padding: 2px 0; }
    .todo-label { font-size: .65rem; font-weight: 800; text-transform: uppercase; letter-spacing: .8px; color: var(--muted); }
    .todo-summary { font-size: .65rem; font-weight: 700; padding: 1px 7px; border-radius: 10px; }
    .panel--proj .todo-summary { background: rgba(168,85,247,.12); color: var(--proj-a); border: 1px solid rgba(168,85,247,.25); }
    .panel--qdr  .todo-summary { background: rgba(6,182,212,.12);  color: var(--qdr-a);  border: 1px solid rgba(6,182,212,.25);  }
    .todo-chevron { margin-left: auto; font-size: .6rem; color: var(--muted); transition: transform .18s; }
    .todo-section.open .todo-chevron { transform: rotate(180deg); }

    .todo-body { display: none; flex-direction: column; gap: 5px; margin-top: 8px; }
    .todo-section.open .todo-body { display: flex; }

    .todo-item { display: flex; align-items: center; gap: 7px; padding: 5px 7px; border-radius: 6px; background: var(--bg); border: 1px solid var(--border); transition: background .15s, border-color .15s; }
    .todo-item.done .todo-text { text-decoration: line-through; opacity: .4; }
    .todo-item.highlighted { background: rgba(251,191,36,.1); border-color: rgba(251,191,36,.45); }
    .todo-highlight-btn { background: none; border: none; cursor: pointer; font-size: .75rem; padding: 2px 3px; border-radius: 3px; line-height: 1; flex-shrink: 0; color: var(--border); transition: color .13s, transform .13s; }
    .todo-highlight-btn:hover { color: #fbbf24; transform: scale(1.2); }
    .todo-highlight-btn.on { color: #fbbf24; filter: drop-shadow(0 0 4px rgba(251,191,36,.7)); }
    .todo-cb { width: 14px; height: 14px; cursor: pointer; flex-shrink: 0; }
    .panel--proj .todo-cb { accent-color: var(--proj-a); }
    .panel--qdr  .todo-cb { accent-color: var(--qdr-a);  }
    .todo-text { flex: 1; font-size: .78rem; min-width: 0; word-break: break-word; }
    .todo-due { font-size: .63rem; font-weight: 600; padding: 2px 6px; border-radius: 5px; white-space: nowrap; flex-shrink: 0; }
    .todo-due.future  { background: var(--surface2); color: var(--muted); }
    .todo-due.today   { background: rgba(250,204,21,.15); color: #fde68a; border: 1px solid rgba(250,204,21,.3); }
    .todo-due.overdue { background: rgba(239,68,68,.18); color: #fca5a5; border: 1px solid rgba(239,68,68,.28); }
    .todo-del { background: none; border: none; cursor: pointer; color: var(--muted); font-size: .7rem; padding: 2px 3px; border-radius: 3px; line-height: 1; flex-shrink: 0; transition: color .13s; }
    .todo-del:hover { color: #f87171; }
    .todo-edit-btn { background: none; border: none; cursor: pointer; color: var(--muted); font-size: .7rem; padding: 2px 3px; border-radius: 3px; line-height: 1; flex-shrink: 0; transition: color .13s, background .13s; }
    .todo-edit-btn:hover { color: var(--text); background: var(--surface2); }

    /* Inline edit form */
    .todo-item--editing { flex-direction: column; align-items: stretch; gap: 6px; }
    .todo-edit-r1 { display: flex; gap: 5px; align-items: center; }
    .todo-edit-r2 { display: flex; gap: 5px; align-items: center; }
    .todo-edit-text, .todo-edit-date, .todo-edit-link {
      background: var(--bg); border: 1px solid var(--border);
      border-radius: 6px; color: var(--text); font-family: inherit; outline: none;
      padding: 4px 7px; font-size: .78rem; transition: border-color .13s;
    }
    .todo-edit-text { flex: 1; }
    .todo-edit-date { width: 94px; -webkit-appearance: none; appearance: none; }
    .todo-edit-date::-webkit-calendar-picker-indicator { display: none; }
    .todo-edit-link { flex: 1; font-size: .75rem; }
    .panel--proj .todo-edit-text:focus,
    .panel--proj .todo-edit-date:focus,
    .panel--proj .todo-edit-link:focus { border-color: var(--proj-a); box-shadow: 0 0 0 2px rgba(168,85,247,.12); }
    .panel--qdr  .todo-edit-text:focus,
    .panel--qdr  .todo-edit-date:focus  { border-color: var(--qdr-a);  box-shadow: 0 0 0 2px rgba(6,182,212,.12);  }
    .todo-edit-cal {
      width: 24px; flex-shrink: 0; border-radius: 5px; border: 1px solid var(--border);
      background: var(--bg); color: var(--muted); font-size: .75rem; cursor: pointer;
      display: flex; align-items: center; justify-content: center; transition: color .13s, border-color .13s;
    }
    .panel--proj .todo-edit-cal:hover { border-color: var(--proj-a); color: var(--proj-a); }
    .panel--qdr  .todo-edit-cal:hover { border-color: var(--qdr-a);  color: var(--qdr-a);  }
    .todo-edit-actions { display: flex; gap: 4px; margin-left: auto; }
    .todo-save-btn, .todo-cancel-btn {
      font-size: .7rem; font-weight: 700; padding: 3px 9px;
      border-radius: 5px; border: none; cursor: pointer; transition: filter .13s;
    }
    .todo-save-btn:hover, .todo-cancel-btn:hover { filter: brightness(1.15); }
    .panel--proj .todo-save-btn { background: linear-gradient(135deg, var(--proj-a), var(--proj-b)); color: #fff; }
    .panel--qdr  .todo-save-btn { background: linear-gradient(135deg, var(--qdr-a),  var(--qdr-b));  color: #031214; }
    .todo-cancel-btn { background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }

    /* Add-todo row */
    .todo-add-row { display: flex; gap: 5px; margin-top: 4px; }
    .todo-add-text {
      flex: 1; background: var(--bg); border: 1px solid var(--border);
      border-radius: 6px; color: var(--text); font-size: .78rem;
      padding: 5px 8px; font-family: inherit; outline: none; transition: border-color .13s;
    }
    .panel--proj .todo-add-text:focus { border-color: var(--proj-a); box-shadow: 0 0 0 2px rgba(168,85,247,.12); }
    .panel--qdr  .todo-add-text:focus { border-color: var(--qdr-a);  box-shadow: 0 0 0 2px rgba(6,182,212,.12);  }
    .todo-date-wrap { display: flex; gap: 4px; }
    .todo-add-date {
      width: 94px; background: var(--bg); border: 1px solid var(--border);
      border-radius: 6px; color: var(--text); font-size: .75rem;
      padding: 5px 6px; font-family: inherit; outline: none;
      -webkit-appearance: none; appearance: none; transition: border-color .13s;
    }
    .todo-add-date::-webkit-calendar-picker-indicator { display: none; }
    .panel--proj .todo-add-date:focus { border-color: var(--proj-a); }
    .panel--qdr  .todo-add-date:focus { border-color: var(--qdr-a);  }
    .todo-add-cal {
      width: 26px; border-radius: 6px; border: 1px solid var(--border);
      background: var(--bg); color: var(--muted); font-size: .8rem;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: background .13s, border-color .13s, color .13s;
    }
    .panel--proj .todo-add-cal:hover { background: rgba(168,85,247,.15); border-color: var(--proj-a); color: var(--proj-a); }
    .panel--qdr  .todo-add-cal:hover { background: rgba(6,182,212,.12);  border-color: var(--qdr-a);  color: var(--qdr-a);  }
    .todo-add-btn {
      width: 26px; border-radius: 6px; border: none;
      font-size: 1rem; font-weight: 700; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; transition: filter .13s;
    }
    .todo-add-btn:hover { filter: brightness(1.15); }
    .panel--proj .todo-add-btn { background: linear-gradient(135deg, var(--proj-a), var(--proj-b)); color: #fff; }
    .panel--qdr  .todo-add-btn { background: linear-gradient(135deg, var(--qdr-a),  var(--qdr-b));  color: #031214; }

    /* Todo link input row (proj only) */
    .todo-add-link-row { display: flex; gap: 5px; margin-top: 4px; }
    .todo-add-link {
      flex: 1; background: var(--bg); border: 1px solid var(--border);
      border-radius: 6px; color: var(--text); font-size: .75rem;
      padding: 5px 8px; font-family: inherit; outline: none; transition: border-color .13s;
    }
    .panel--proj .todo-add-link:focus { border-color: var(--proj-a); box-shadow: 0 0 0 2px rgba(168,85,247,.12); }
    .panel--qdr  .todo-add-link:focus { border-color: var(--qdr-a);  box-shadow: 0 0 0 2px rgba(6,182,212,.12);  }

    /* Link badge on a todo item */
    .todo-item-link {
      font-size: .63rem; font-weight: 600; flex-shrink: 0;
      padding: 2px 7px; border-radius: 5px;
      text-decoration: none; white-space: nowrap;
    }
    .panel--proj .todo-item-link { background: rgba(168,85,247,.12); color: var(--proj-a); border: 1px solid rgba(168,85,247,.25); }
    .panel--proj .todo-item-link:hover { background: rgba(168,85,247,.25); text-decoration: underline; }
    .panel--qdr  .todo-item-link { background: rgba(6,182,212,.12);  color: var(--qdr-a);  border: 1px solid rgba(6,182,212,.25);  }
    .panel--qdr  .todo-item-link:hover { background: rgba(6,182,212,.25);  text-decoration: underline; }

    /* ── Milestones ── */
    .milestone-section { margin-top: 10px; border-top: 1px solid var(--border); padding-top: 7px; }
    .milestone-header { display: flex; align-items: center; gap: 7px; cursor: pointer; user-select: none; padding: 2px 0; }
    .milestone-label { font-size: .65rem; font-weight: 800; text-transform: uppercase; letter-spacing: .8px; color: var(--muted); }
    .milestone-summary { font-size: .65rem; font-weight: 700; padding: 1px 7px; border-radius: 10px; background: rgba(6,182,212,.12); color: var(--qdr-a); border: 1px solid rgba(6,182,212,.25); }
    .milestone-chevron { margin-left: auto; font-size: .6rem; color: var(--muted); transition: transform .18s; }
    .milestone-section.open .milestone-chevron { transform: rotate(180deg); }
    .milestone-body { display: none; flex-direction: column; gap: 5px; margin-top: 8px; }
    .milestone-section.open .milestone-body { display: flex; }
    .milestone-item { display: flex; align-items: center; gap: 7px; padding: 5px 7px; border-radius: 6px; background: var(--bg); border: 1px solid var(--border); }
    .milestone-item.done .milestone-name { text-decoration: line-through; opacity: .45; }
    .milestone-cb { width: 14px; height: 14px; cursor: pointer; flex-shrink: 0; accent-color: var(--qdr-a); }
    .milestone-name { flex: 1; font-size: .78rem; min-width: 0; word-break: break-word; }
    .milestone-date { font-size: .63rem; font-weight: 600; padding: 2px 6px; border-radius: 5px; white-space: nowrap; flex-shrink: 0; background: var(--surface2); color: var(--muted); }
    .milestone-del { background: none; border: none; cursor: pointer; color: var(--muted); font-size: .7rem; padding: 2px 3px; border-radius: 3px; line-height: 1; flex-shrink: 0; transition: color .13s; }
    .milestone-del:hover { color: #f87171; }
    .milestone-add-row { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; margin-top: 2px; }
    .milestone-add-name { flex: 1; min-width: 80px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--fg); padding: 5px 8px; font-size: .78rem; font-family: inherit; }
    .milestone-add-name:focus { outline: none; border-color: var(--qdr-a); box-shadow: 0 0 0 2px rgba(6,182,212,.12); }
    .milestone-add-date { background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); padding: 4px 6px; font-size: .78rem; font-family: inherit; flex-shrink: 0; -webkit-appearance: none; appearance: none; }
    .milestone-add-date::-webkit-calendar-picker-indicator { display: none; }
    .milestone-add-date:focus { outline: none; border-color: var(--qdr-a); }
    .ms-date-wrap { display: flex; gap: 4px; align-items: center; }
    .ms-btn-cal { flex-shrink: 0; width: 26px; height: 26px; border-radius: 5px; border: 1px solid var(--border); background: var(--bg); color: var(--muted); font-size: .8rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background .13s, color .13s, border-color .13s; padding: 0; line-height: 1; }
    .ms-btn-cal:hover { background: rgba(6,182,212,.12); border-color: var(--qdr-a); color: var(--qdr-a); }
    .milestone-add-btn { border: none; border-radius: 6px; font-size: .75rem; font-weight: 700; padding: 5px 12px; cursor: pointer; flex-shrink: 0; transition: filter .13s; }
    .milestone-add-btn:hover { filter: brightness(1.15); }
    .panel--proj .milestone-add-btn { background: linear-gradient(135deg, var(--proj-a), var(--proj-b)); color: #fff; }
    .panel--qdr  .milestone-add-btn { background: linear-gradient(135deg, var(--qdr-a),  var(--qdr-b));  color: #031214; }
    .next-ms-badge { display: inline-flex; align-items: center; gap: 5px; font-size: .67rem; font-weight: 700; padding: 2px 8px; border-radius: 10px; background: rgba(6,182,212,.1); color: var(--qdr-a); border: 1px solid rgba(6,182,212,.2); white-space: nowrap; max-width: 100%; overflow: hidden; text-overflow: ellipsis; }
    .next-ms-badge.overdue { background: rgba(239,68,68,.12); color: #fca5a5; border-color: rgba(239,68,68,.28); }
    .next-ms-badge.today   { background: rgba(250,204,21,.12); color: #fde68a; border-color: rgba(250,204,21,.3); }

    /* ── Aged QDR card ── */
    .panel--qdr .card.card--aged {
      border-color: color-mix(in srgb, var(--warn-a) 40%, transparent);
      background: linear-gradient(135deg, color-mix(in srgb, var(--warn-a) 7%, var(--surface)) 0%, var(--surface) 50%);
    }
    .panel--qdr .card.card--aged::before { background: var(--warn-a); opacity: .8; }
    .panel--qdr .card.card--aged:hover {
      box-shadow: -4px 0 22px color-mix(in srgb, var(--warn-a) 28%, transparent), 0 4px 20px color-mix(in srgb, var(--warn-a) 12%, transparent);
      border-color: color-mix(in srgb, var(--warn-a) 65%, transparent);
    }
    .age-badge { display: inline-flex; align-items: center; gap: 4px; font-size: .67rem; font-weight: 700; padding: 2px 7px; border-radius: 10px; background: color-mix(in srgb, var(--warn-a) 12%, transparent); color: var(--warn-a); border: 1px solid color-mix(in srgb, var(--warn-a) 28%, transparent); white-space: nowrap; }

    /* ── Color Vision Modes ── */
    body.cv-deuteranopia { --proj-a:#3b82f6; --proj-b:#818cf8; --qdr-a:#f97316; --qdr-b:#fbbf24; --warn-a:#ea580c; --bg-glow-a:rgba(59,130,246,.12); --bg-glow-b:rgba(249,115,22,.10); --bg-glow-c:rgba(129,140,248,.08); }
    body.cv-tritanopia   { --proj-a:#e11d48; --proj-b:#fb923c; --qdr-a:#0d9488; --qdr-b:#34d399; --warn-a:#7c3aed; --bg-glow-a:rgba(225,29,72,.12);  --bg-glow-b:rgba(13,148,136,.10);  --bg-glow-c:rgba(251,146,60,.08); }
    body.cv-high-contrast{ --proj-a:#f0abfc; --proj-b:#e879f9; --qdr-a:#67e8f9; --qdr-b:#22d3ee; --warn-a:#fde047; --bg-glow-a:rgba(240,171,252,.16); --bg-glow-b:rgba(103,232,249,.13); --bg-glow-c:rgba(232,121,249,.10); }

    .cv-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:10px; }
    .cv-card { background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:12px 14px; cursor:pointer; transition:border-color .15s,background .15s; display:flex; flex-direction:column; gap:8px; }
    .cv-card:hover { border-color:var(--muted); background:var(--surface); }
    .cv-card.selected { border-color:var(--qdr-a); background:rgba(6,182,212,.07); }
    .cv-swatches { display:flex; gap:6px; align-items:center; }
    .cv-swatch { width:18px; height:18px; border-radius:50%; flex-shrink:0; }
    .cv-name { font-size:.8rem; font-weight:700; color:var(--text); }
    .cv-sub  { font-size:.67rem; color:var(--muted); line-height:1.4; }

    .target-row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .target-days-input { width:68px; background:var(--bg); border:1px solid var(--border); border-radius:7px; color:var(--text); font-size:.9rem; padding:7px 10px; font-family:inherit; text-align:center; outline:none; transition:border-color .15s; }
    .target-days-input:focus { border-color:var(--qdr-a); box-shadow:0 0 0 2px rgba(6,182,212,.12); }
    .target-days-lbl { font-size:.82rem; color:var(--muted); }
    .modal-milestone-row { display: flex; align-items: center; gap: 8px; padding: 4px 0; }
    .modal-milestone-row input[type=checkbox] { width: 15px; height: 15px; flex-shrink: 0; accent-color: var(--qdr-a); cursor: pointer; background: unset; border: unset; border-radius: unset; padding: unset; }
    .modal-milestone-row label { display: inline-flex; text-transform: none; letter-spacing: normal; font-size: .85rem; font-weight: 600; color: var(--text); cursor: pointer; }

    /* ── Modal ── */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.75); backdrop-filter: blur(8px); z-index: 200; align-items: center; justify-content: center; }
    .modal-overlay.open { display: flex; }

    .modal {
      background: var(--surface); border-radius: var(--radius);
      padding: 28px; width: 490px; max-width: 95vw; max-height: 90vh; overflow-y: auto;
      display: flex; flex-direction: column; gap: 15px;
      position: relative; border: 1px solid var(--border);
    }
    .modal::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; border-radius: var(--radius) var(--radius) 0 0; }
    .modal.proj-modal::before { background: linear-gradient(90deg, var(--proj-a), var(--proj-b)); }
    .modal.qdr-modal::before  { background: linear-gradient(90deg, var(--qdr-a),  var(--qdr-b));  }

    .modal h2 { font-size: 1rem; font-weight: 800; letter-spacing: .3px; }
    .modal.proj-modal h2 { background: linear-gradient(90deg, var(--proj-a), var(--proj-b)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .modal.qdr-modal  h2 { background: linear-gradient(90deg, var(--qdr-a),  var(--qdr-b));  -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    .modal label { display: flex; flex-direction: column; gap: 5px; font-size: .72rem; color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: .6px; }
    .modal input, .modal select, .modal textarea {
      background: var(--bg); border: 1px solid var(--border); border-radius: 7px;
      color: var(--text); font-size: .88rem; padding: 9px 12px; font-family: inherit;
      outline: none; transition: border-color .15s, box-shadow .15s;
    }
    .modal.proj-modal input:focus, .modal.proj-modal select:focus, .modal.proj-modal textarea:focus { border-color: var(--proj-a); box-shadow: 0 0 0 3px rgba(168,85,247,.15); }
    .modal.qdr-modal  input:focus, .modal.qdr-modal  select:focus, .modal.qdr-modal  textarea:focus { border-color: var(--qdr-a);  box-shadow: 0 0 0 3px rgba(6,182,212,.15);  }
    .modal select option { background: var(--surface); }
    .modal textarea { resize: vertical; min-height: 72px; }

    .date-input-wrap { display: flex; gap: 6px; }
    .date-input-wrap input[type="date"] { flex: 1; -webkit-appearance: none; appearance: none; }
    .date-input-wrap input[type="date"]::-webkit-calendar-picker-indicator { display: none; }
    .btn-cal { flex-shrink: 0; width: 38px; border-radius: 7px; border: 1px solid var(--border); background: var(--bg); color: var(--muted); font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background .13s, color .13s, border-color .13s; }
    .modal.proj-modal .btn-cal:hover { background: rgba(168,85,247,.15); border-color: var(--proj-a); color: var(--proj-a); }
    .modal.qdr-modal  .btn-cal:hover { background: rgba(6,182,212,.12);  border-color: var(--qdr-a);  color: var(--qdr-a);  }

    .modal-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 4px; }
    .btn { font-size: .82rem; font-weight: 700; padding: 9px 22px; border-radius: 7px; border: none; cursor: pointer; transition: transform .12s, filter .12s; letter-spacing: .2px; }
    .btn:hover { transform: translateY(-1px); filter: brightness(1.1); }
    .btn:active { transform: translateY(0); }
    .btn-cancel { background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }
    .modal.proj-modal .btn-save { background: linear-gradient(135deg, var(--proj-a), var(--proj-b)); color: #fff; box-shadow: 0 4px 14px rgba(168,85,247,.4); }
    .modal.qdr-modal  .btn-save { background: linear-gradient(135deg, var(--qdr-a),  var(--qdr-b));  color: #031214; box-shadow: 0 4px 14px rgba(6,182,212,.4); }
    .btn-delete { background: linear-gradient(135deg, #dc2626, #b91c1c); color: #fff; box-shadow: 0 4px 14px rgba(220,38,38,.4); }

    /* ── Confirm dialog ── */
    .confirm-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.75); backdrop-filter: blur(8px); z-index: 300; align-items: center; justify-content: center; }
    .confirm-overlay.open { display: flex; }
    .confirm-box {
      background: var(--surface); border-radius: var(--radius);
      padding: 28px 32px; width: 380px; max-width: 94vw;
      display: flex; flex-direction: column; gap: 18px;
      border: 1px solid var(--border); position: relative;
    }
    .confirm-box::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; border-radius: var(--radius) var(--radius) 0 0; background: linear-gradient(90deg, #dc2626, #f87171); }
    .confirm-box h3 { font-size: .95rem; font-weight: 800; color: var(--text); }
    .confirm-box p  { font-size: .84rem; color: var(--muted); line-height: 1.5; }
    .confirm-box strong { color: var(--text); }
    .confirm-actions { display: flex; justify-content: flex-end; gap: 10px; }

    /* ── Tab bar ── */
    .tab-bar {
      display: flex; align-items: center; gap: 6px;
      padding: 8px 28px; flex-shrink: 0;
      background: var(--tabbar-bg); border-bottom: 1px solid var(--border);
      position: relative; z-index: 9;
    }
    .tab-btn {
      font-size: .78rem; font-weight: 700; padding: 6px 20px;
      border-radius: 20px; border: 1px solid var(--border);
      background: transparent; color: var(--muted); cursor: pointer;
      letter-spacing: .4px; transition: all .18s;
      display: inline-flex; align-items: center; gap: 7px;
    }
    .tab-btn:hover { color: var(--text); border-color: var(--muted); background: var(--surface2); }
    .tab-btn.active {
      background: linear-gradient(135deg, var(--proj-a), var(--qdr-a));
      border-color: transparent; color: #fff;
      box-shadow: 0 3px 14px rgba(168,85,247,.45), 0 1px 4px rgba(6,182,212,.3);
    }
    .tab-icon {
      font-size: 1.05rem; line-height: 1; display: inline-block;
      transition: transform .22s cubic-bezier(.34,1.56,.64,1), filter .22s;
    }
    .tab-btn:hover .tab-icon { transform: scale(1.3); }
    .tab-btn:not(.active) .tab-icon { filter: grayscale(1); }
    .tab-btn.active .tab-icon { filter: drop-shadow(0 0 5px rgba(255,255,255,.7)); }
    .tab-btn.active:hover .tab-icon { transform: scale(1.3); filter: drop-shadow(0 0 9px rgba(255,255,255,.95)); }
    .tab-icon--gear { transition: transform .38s cubic-bezier(.34,1.56,.64,1); }
    .tab-btn:hover .tab-icon--gear { transform: rotate(72deg) scale(1.2); }

    /* ── Calendar view ── */
    #view-calendar {
      flex: 1; overflow: hidden;
      display: none; flex-direction: column;
      position: relative; z-index: 1;
    }
    #view-calendar.active { display: flex; }
    #cal-scroll { flex: 1; overflow-y: auto; padding: 28px 36px; display: flex; flex-direction: column; gap: 20px; }

    .cal-toolbar {
      display: flex; justify-content: flex-end; align-items: center;
      padding: 0 0 4px; flex-shrink: 0;
    }
    .cal-today-btn {
      font-size: .75rem; font-weight: 700; padding: 5px 16px;
      border-radius: 20px; border: 1px solid var(--border);
      background: var(--surface); color: var(--muted); cursor: pointer;
      transition: all .14s; letter-spacing: .3px;
    }
    .cal-today-btn:hover { border-color: var(--proj-a); color: var(--text); background: var(--surface2); }

    .cal-month-section { display: flex; flex-direction: column; gap: 8px; }
    .cal-section-label {
      font-size: 1.05rem; font-weight: 800; letter-spacing: .4px;
      background: linear-gradient(90deg, var(--proj-a), var(--qdr-a));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      padding: 10px 0 2px;
      position: sticky; top: 0; z-index: 4;
      background-color: var(--bg);
      -webkit-text-fill-color: transparent;
    }
    .cal-sentinel { display: flex; justify-content: center; padding: 18px 0; color: var(--muted); font-size: .85rem; letter-spacing: 4px; animation: blink-dots 1.3s ease-in-out infinite; }

    .cal-grid {
      display: grid; grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .cal-grid.with-weeknums { grid-template-columns: 28px repeat(7, 1fr); }
    .cal-day-header {
      text-align: center; font-size: .68rem; font-weight: 800;
      text-transform: uppercase; letter-spacing: 1px; color: var(--muted);
      padding: 4px 0 8px;
    }
    .cal-week-num {
      display: flex; align-items: center; justify-content: center;
      font-size: .6rem; font-weight: 700; color: var(--muted);
      opacity: .5; padding: 2px; letter-spacing: .5px;
    }
    .cal-week-num-header {
      font-size: .6rem; font-weight: 700; color: var(--muted);
      opacity: .4; text-align: center; padding: 4px 0 8px;
      text-transform: uppercase;
    }
    .cal-cell {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 8px; min-height: 72px; padding: 8px;
      display: flex; flex-direction: column; gap: 5px;
      position: relative; cursor: default;
      transition: border-color .13s;
    }
    .cal-cell--empty { background: transparent; border-color: transparent; }
    .cal-cell--today {
      border-color: var(--proj-a);
      background: linear-gradient(135deg, rgba(168,85,247,.1) 0%, var(--surface) 60%);
    }
    .cal-cell--has-events { cursor: pointer; }
    .cal-cell--has-events:hover { border-color: var(--proj-a); }
    .cal-cell--selected {
      border-color: var(--proj-a) !important;
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--proj-a) 30%, transparent);
      background: linear-gradient(135deg, color-mix(in srgb, var(--proj-a) 12%, transparent) 0%, var(--surface) 70%);
    }

    /* Day detail panel */
    .cal-day-detail {
      background: var(--surface); border: 1px solid var(--border);
      border-top: 1px solid var(--border);
      border-radius: 0; padding: 0;
      display: flex; flex-direction: column;
      overflow: hidden; flex-shrink: 0;
      max-height: 40vh; overflow-y: auto;
      animation: calDetailIn .18s ease;
    }
    @keyframes calDetailIn { from { opacity:0; transform:translateY(-6px); } to { opacity:1; transform:none; } }
    .cal-detail-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 18px 12px; border-bottom: 1px solid var(--border);
    }
    .cal-detail-date { font-size: .95rem; font-weight: 800; color: var(--text); }
    .cal-detail-count { font-size: .72rem; color: var(--muted); margin-top: 2px; }
    .cal-detail-close {
      background: none; border: none; color: var(--muted); cursor: pointer;
      font-size: .9rem; padding: 4px 8px; border-radius: 6px;
      transition: background .13s, color .13s; flex-shrink: 0;
    }
    .cal-detail-close:hover { background: var(--surface2); color: var(--text); }
    .cal-detail-list { display: flex; flex-direction: column; padding: 8px; gap: 4px; }
    .cal-detail-item {
      display: flex; gap: 10px; align-items: flex-start;
      padding: 10px 12px; border-radius: 8px; cursor: pointer;
      border: 1px solid transparent;
      transition: background .13s, border-color .13s;
    }
    .cal-detail-item:hover { background: var(--surface2); border-color: var(--border); }
    .cal-detail-item:hover .cal-detail-nav { opacity: 1; }
    .cal-detail-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; margin-top: 5px; }
    .cal-detail-dot--proj { background: var(--proj-a); box-shadow: 0 0 5px var(--proj-a); }
    .cal-detail-dot--qdr  { background: var(--qdr-a);  box-shadow: 0 0 5px var(--qdr-a);  }
    .cal-detail-body { display: flex; flex-direction: column; gap: 2px; flex: 1; min-width: 0; }
    .cal-detail-parent { font-size: .68rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .4px; }
    .cal-detail-todo { font-size: .85rem; font-weight: 600; color: var(--text); word-break: break-word; }
    .cal-detail-todo.done { text-decoration: line-through; opacity: .45; }
    .cal-detail-item.done { opacity: .4; }
    .cal-dot--faded { opacity: .28; box-shadow: none !important; }
    .cal-detail-nav {
      font-size: .68rem; color: var(--proj-a); opacity: 0;
      transition: opacity .13s; flex-shrink: 0; align-self: center;
      font-weight: 700; letter-spacing: .3px;
    }

    .cal-day-num {
      font-size: .8rem; font-weight: 700; color: var(--muted); line-height: 1;
    }
    .cal-cell--today .cal-day-num { color: var(--proj-a); }

    .cal-dots { display: flex; gap: 4px; flex-wrap: wrap; }
    .cal-dot {
      width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
    }
    .cal-dot--proj { background: var(--proj-a); box-shadow: 0 0 5px var(--proj-a); }
    .cal-dot--qdr  { background: var(--qdr-a);  box-shadow: 0 0 5px var(--qdr-a);  }

    /* Shared fixed tooltip */
    #cal-tooltip {
      display: none;
      position: fixed; z-index: 9999;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 10px; padding: 10px 12px;
      min-width: 200px; max-width: 280px;
      box-shadow: 0 8px 30px rgba(0,0,0,.5);
      pointer-events: none;
    }
    .cal-tip-date {
      font-size: .68rem; font-weight: 800; text-transform: uppercase;
      letter-spacing: .7px; color: var(--muted); margin-bottom: 7px;
    }
    .cal-tip-item {
      display: flex; gap: 8px; align-items: flex-start;
      padding: 5px 0; border-top: 1px solid var(--border);
    }
    .cal-tip-item:first-of-type { border-top: none; }
    .cal-tip-dot {
      width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; margin-top: 4px;
    }
    .cal-tip-dot--proj { background: var(--proj-a); }
    .cal-tip-dot--qdr  { background: var(--qdr-a);  }
    .cal-tip-body { display: flex; flex-direction: column; gap: 2px; min-width: 0; }
    .cal-tip-parent { font-size: .68rem; font-weight: 700; color: var(--muted); }
    .cal-tip-todo   { font-size: .8rem;  font-weight: 600; color: var(--text); word-break: break-word; }
    .cal-tip-done   { text-decoration: line-through; opacity: .5; }

    /* ── Colors view ── */
    #view-settings {
      flex: 1; overflow-y: auto; padding: 32px 40px;
      display: none; flex-direction: column; gap: 32px;
      position: relative; z-index: 1;
    }
    #view-settings.active { display: flex; }
    .settings-section-heading {
      font-size: .72rem; font-weight: 800; text-transform: uppercase;
      letter-spacing: 1.2px; color: var(--muted);
      padding-bottom: 10px; border-bottom: 1px solid var(--border);
    }
    .colors-heading {
      font-size: 1rem; font-weight: 800; letter-spacing: .5px;
      background: linear-gradient(90deg, var(--proj-a), var(--qdr-a));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .colors-sub { font-size: .8rem; color: var(--muted); margin-top: -16px; }
    .mode-switch { display:flex; background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:3px; gap:3px; width:fit-content; }
    .mode-opt { display:flex; align-items:center; gap:6px; padding:6px 18px; border-radius:7px; border:none; background:transparent; color:var(--muted); font-size:.85rem; font-weight:600; cursor:pointer; transition:background .15s,color .15s; }
    .mode-opt:hover { color:var(--text); }
    .mode-opt.active { background:var(--surface); color:var(--text); box-shadow:0 1px 4px rgba(0,0,0,.12); }
    .theme-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(172px, 1fr)); gap: 14px;
    }
    .theme-card {
      border-radius: var(--card-radius); border: 2px solid var(--border);
      background: var(--surface); cursor: pointer;
      overflow: hidden; transition: border-color .15s, transform .13s, box-shadow .15s;
      display: flex; flex-direction: column;
    }
    .theme-card:hover { transform: translateY(-2px); border-color: var(--proj-a); }
    .theme-card.selected {
      border-color: var(--proj-a);
      box-shadow: 0 0 0 3px rgba(168,85,247,.22), 0 6px 24px rgba(168,85,247,.18);
    }
    .theme-accent-bar { height: 5px; width: 100%; flex-shrink: 0; }
    .theme-swatches { display: flex; gap: 7px; padding: 12px 12px 8px; }
    .theme-swatch { width: 20px; height: 20px; border-radius: 50%; flex-shrink: 0; }
    .theme-bg-strip {
      display: flex; margin: 0 12px 12px; border-radius: 6px; overflow: hidden;
      height: 30px; border: 1px solid rgba(255,255,255,.08);
    }
    .theme-bg-item { flex: 1; }
    .theme-name-row {
      display: flex; align-items: center; gap: 6px;
      padding: 0 12px 12px;
    }
    .theme-name { font-size: .78rem; font-weight: 700; color: var(--text); flex: 1; }
    .theme-check { font-size: .85rem; color: var(--proj-a); display: none; }
    .theme-card.selected .theme-check { display: inline; }

    .pname-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;
      margin-top: 4px;
    }
    .pname-card {
      border-radius: var(--card-radius); border: 2px solid var(--border);
      background: var(--surface); cursor: pointer; padding: 14px 16px;
      transition: border-color .15s, transform .13s, box-shadow .15s;
      display: flex; align-items: center; justify-content: space-between; gap: 8px;
    }
    .pname-card:hover { transform: translateY(-2px); border-color: var(--proj-a); }
    .pname-card.selected {
      border-color: var(--proj-a);
      box-shadow: 0 0 0 3px rgba(168,85,247,.22), 0 4px 16px rgba(168,85,247,.15);
    }
    .pname-pair { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .pname-a { font-size: .85rem; font-weight: 700; color: var(--proj-a); }
    .pname-b { font-size: .85rem; font-weight: 700; color: var(--qdr-a); }
    .pname-sep { color: var(--muted); font-size: .8rem; }
    .pname-check { color: var(--proj-a); font-size: .9rem; flex-shrink: 0; }
    .pname-card.custom-card { cursor: default; flex-direction: column; align-items: stretch; gap: 10px; grid-column: 1 / -1; margin-top: 8px; max-width: 424px; }
    .pname-card.custom-card:hover { transform: none; }
    .pname-custom-row { display: flex; flex-direction: row; align-items: center; gap: 8px; }
    .pname-custom-label { font-size: .85rem; flex-shrink: 0; }
    .pname-custom-input {
      width: 100%; box-sizing: border-box; background: var(--bg); border: 1px solid var(--border);
      border-radius: 6px; color: var(--fg); padding: 5px 8px; font-size: .85rem; font-family: inherit;
    }
    .pname-custom-input:focus { outline: none; border-color: var(--proj-a); }
    .pname-custom-set {
      width: 100%; padding: 6px; border: none; border-radius: 6px;
      background: var(--proj-a); color: #fff; font-size: .8rem; font-weight: 700;
      cursor: pointer; transition: opacity .15s;
    }
    .pname-custom-set:hover { opacity: .85; }

    .lang-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px;
      margin-top: 4px;
    }
    .lang-card {
      border-radius: var(--card-radius); border: 2px solid var(--border);
      background: var(--surface); cursor: pointer; padding: 12px 14px;
      display: flex; flex-direction: column; gap: 2px;
      transition: border-color .15s, transform .13s, box-shadow .15s;
      position: relative;
    }
    .lang-card:hover { transform: translateY(-2px); border-color: var(--proj-a); }
    .lang-card.selected {
      border-color: var(--proj-a);
      box-shadow: 0 0 0 3px rgba(168,85,247,.22), 0 4px 16px rgba(168,85,247,.15);
    }
    .lang-native { font-size: .92rem; font-weight: 800; color: var(--text); }
    .lang-eng    { font-size: .68rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: .4px; }
    .lang-check  { position: absolute; top: 10px; right: 12px; color: var(--proj-a); font-size: .85rem; font-weight: 700; }

    .data-heading {
      font-size: 1rem; font-weight: 800; letter-spacing: .5px;
      background: linear-gradient(90deg, var(--proj-a), var(--qdr-a));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .data-warning {
      background: rgba(239,68,68,.1); border: 1px solid rgba(239,68,68,.3);
      border-radius: var(--card-radius); padding: 16px 20px;
      display: flex; gap: 14px; align-items: flex-start;
    }
    .data-warning-icon { font-size: 1.3rem; flex-shrink: 0; line-height: 1.4; }
    .data-warning-text { display: flex; flex-direction: column; gap: 5px; }
    .data-warning-title { font-size: .85rem; font-weight: 800; color: #fca5a5; }
    .data-warning-body  { font-size: .8rem; color: var(--muted); line-height: 1.6; }
    .data-warning-body strong { color: var(--text); }
    .data-section {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--card-radius); padding: 22px 24px;
      display: flex; flex-direction: column; gap: 12px;
    }
    .data-section-title {
      font-size: .78rem; font-weight: 800; text-transform: uppercase;
      letter-spacing: .8px; color: var(--muted);
    }
    .data-section-desc { font-size: .8rem; color: var(--muted); line-height: 1.6; }
    .data-section-desc strong { color: var(--text); }
    .data-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .btn-data {
      font-size: .82rem; font-weight: 700; padding: 9px 22px;
      border-radius: 7px; border: none; cursor: pointer;
      transition: transform .12s, filter .12s; letter-spacing: .2px;
    }
    .btn-data:hover { transform: translateY(-1px); filter: brightness(1.1); }
    .btn-data:active { transform: translateY(0); }
    .btn-data-export { background: linear-gradient(135deg, var(--proj-a), var(--proj-b)); color: #fff; box-shadow: 0 4px 14px rgba(168,85,247,.35); }
    .btn-data-import { background: linear-gradient(135deg, var(--qdr-a), var(--qdr-b)); color: #031214; box-shadow: 0 4px 14px rgba(6,182,212,.35); }
    .data-import-label {
      font-size: .78rem; font-weight: 700; padding: 9px 22px;
      border-radius: 7px; border: 1px solid var(--border);
      background: var(--surface2); color: var(--muted);
      cursor: pointer; transition: border-color .13s, color .13s;
      white-space: nowrap;
    }
    .data-import-label:hover { border-color: var(--qdr-a); color: var(--text); }
    #import-file { display: none; }
    .data-feedback {
      font-size: .78rem; font-weight: 700; padding: 4px 0;
      display: none;
    }
    .data-feedback.ok  { color: #4ade80; display: block; }
    .data-feedback.err { color: #f87171; display: block; }
    .btn-holiday-export { background: linear-gradient(135deg, #f59e0b, #f97316); color: #fff; box-shadow: 0 4px 14px rgba(245,158,11,.35); }
    .btn-holiday-import { background: linear-gradient(135deg, #10b981, #06b6d4); color: #031214; box-shadow: 0 4px 14px rgba(16,185,129,.35); }
    .colleague-name-input {
      background: var(--bg); border: 1px solid var(--border); border-radius: 6px;
      color: var(--fg); padding: 7px 12px; font-size: .85rem; font-family: inherit;
      flex: 1; min-width: 140px;
    }
    .colleague-name-input:focus { outline: none; border-color: var(--qdr-a); }
    .data-stats {
      display: flex; gap: 10px; flex-wrap: wrap;
    }
    .data-stat {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 8px; padding: 10px 16px;
      display: flex; flex-direction: column; gap: 3px;
    }
    .data-stat-val { font-size: 1.4rem; font-weight: 800; color: var(--text); line-height: 1; }
    .data-stat-lbl { font-size: .68rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .6px; }

    /* ── Search bar ── */
    .panel-search { padding: 0 18px 10px; flex-shrink: 0; }
    .search-input {
      width: 100%; background: var(--bg); border: 1px solid var(--border);
      border-radius: 20px; color: var(--text); font-size: .78rem;
      padding: 6px 14px 6px 32px; font-family: inherit; outline: none;
      transition: border-color .15s, box-shadow .15s;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%237b82a8' stroke-width='2.5'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: 11px center;
    }
    .panel--proj .search-input:focus { border-color: var(--proj-a); box-shadow: 0 0 0 3px rgba(168,85,247,.12); }
    .panel--qdr  .search-input:focus { border-color: var(--qdr-a);  box-shadow: 0 0 0 3px rgba(6,182,212,.12);  }
    .search-empty { text-align: center; color: var(--muted); font-size: .8rem; padding: 32px 16px; }

    /* ── Todo progress bar ── */
    .todo-progress { height: 3px; border-radius: 2px; background: var(--surface2); margin: 8px 0 2px; overflow: hidden; }
    .panel--proj .todo-progress-bar { height: 100%; border-radius: 2px; background: linear-gradient(90deg, var(--proj-a), var(--proj-b)); transition: width .3s; }
    .panel--qdr  .todo-progress-bar { height: 100%; border-radius: 2px; background: linear-gradient(90deg, var(--qdr-a),  var(--qdr-b));  transition: width .3s; }

    /* ── Undo toast ── */
    .undo-toast {
      position: fixed; bottom: 28px; left: 50%; transform: translateX(-50%) translateY(80px);
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 30px; padding: 10px 16px 10px 20px;
      display: flex; align-items: center; gap: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,.45); z-index: 500;
      transition: transform .22s cubic-bezier(.34,1.56,.64,1), opacity .22s;
      opacity: 0; pointer-events: none; white-space: nowrap;
    }
    .undo-toast.visible { transform: translateX(-50%) translateY(0); opacity: 1; pointer-events: all; }
    .undo-toast-msg { font-size: .82rem; color: var(--text); }
    .undo-toast-bar {
      position: absolute; bottom: 0; left: 0; height: 3px; border-radius: 0 0 30px 30px;
      background: linear-gradient(90deg, var(--proj-a), var(--qdr-a));
      transition: width linear;
    }
    .btn-undo {
      font-size: .78rem; font-weight: 800; padding: 4px 14px;
      border-radius: 20px; border: none; cursor: pointer;
      background: linear-gradient(135deg, var(--proj-a), var(--qdr-a));
      color: #fff; letter-spacing: .2px; transition: filter .12s;
    }
    .btn-undo:hover { filter: brightness(1.15); }
    .btn-toast-close { background: none; border: none; cursor: pointer; color: var(--muted); font-size: .8rem; padding: 2px 4px; transition: color .12s; }
    .btn-toast-close:hover { color: var(--text); }

    /* ── Fortune Cookie ── */
    .fortune-wrap { display: flex; flex-direction: column; align-items: center; gap: 16px; padding: 6px 0; }
    .fortune-cookie-btn {
      font-size: 2.6rem; line-height: 1;
      background: var(--surface2); border: 2px solid var(--border);
      border-radius: 50%; width: 80px; height: 80px;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: transform .18s, border-color .18s, box-shadow .18s;
      animation: fortune-pulse 2.4s ease-in-out infinite;
    }
    .fortune-cookie-btn:hover {
      transform: scale(1.14) rotate(-8deg);
      border-color: var(--proj-a);
      box-shadow: 0 0 28px rgba(168,85,247,.45), 0 0 60px rgba(168,85,247,.15);
    }
    .fortune-cookie-btn:disabled {
      cursor: default; opacity: .55; animation: none;
      transform: none !important;
    }
    @keyframes fortune-pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(168,85,247,.0); border-color: var(--border); }
      50% { box-shadow: 0 0 0 8px rgba(168,85,247,.14), 0 0 28px rgba(168,85,247,.1); border-color: rgba(168,85,247,.5); }
    }
    .fortune-hint { font-size: .74rem; color: var(--muted); text-align: center; }
    .fortune-msg-card {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: var(--card-radius); padding: 20px 24px;
      position: relative; overflow: hidden; max-width: 520px; width: 100%; text-align: center;
    }
    .fortune-msg-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: linear-gradient(90deg, var(--proj-a), var(--proj-b), var(--qdr-a), var(--qdr-b));
    }
    .fortune-msg-text {
      font-size: .92rem; line-height: 1.75; color: var(--text);
      font-style: italic; font-weight: 500;
    }
    .fortune-open-quote { font-size: 2rem; color: var(--proj-a); line-height: 0; vertical-align: -0.45em; margin-right: 3px; font-style: normal; }
    .fortune-close-quote { font-size: 2rem; color: var(--qdr-a); line-height: 0; vertical-align: -0.45em; margin-left: 3px; font-style: normal; }
    .fortune-tomorrow { font-size: .7rem; color: var(--muted); margin-top: 10px; text-align: center; }

    /* ── About / Credits ── */
    .about-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: var(--card-radius); overflow: hidden;
    }
    .about-card-top {
      height: 4px;
      background: linear-gradient(90deg, var(--proj-a), var(--proj-b), var(--qdr-a), var(--qdr-b));
    }
    .about-card-body { padding: 22px 24px; display: flex; flex-direction: column; gap: 18px; }
    .about-sig {
      display: flex; align-items: baseline; gap: 12px;
    }
    .about-sig-name {
      font-size: 2rem; font-weight: 800; letter-spacing: 2px;
      background: linear-gradient(90deg, var(--proj-a), var(--proj-b));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      line-height: 1;
    }
    .about-sig-date { font-size: .78rem; color: var(--muted); font-weight: 600; }
    .about-ai {
      display: flex; align-items: center; gap: 10px;
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 8px; padding: 12px 16px;
    }
    .about-ai-icon { font-size: 1.4rem; flex-shrink: 0; }
    .about-ai-text { display: flex; flex-direction: column; gap: 3px; }
    .about-ai-label { font-size: .7rem; font-weight: 800; text-transform: uppercase; letter-spacing: .6px; color: var(--muted); }
    .about-ai-val   { font-size: .85rem; font-weight: 700; color: var(--text); }
    .about-license {
      border-top: 1px solid var(--border); padding-top: 14px;
      display: flex; flex-direction: column; gap: 6px;
    }
    .about-license-title { font-size: .7rem; font-weight: 800; text-transform: uppercase; letter-spacing: .6px; color: var(--muted); }
    .about-license-name  { font-size: .88rem; font-weight: 700; color: var(--text); }
    .about-license-text  { font-size: .76rem; color: var(--muted); line-height: 1.6; }
    .about-privacy {
      border-top: 1px solid var(--border); padding-top: 14px;
      display: flex; flex-direction: column; gap: 6px;
    }
    .about-privacy-row {
      display: flex; align-items: flex-start; gap: 10px;
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 8px; padding: 12px 14px;
    }
    .about-privacy-icon { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }
    .about-privacy-text { display: flex; flex-direction: column; gap: 3px; }
    .about-privacy-label { font-size: .7rem; font-weight: 800; text-transform: uppercase; letter-spacing: .6px; color: var(--muted); }
    .about-privacy-val   { font-size: .82rem; color: var(--text); line-height: 1.55; }
    .about-privacy-val strong { color: var(--text); }
    .about-privacy-val em { color: var(--muted); font-style: normal; }

    /* ── Achievements view ───────────────────────────────── */
    #view-achievements, #view-open-todos {
      flex: 1; overflow-y: auto;
      display: none; flex-direction: column;
      position: relative; z-index: 1;
    }
    .ach-scroll, .ot-scroll {
      padding: 28px 36px; max-width: 860px;
      width: 100%; margin: 0 auto;
      display: flex; flex-direction: column;
    }
    .ach-hero {
      display: flex; gap: 16px; margin-bottom: 36px;
      justify-content: center; flex-wrap: wrap;
    }
    .ach-stat-card {
      flex: 1; min-width: 140px; max-width: 220px;
      border-radius: 18px; padding: 22px 20px;
      text-align: center; color: #fff; position: relative; overflow: hidden;
    }
    .ach-stat-streak {
      background: linear-gradient(135deg, #f97316, #ef4444);
      box-shadow: 0 8px 32px rgba(249,115,22,.4), 0 2px 8px rgba(239,68,68,.3);
    }
    .ach-stat-total {
      background: linear-gradient(135deg, var(--proj-a), var(--qdr-a));
      box-shadow: 0 8px 32px rgba(168,85,247,.35), 0 2px 8px rgba(6,182,212,.3);
    }
    .ach-stat-icon  { font-size: 2rem; margin-bottom: 8px; }
    .ach-stat-num   { font-size: 3.2rem; font-weight: 900; line-height: 1; letter-spacing: -2px; }
    .ach-stat-label { font-size: .78rem; font-weight: 600; opacity: .85; text-transform: uppercase; letter-spacing: .6px; margin-top: 6px; }
    .ach-empty, .ot-empty { text-align: center; padding: 80px 20px; }
    .ach-empty-icon, .ot-empty-icon { font-size: 3.5rem; margin-bottom: 16px; }
    .ach-empty-title, .ot-empty-title { font-size: 1.3rem; font-weight: 800; color: var(--text); margin-bottom: 8px; }
    .ach-empty-sub,  .ot-empty-sub   { font-size: .9rem; color: var(--muted); }
    .ach-timeline { display: flex; flex-direction: column; gap: 28px; }
    .ach-day-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .ach-day-label  { font-size: 1rem; font-weight: 800; color: var(--text); white-space: nowrap; }
    .ach-day-sep    { flex: 1; height: 1px; background: var(--border); }
    .ach-day-badge  {
      background: linear-gradient(135deg, var(--proj-a), var(--proj-b));
      color: #fff; font-size: .7rem; font-weight: 700;
      padding: 2px 10px; border-radius: 10px; white-space: nowrap;
    }
    .ach-day-items { display: flex; flex-direction: column; gap: 8px; }
    .ach-item {
      display: flex; align-items: center; gap: 12px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 12px 16px;
      position: relative; overflow: hidden;
      transition: transform .15s, box-shadow .15s;
    }
    .ach-item:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(0,0,0,.12); }
    .ach-item::before {
      content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
      background: linear-gradient(180deg, var(--proj-a), var(--proj-b));
    }
    .ach-item--qdr::before { background: linear-gradient(180deg, var(--qdr-a), var(--qdr-b)); }
    .ach-item-check {
      width: 24px; height: 24px; border-radius: 50%; flex-shrink: 0;
      background: linear-gradient(135deg, var(--proj-a), var(--proj-b));
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: .8rem; font-weight: 700;
    }
    .ach-item--qdr .ach-item-check { background: linear-gradient(135deg, var(--qdr-a), var(--qdr-b)); }
    .ach-item-body  { flex: 1; min-width: 0; }
    .ach-item-name  { font-size: .9rem; font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .ach-item-meta  { display: flex; align-items: center; gap: 8px; margin-top: 3px; }
    .ach-panel-badge { font-size: .68rem; font-weight: 700; padding: 1px 7px; border-radius: 8px; color: #fff; }
    .ach-panel--proj { background: var(--proj-a); }
    .ach-panel--qdr  { background: var(--qdr-a); }
    .ach-todo-stat   { font-size: .72rem; color: var(--muted); }
    .ach-item-time   { font-size: .75rem; color: var(--muted); flex-shrink: 0; }

    /* ── Open Todos view ─────────────────────────────────── */
    .ot-top  { display: flex; align-items: center; gap: 16px; margin-bottom: 28px; flex-wrap: wrap; }
    .ot-stat {
      display: flex; flex-direction: column; align-items: center;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 14px 22px; min-width: 90px;
    }
    .ot-stat--overdue { border-color: #ef4444; background: rgba(239,68,68,.08); }
    .ot-stat--overdue .ot-stat-num { color: #ef4444; }
    .ot-stat-num { font-size: 2rem; font-weight: 900; color: var(--proj-a); line-height: 1; }
    .ot-stat-lbl { font-size: .72rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .5px; margin-top: 4px; }
    .ot-groups { display: flex; flex-direction: column; gap: 16px; }
    .ot-group  { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; }
    .ot-group-header {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 16px; border-bottom: 1px solid var(--border);
      background: var(--surface2); position: relative;
    }
    .ot-group-header::before {
      content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
      background: linear-gradient(180deg, var(--proj-a), var(--proj-b));
    }
    .ot-group-header--qdr::before { background: linear-gradient(180deg, var(--qdr-a), var(--qdr-b)); }
    .ot-panel-badge { font-size: .68rem; font-weight: 700; padding: 2px 8px; border-radius: 8px; color: #fff; flex-shrink: 0; }
    .ot-panel--proj { background: var(--proj-a); }
    .ot-panel--qdr  { background: var(--qdr-a); }
    .ot-item-name   { flex: 1; font-size: .88rem; font-weight: 700; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .ot-count-badge { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 1px 8px; font-size: .72rem; font-weight: 700; color: var(--muted); flex-shrink: 0; }
    .ot-todos    { display: flex; flex-direction: column; }
    .ot-todo-row { display: flex; align-items: center; gap: 10px; padding: 9px 16px; border-bottom: 1px solid var(--border); }
    .ot-todo-row:last-child { border-bottom: none; }
    .ot-todo-dot  { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; background: var(--muted); opacity: .45; }
    .ot-todo-text { flex: 1; font-size: .85rem; color: var(--text); }
    .ot-todo-date { font-size: .72rem; font-weight: 600; color: var(--muted); padding: 1px 8px; border-radius: 8px; background: var(--surface2); flex-shrink: 0; }
    .ot-todo-date.overdue   { color: #fff; background: #ef4444; }
    .ot-todo-date.due-today { color: #fff; background: #f97316; }
    .ot-todo-link { font-size: .8rem; color: var(--muted); text-decoration: none; flex-shrink: 0; }
    .ot-todo-link:hover { color: var(--proj-a); }
    .ot-goto-btn { background: none; border: 1px solid var(--border); border-radius: 8px; padding: 3px 10px; font-size: .75rem; font-weight: 700; color: var(--muted); cursor: pointer; flex-shrink: 0; transition: all .15s; }
    .ot-goto-btn:hover { border-color: var(--proj-a); color: var(--proj-a); background: rgba(168,85,247,.07); }
    .ot-group-header--qdr .ot-goto-btn:hover { border-color: var(--qdr-a); color: var(--qdr-a); background: rgba(6,182,212,.07); }
    /* Achievements: discrete todo rows */
    .ach-todos-section { margin-top: 8px; border-radius: 10px; border: 1px solid var(--border); overflow: hidden; background: var(--surface2); opacity: .85; }
    .ach-todos-header  { display: flex; align-items: center; gap: 8px; padding: 6px 12px; border-bottom: 1px solid var(--border); }
    .ach-todos-label   { font-size: .68rem; font-weight: 800; text-transform: uppercase; letter-spacing: .7px; color: var(--muted); }
    .ach-todos-count   { font-size: .68rem; font-weight: 700; color: var(--muted); background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 0 6px; }
    .ach-todo-row      { display: flex; align-items: center; gap: 8px; padding: 6px 12px; border-bottom: 1px solid var(--border); }
    .ach-todo-row:last-child { border-bottom: none; }
    .ach-todo-chk      { font-size: .7rem; color: var(--muted); flex-shrink: 0; }
    .ach-todo-txt      { flex: 1; font-size: .8rem; color: var(--text); opacity: .75; }
    .ach-todo-from     { font-size: .7rem; color: var(--muted); flex-shrink: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px; }

    /* ── Auth Screen ── */
    #auth-screen {
      position: fixed; inset: 0; z-index: 9999;
      display: flex; align-items: center; justify-content: center; flex-direction: column;
      background: var(--bg);
    }
    #auth-screen::before {
      content: ''; position: fixed; inset: 0;
      background:
        radial-gradient(ellipse 60% 50% at 20% 20%, var(--bg-glow-a) 0%, transparent 70%),
        radial-gradient(ellipse 60% 50% at 80% 80%, var(--bg-glow-b) 0%, transparent 70%),
        radial-gradient(ellipse 40% 40% at 50% 0%,  var(--bg-glow-c) 0%, transparent 60%);
      pointer-events: none;
    }
    .auth-box {
      position: relative; text-align: center;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 16px; padding: 48px 40px 36px;
      max-width: 380px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,.5);
    }
    .auth-title {
      font-size: 1.6rem; font-weight: 800; letter-spacing: 1px; margin-bottom: 8px;
      background: linear-gradient(90deg, var(--proj-a), var(--proj-b), var(--qdr-a), var(--qdr-b));
      background-size: 300% 100%;
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      animation: shimmer 4s linear infinite;
    }
    .auth-sub { color: var(--muted); font-size: .85rem; margin-bottom: 28px; line-height: 1.5; }
    .auth-btn {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 12px 28px; border-radius: 24px; border: 1px solid var(--border);
      background: var(--surface2); color: var(--text);
      font-size: .95rem; font-weight: 600; cursor: pointer;
      transition: transform .12s, box-shadow .12s, border-color .15s;
    }
    .auth-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(168,85,247,.3); border-color: var(--proj-a); }
    .auth-btn:active { transform: translateY(0); }
    .auth-btn svg { width: 20px; height: 20px; }
    .auth-error { color: var(--warn-a); font-size: .78rem; margin-top: 14px; min-height: 1.2em; }
    .auth-hidden { display: none !important; }

    /* Sign-out button in header */
    .btn-signout {
      font-size: .62rem; font-weight: 600; padding: 2px 8px;
      border-radius: 12px; border: 1px solid var(--border);
      background: transparent; color: var(--muted);
      cursor: pointer; letter-spacing: .2px;
      transition: border-color .15s, color .15s;
    }
    .btn-signout:hover { border-color: var(--warn-a); color: var(--warn-a); }
  </style>
</head>
<body>

<!-- Auth Screen — shown until Google Sign-In succeeds -->
<div id="auth-screen">
  <div class="auth-box">
    <div class="auth-title">&#9733; BabyHouse</div>
    <div class="auth-sub">Sign in to sync your board<br>across devices</div>
    <button class="auth-btn" id="auth-google-btn" onclick="doGoogleSignIn()">
      <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      Sign in with Google
    </button>
    <div class="auth-error" id="auth-error"></div>
  </div>
</div>

<header>
  <h1>&#9733; BabyHouse</h1>
  <div class="header-right">
    <div class="header-stats">
      <span class="hstat hstat-proj">&#9670; <span id="h-proj-count">0</span> <span id="h-proj-label">Projects</span></span>
      <span class="hstat hstat-qdr">&#9670; <span id="h-qdr-count">0</span> <span id="h-qdr-label">QDRs</span></span>
      <span class="hstat hstat-task">&#10003; <span id="h-task-count">0</span> <span data-i18n="h_tasks">Tasks</span></span>
    </div>
    <span class="date" id="headerDate"></span>
    <span id="sync-status"></span>
    <button class="btn-signout auth-hidden" id="btn-signout" onclick="doSignOut()">sign out</button>
  </div>
</header>

<div class="tab-bar">
  <button class="tab-btn active" data-view="board" onclick="setView('board')"><span class="tab-icon">&#128449;</span><span data-i18n="tab_board">Board</span></button>
  <button class="tab-btn" data-view="calendar" onclick="setView('calendar')"><span class="tab-icon">&#128467;</span><span data-i18n="tab_calendar">Calendar</span></button>
  <button class="tab-btn" data-view="achievements" onclick="setView('achievements')"><span class="tab-icon">&#127942;</span><span data-i18n="tab_achievements">Achievements</span></button>
  <button class="tab-btn" data-view="open-todos"   onclick="setView('open-todos')"><span class="tab-icon">&#9989;</span><span data-i18n="tab_open_todos">Pending</span></button>
  <button class="tab-btn" data-view="settings" onclick="setView('settings')"><span class="tab-icon tab-icon--gear">&#9881;</span><span data-i18n="tab_settings">Settings</span></button>
</div>

<main class="board" id="view-board">
  <section class="panel panel--proj">
    <div class="panel-stripe"></div>
    <div class="panel-header">
      <div class="panel-title"><span id="proj-title-label">&#128193; Projects</span> <span class="count-badge" id="proj-count">0</span></div>
      <button class="btn-add" id="btn-add-proj" onclick="openModal('proj')">+ Add Project</button>
    </div>
    <div class="panel-search">
      <input class="search-input" id="search-proj" type="search" placeholder="Search projects…" oninput="setSearch('proj',this.value)">
    </div>
    <div class="card-list" id="proj-list"></div>
  </section>

  <section class="panel panel--qdr">
    <div class="panel-stripe"></div>
    <div class="panel-header">
      <div class="panel-title"><span id="qdr-title-label">&#9889; QDRs</span> <span class="count-badge" id="qdr-count">0</span></div>
      <button class="btn-add" id="btn-add-qdr" onclick="openModal('qdr')">+ Add QDR</button>
    </div>
    <div class="panel-search">
      <input class="search-input" id="search-qdr" type="search" placeholder="Search QDRs…" oninput="setSearch('qdr',this.value)">
    </div>
    <div class="card-list" id="qdr-list"></div>
  </section>
</main>

<!-- Calendar view -->
<div id="view-calendar">
  <div id="cal-scroll">
    <div class="cal-toolbar">
      <button class="cal-today-btn" onclick="scrollToToday()">&#128467; Today</button>
    </div>
    <div id="cal-months-wrap"></div>
  </div>
  <div id="cal-day-detail" style="display:none" class="cal-day-detail"></div>
</div>

<!-- Settings view -->
<div id="view-settings">

  <!-- Language -->
  <div>
    <div class="settings-section-heading" data-i18n="h_lang">🌐 Language</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:8px;">
      <div class="colors-sub" data-i18n="sub_lang">Choose the display language. Saved automatically.</div>
      <div class="lang-grid" id="lang-grid"></div>
    </div>
  </div>

  <!-- Panel names -->
  <div>
    <div class="settings-section-heading" data-i18n="h_panel_names">📌 Panel Names</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:8px;">
      <div class="colors-sub" data-i18n="sub_panel_names">Choose how to label your two work panels. Saved automatically.</div>
      <div class="pname-grid" id="panel-names-grid"></div>
    </div>
  </div>

  <!-- Calendar settings -->
  <div>
    <div class="settings-section-heading">📅 Calendar</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:10px;">
      <label style="display:flex; align-items:center; gap:10px; cursor:pointer; font-size:.85rem; color:var(--text);">
        <input type="checkbox" id="cal-week-start" onchange="saveCalSettings()"
          style="width:15px;height:15px;accent-color:var(--proj-a);cursor:pointer;">
        <span data-i18n="cal_week_mon">Start week on Monday</span>
      </label>
      <label style="display:flex; align-items:center; gap:10px; cursor:pointer; font-size:.85rem; color:var(--text);">
        <input type="checkbox" id="cal-show-weeknums" onchange="saveCalSettings()" checked
          style="width:15px;height:15px;accent-color:var(--proj-a);cursor:pointer;">
        <span data-i18n="cal_show_wk_nums">Show week numbers</span>
      </label>
    </div>
  </div>

  <!-- Todo display mode -->
  <div>
    <div class="settings-section-heading" data-i18n="h_tdm">📋 To-do Visibility</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:8px;">
      <div class="colors-sub" data-i18n="sub_tdm">Choose how to-do lists are shown on each card.</div>
      <div class="tdm-grid" id="tdm-grid"></div>
    </div>
  </div>

  <!-- QDR Age Alert -->
  <div>
    <div class="settings-section-heading" id="qdr-alert-heading">&#9201; Age Alert</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:10px;">
      <div class="colors-sub" id="qdr-alert-sub">Cards older than this many days will be highlighted as aged.</div>
      <div class="target-row">
        <input class="target-days-input" id="qdr-target-days" type="number" min="1" max="999"
          value="14" onchange="saveQdrTarget(this.value)" oninput="saveQdrTarget(this.value)">
        <span class="target-days-lbl" id="qdr-alert-lbl">days until age alert</span>
      </div>
    </div>
  </div>

  <!-- Color Vision -->
  <div>
    <div class="settings-section-heading" data-i18n="h_cv">&#128065; Color Vision</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:8px;">
      <div class="colors-sub" id="cv-subtitle">Adjust colors for different types of color vision. Affects project and QDR accent colors.</div>
      <div class="cv-grid" id="cv-grid"></div>
    </div>
  </div>

  <!-- Color themes -->
  <div>
    <div class="settings-section-heading" data-i18n="h_color">🎨 Color Theme</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:12px;">
      <div class="mode-switch">
        <button class="mode-opt" id="mode-opt-light" onclick="applyColorMode('light')">☀️ Light</button>
        <button class="mode-opt" id="mode-opt-dark"  onclick="applyColorMode('dark')">🌙 Dark</button>
      </div>
      <div class="colors-sub" data-i18n="sub_color">Choose a color theme for the app. Your choice is saved automatically.</div>
      <div class="theme-grid" id="theme-grid"></div>
    </div>
  </div>

  <!-- Data & Backup -->
  <div>
    <div class="settings-section-heading" data-i18n="h_data">💾 Data &amp; Backup</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:14px;">

      <div class="data-warning">
        <span class="data-warning-icon">&#9888;</span>
        <div class="data-warning-text">
          <div class="data-warning-title" data-i18n="data_warn_title">Your data lives in the browser — back it up!</div>
          <div class="data-warning-body" data-i18n="data_warn_body">
            All your items and todos are stored in your browser's <strong>localStorage</strong>.
            The data is <strong>only on this device and this browser</strong> — it is not synced anywhere.<br><br>
            <strong>If you clear your browser's cache, cookies, or site data, all your data will be permanently lost.</strong>
            Before cleaning your browser, use the <strong>Export</strong> button to save a backup file, then reload it with <strong>Import</strong> afterwards.
          </div>
        </div>
      </div>

      <div class="data-section">
        <div class="data-section-title" data-i18n="data_current">📊 Current data</div>
        <div class="data-stats" id="data-stats"></div>
      </div>

      <div class="data-section">
        <div class="data-section-title" data-i18n="data_exp_title">⬇ Export backup</div>
        <div class="data-section-desc" data-i18n="data_exp_desc">Downloads a <strong>.json</strong> file with all your data. Keep it somewhere safe.</div>
        <div class="data-actions">
          <button class="btn-data btn-data-export" data-i18n="data_exp_btn" onclick="exportData()">⬇ Download backup</button>
        </div>
      </div>

      <div class="data-section">
        <div class="data-section-title" data-i18n="data_imp_title">⬆ Import backup</div>
        <div class="data-section-desc" data-i18n="data_imp_desc">Load a previously exported <strong>.json</strong> backup file. <strong>This will replace all current data.</strong></div>
        <div class="data-actions">
          <label class="data-import-label" for="import-file" data-i18n="data_imp_btn">📂 Choose backup file…</label>
          <input type="file" id="import-file" accept=".json" onchange="importData(event)">
        </div>
        <div class="data-feedback" id="import-feedback"></div>
      </div>

    </div>
  </div>

  <!-- Going on Holiday? -->
  <div>
    <div class="settings-section-heading">🏖 Going on Holiday?</div>
    <div style="margin-top:16px; display:flex; flex-direction:column; gap:14px;">

      <div class="data-section">
        <div class="data-section-title" data-i18n="data_share_title">⬇ Share your open tasks</div>
        <div class="data-section-desc" data-i18n="data_share_desc">Downloads a <strong>.json</strong> file with your open (not yet done) tasks. Send it to a colleague so they can cover for you.</div>
        <div class="data-actions">
          <button class="btn-data btn-holiday-export" data-i18n="data_share_btn" onclick="exportHoliday()">🏖 Export open tasks</button>
        </div>
      </div>

      <div class="data-section">
        <div class="data-section-title" data-i18n="data_imp_col_title">⬆ Import a colleague's tasks</div>
        <div class="data-section-desc" data-i18n="data_imp_col_desc">Load a colleague's open tasks into your board. Enter their name below — imported items will appear with <strong>[Name]</strong> in brackets. Your existing data is untouched.</div>
        <div class="data-actions" style="flex-wrap:wrap; gap:8px;">
          <input id="colleague-name" class="colleague-name-input" type="text" placeholder="Colleague's name…">
          <label class="data-import-label" data-i18n="data_imp_col_btn" for="colleague-file">📂 Choose tasks file…</label>
          <input type="file" id="colleague-file" accept=".json" onchange="importColleague(event)">
        </div>
        <div class="data-feedback" id="colleague-feedback"></div>
      </div>

    </div>
  </div>

  <!-- Fortune Cookie -->
  <div>
    <div class="settings-section-heading" data-i18n="h_fortune">🍪 Fortune Cookie</div>
    <div style="margin-top:16px;">
      <div class="data-section">
        <div class="data-section-desc" data-i18n="fortune_desc">One fortune per day. Crack the cookie and see what the universe has to say.</div>
        <div class="fortune-wrap" id="fortune-wrap"></div>
      </div>
    </div>
  </div>

  <!-- About / Credits -->
  <div>
    <div class="settings-section-heading" data-i18n="h_about">ℹ About</div>
    <div style="margin-top:16px;">
      <div class="about-card">
        <div class="about-card-top"></div>
        <div class="about-card-body">
          <div class="about-sig">
            <span class="about-sig-name">JGON</span>
            <span class="about-sig-date">February 2026</span>
          </div>
          <div class="about-ai">
            <span class="about-ai-icon">&#129302;</span>
            <div class="about-ai-text">
              <span class="about-ai-label" data-i18n="about_ai_lbl">Built with AI</span>
              <span class="about-ai-val">Claude Sonnet 4.6 &mdash; Anthropic</span>
            </div>
          </div>
          <div class="about-license">
            <span class="about-license-title" data-i18n="about_lic_title">License</span>
            <span class="about-license-name" data-i18n="about_lic_name">The Unlicense &mdash; Public Domain</span>
            <span class="about-license-text" data-i18n="about_lic_text">
              This is free and unencumbered software released into the public domain.
              Anyone is free to copy, modify, publish, use, compile, sell, or distribute this software,
              for any purpose, commercial or non-commercial, and by any means.
              No conditions. No attribution required. Do whatever you want with it.
            </span>
          </div>

          <div class="about-privacy">
            <span class="about-license-title" data-i18n="about_priv_title">Privacy &amp; Storage Declaration</span>
            <div class="about-privacy-row">
              <span class="about-privacy-icon">&#127358;</span>
              <div class="about-privacy-text">
                <span class="about-privacy-label" data-i18n="about_nc_lbl">No cookies</span>
                <span class="about-privacy-val" data-i18n="about_nc_val">
                  This app <strong>does not use cookies</strong> of any kind &mdash; tracking, functional, or otherwise.
                </span>
              </div>
            </div>
            <div class="about-privacy-row">
              <span class="about-privacy-icon">&#128452;</span>
              <div class="about-privacy-text">
                <span class="about-privacy-label" data-i18n="about_ls_lbl">Local storage only</span>
                <span class="about-privacy-val" data-i18n="about_ls_val">
                  All data is stored exclusively in your browser's <strong>localStorage</strong> on this device.
                  <em>Nothing is sent to any server. No network requests are made. No data leaves your browser.</em>
                </span>
              </div>
            </div>
            <div class="about-privacy-row">
              <span class="about-privacy-icon">&#128274;</span>
              <div class="about-privacy-text">
                <span class="about-privacy-label" data-i18n="about_stored_lbl">What is stored</span>
                <span class="about-privacy-val">
                  <strong>dashwork_v1</strong> &mdash; your items and todos &nbsp;&middot;&nbsp;
                  <strong>qe_theme</strong> &mdash; color theme &nbsp;&middot;&nbsp;
                  <strong>qe_panel_names</strong> &mdash; panel labels &nbsp;&middot;&nbsp;
                  <strong>qe_lang</strong> &mdash; language &nbsp;&middot;&nbsp;
                  <strong>qe_fortune</strong> &mdash; today's fortune
                </span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

</div>

<!-- Achievements view -->
<div id="view-achievements">
  <div class="ach-scroll">
    <div class="ach-hero" id="ach-stats"></div>
    <div class="ach-timeline" id="ach-timeline"></div>
  </div>
</div>

<!-- Open Todos view -->
<div id="view-open-todos">
  <div class="ot-scroll">
    <div class="ot-top" id="ot-stats"></div>
    <div class="ot-groups" id="ot-list"></div>
  </div>
</div>

<!-- Shared calendar tooltip -->
<div id="cal-tooltip"></div>

<!-- Modal -->
<div class="modal-overlay" id="modal-overlay" onclick="overlayClick(event)">
  <div class="modal proj-modal" id="modal">
    <h2 id="modal-title">Add Project</h2>

    <label><span data-i18n="modal_name_lbl">Name / Title</span>
      <input type="text" id="f-name" placeholder="e.g. Alpha Initiative or QDR-042" />
    </label>

    <!-- QDR-only fields -->
    <div id="f-qdr-fields">
      <label><span data-i18n="modal_date_lbl">Entry Date</span>
        <div class="date-input-wrap">
          <input type="date" id="f-date" />
          <button type="button" class="btn-cal" onclick="document.getElementById('f-date').showPicker()" title="Open calendar">&#128197;</button>
        </div>
      </label>
    </div>

    <label><span data-i18n="modal_desc_lbl">Description / Notes</span>
      <textarea id="f-desc" placeholder="Short description…"></textarea>
    </label>

    <div class="modal-milestone-row">
      <input type="checkbox" id="f-milestones">
      <label for="f-milestones">&#128204; Enable milestones for this item</label>
    </div>

    <label><span data-i18n="modal_link_lbl">Link (URL)</span>
      <input type="url" id="f-link" placeholder="https://…" />
    </label>

    <div class="modal-actions">
      <button class="btn btn-cancel" data-i18n="modal_cancel" onclick="closeModal()">Cancel</button>
      <button class="btn btn-save"   data-i18n="modal_save"   onclick="saveItem()">Save</button>
    </div>
  </div>
</div>

<!-- Undo toast -->
<div class="undo-toast" id="undo-toast">
  <span class="undo-toast-msg" id="undo-msg"></span>
  <button class="btn-undo" data-i18n="undo_btn" onclick="undoDelete()">Undo</button>
  <button class="btn-toast-close" onclick="dismissUndo()">&#10005;</button>
  <div class="undo-toast-bar" id="undo-bar"></div>
</div>

<!-- Confirm delete dialog -->
<div class="confirm-overlay" id="confirm-overlay">
  <div class="confirm-box">
    <h3><span id="confirm-action-word">Delete</span> &ldquo;<span id="confirm-name"></span>&rdquo;?</h3>
    <p id="confirm-body-text">This cannot be undone.</p>
    <div class="confirm-actions">
      <button class="btn btn-cancel" id="confirm-cancel-btn" onclick="closeConfirm()">Cancel</button>
      <button class="btn btn-delete" id="confirm-delete-btn" onclick="doDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- Firebase SDK (compat mode — works in a single HTML file) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>
  // ╔══════════════════════════════════════════════════════════════╗
  // ║  🔥 FIREBASE CONFIG — FILL THIS IN (see setup guide below) ║
  // ╠══════════════════════════════════════════════════════════════╣
  // ║  1. Go to https://console.firebase.google.com               ║
  // ║  2. Create a new project (any name, e.g. "baby-organizer")  ║
  // ║  3. Go to Build → Realtime Database → Create Database       ║
  // ║  4. Choose "Start in test mode" (for now)                   ║
  // ║  5. Go to Authentication → Get started → Google → Enable    ║
  // ║  6. Go to Project Settings (gear icon) → General            ║
  // ║  7. Under "Your apps", click </> (Web) → Register app       ║
  // ║  8. Copy the firebaseConfig values below                    ║
  // ╚══════════════════════════════════════════════════════════════╝
  const FIREBASE_CONFIG = {
    apiKey:            "PASTE_YOUR_API_KEY",
    authDomain:        "PASTE_YOUR_PROJECT.firebaseapp.com",
    databaseURL:       "https://PASTE_YOUR_PROJECT-default-rtdb.firebaseio.com",
    projectId:         "PASTE_YOUR_PROJECT",
    storageBucket:     "PASTE_YOUR_PROJECT.appspot.com",
    messagingSenderId: "PASTE_YOUR_SENDER_ID",
    appId:             "PASTE_YOUR_APP_ID"
  };

  // ── Sync engine ────────────────────────────────────────
  let firebaseReady = false;
  let dbRef = null;
  let _skipFirebaseWrite = false; // prevents save→listen→save loop
  let currentUser = null;

  try {
    if (FIREBASE_CONFIG.apiKey && FIREBASE_CONFIG.apiKey !== "PASTE_YOUR_API_KEY") {
      firebase.initializeApp(FIREBASE_CONFIG);
      firebaseReady = true;
    }
  } catch (e) {
    console.warn('Firebase init failed, running in offline mode:', e);
  }

  // ── Auth functions ─────────────────────────────────────
  function doGoogleSignIn() {
    if (!firebaseReady) {
      document.getElementById('auth-error').textContent = 'Firebase not configured — check FIREBASE_CONFIG';
      return;
    }
    const provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).catch(err => {
      console.warn('Sign-in error:', err);
      document.getElementById('auth-error').textContent = err.message || 'Sign-in failed. Try again.';
    });
  }

  function doSignOut() {
    if (firebaseReady) firebase.auth().signOut();
  }

  function onAuthReady(user) {
    currentUser = user;
    const authScreen = document.getElementById('auth-screen');
    const signoutBtn = document.getElementById('btn-signout');

    if (user) {
      // Signed in — connect database and start app
      dbRef = firebase.database().ref('organizer/data');
      authScreen.classList.add('auth-hidden');
      signoutBtn.classList.remove('auth-hidden');
      signoutBtn.title = user.email;
      startApp();
    } else {
      // Signed out — show login screen
      dbRef = null;
      authScreen.classList.remove('auth-hidden');
      signoutBtn.classList.add('auth-hidden');
    }
  }

  // Listen for auth state changes
  if (firebaseReady) {
    firebase.auth().onAuthStateChanged(onAuthReady);
  } else {
    // No Firebase — run offline immediately
    document.getElementById('auth-screen').classList.add('auth-hidden');
    startApp();
  }

  function _updateSyncIndicator(status) {
    const el = document.getElementById('sync-status');
    if (!el) return;
    if (!firebaseReady) { el.textContent = '⚡ offline'; el.style.color = 'var(--muted)'; return; }
    if (status === 'synced')  { el.textContent = '🟢 synced';  el.style.color = '#4ade80'; }
    if (status === 'saving')  { el.textContent = '🔄 saving…'; el.style.color = '#facc15'; }
    if (status === 'error')   { el.textContent = '🔴 error';   el.style.color = '#ef4444'; }
  }

  let data = { proj: [], qdr: [] };
  let editState = { panel: null, id: null };
  const KEY = 'dashwork_v1';
  const closedTodos      = new Set();
  const editingTodos     = new Set();
  const closedMilestones = new Set();
  let   pinnedHoverTodo  = null;
  const searchQuery  = { proj: '', qdr: '' };
  const BATCH = 15;
  const panelShown = { proj: BATCH, qdr: BATCH };

  function load() {
    // 1. Always load from localStorage first (instant, works offline)
    try { const r = localStorage.getItem(KEY); if (r) data = JSON.parse(r); } catch {}
    data.proj.forEach(p => { if (!p.todos) p.todos = []; });
    data.qdr.forEach(q => { if (!q.todos) q.todos = []; });

    // 2. If Firebase is ready, listen for real-time updates
    if (firebaseReady && dbRef) {
      dbRef.on('value', (snapshot) => {
        const remote = snapshot.val();
        if (!remote) return; // nothing in Firebase yet
        _skipFirebaseWrite = true;
        data = remote;
        data.proj = data.proj || [];
        data.qdr  = data.qdr  || [];
        data.proj.forEach(p => { if (!p.todos) p.todos = []; });
        data.qdr.forEach(q => { if (!q.todos) q.todos = []; });
        localStorage.setItem(KEY, JSON.stringify(data)); // cache locally
        renderAll();
        renderCalendar();
        renderAchievements();
        renderOpenTodos();
        _updateSyncIndicator('synced');
        _skipFirebaseWrite = false;
      }, (err) => {
        console.warn('Firebase listen error:', err);
        _updateSyncIndicator('error');
      });
    }
  }

  function save() {
    // Always save locally
    localStorage.setItem(KEY, JSON.stringify(data));

    // Push to Firebase (unless this save was triggered BY a Firebase update)
    if (firebaseReady && dbRef && !_skipFirebaseWrite) {
      _updateSyncIndicator('saving');
      dbRef.set(data)
        .then(() => _updateSyncIndicator('synced'))
        .catch((err) => { console.warn('Firebase write error:', err); _updateSyncIndicator('error'); });
    }
  }

  function updateHeaderDate() {
    document.getElementById('headerDate').textContent =
      new Date().toLocaleDateString(LANG_LOCALE[currentLang] || 'en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  }

  const STATUS_LABEL = { running:'Running', paused:'Paused', pending:'Pending', done:'Done' };

  function esc(s) {
    return String(s ?? '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
  function fmtDate(d) {
    if (!d) return '';
    const [y, m, day] = d.split('-');
    return new Date(+y, +m - 1, +day)
      .toLocaleDateString(LANG_LOCALE[currentLang] || 'en-US', { year: 'numeric', month: 'short', day: 'numeric' });
  }

  function dayCircle(dateStr) {
    if (!dateStr) return '';
    const days = Math.floor((Date.now() - new Date(dateStr + 'T00:00:00').getTime()) / 86400000);
    const frac = Math.min(days / qdrTargetDays, 1);
    const hue = Math.round(120 - frac * 120);
    const color     = `hsl(${hue},85%,22%)`;
    const textColor = `hsl(${hue},90%,72%)`;
    const glow      = `hsl(${hue},90%,50%)`;
    return `<span class="days-circle" style="background:${color};border-color:${glow};color:${textColor};box-shadow:0 0 8px ${glow}55;">
      <span class="dc-num">${days}</span><span class="dc-lbl">${days===1?t('dc_day'):t('dc_days')}</span>
    </span>`;
  }

  const TODAY = new Date().toISOString().split('T')[0];
  function todoDueClass(dueDate, done) {
    if (!dueDate || done) return '';
    if (dueDate < TODAY)   return 'overdue';
    if (dueDate === TODAY) return 'today';
    return 'future';
  }

  function renderTodos(item, panel) {
    const todos  = item.todos ?? [];
    const done   = todos.filter(t => t.done).length;
    const isOpen = todoDisplayMode === 'always'
      || (todoDisplayMode === 'hover'         &&  pinnedHoverTodo === item.id)
      || (todoDisplayMode === 'manual-open'   && !closedTodos.has(item.id))
      || (todoDisplayMode === 'manual-closed' &&  closedTodos.has(item.id));
    const id     = item.id;

    const itemsHtml = todos.map(td => {
      if (editingTodos.has(td.id)) {
        // ── Inline edit form ──
        const linkField = `<input class="todo-edit-link" type="url" id="todo-el-${td.id}" value="${esc(td.link??'')}" placeholder="${t('todo_edit_link_ph')}">`;
        return `<div class="todo-item todo-item--editing">
          <div class="todo-edit-r1">
            <input class="todo-edit-text" id="todo-et-${td.id}" value="${esc(td.text)}"
              onkeydown="if(event.key==='Enter'){event.preventDefault();saveEditTodo('${panel}','${id}','${td.id}');}
                         if(event.key==='Escape'){cancelEditTodo('${panel}','${td.id}');}">
            <div class="todo-edit-actions">
              <button class="todo-save-btn"   onclick="saveEditTodo('${panel}','${id}','${td.id}')">${t('todo_save')}</button>
              <button class="todo-cancel-btn" onclick="cancelEditTodo('${panel}','${td.id}')">${t('todo_cancel')}</button>
            </div>
          </div>
          <div class="todo-edit-r2">
            <input class="todo-edit-date" type="date" id="todo-ed-${td.id}" value="${esc(td.dueDate??'')}">
            <button type="button" class="todo-edit-cal" onclick="document.getElementById('todo-ed-${td.id}').showPicker()" title="Pick date">&#128197;</button>
            ${linkField}
          </div>
        </div>`;
      }

      // ── Static row ──
      const dc = todoDueClass(td.dueDate, td.done);
      const dueBadge = td.dueDate ? `<span class="todo-due ${dc}">&#128197; ${fmtDate(td.dueDate)}</span>` : '';
      const linkBadge = td.link
        ? `<a class="todo-item-link" href="${esc(td.link)}" target="_blank" rel="noopener">&#128279; ${t('lnk_label')}</a>`
        : '';
      return `<div class="todo-item${td.done?' done':''}${td.highlighted?' highlighted':''}">
        <button class="todo-highlight-btn${td.highlighted?' on':''}" onclick="toggleHighlight('${panel}','${id}','${td.id}')" title="${t('tip_highlight')}">&#9733;</button>
        <input class="todo-cb" type="checkbox" ${td.done?'checked':''} onchange="toggleTodo('${panel}','${id}','${td.id}')">
        <span class="todo-text">${esc(td.text)}</span>
        ${dueBadge}
        ${linkBadge}
        <button class="todo-edit-btn" onclick="startEditTodo('${panel}','${td.id}')" title="${t('tip_edit')}">&#9998;</button>
        <button class="todo-del"      onclick="deleteTodo('${panel}','${id}','${td.id}')" title="${t('tip_remove')}">&#10005;</button>
      </div>`;
    }).join('');

    const linkInputRow = `<div class="todo-add-link-row">
        <input class="todo-add-link" type="url" id="todo-l-${id}" placeholder="${t('todo_link_ph')}">
      </div>`;

    const addRow = `<div class="todo-add-row">
      <input class="todo-add-text" id="todo-t-${id}" placeholder="${t('todo_ph')}"
        onkeydown="if(event.key==='Enter'){event.preventDefault();addTodo('${panel}','${id}');}">
      <div class="todo-date-wrap">
        <input class="todo-add-date" type="date" id="todo-d-${id}">
        <button type="button" class="todo-add-cal" onclick="document.getElementById('todo-d-${id}').showPicker()" title="Pick date">&#128197;</button>
      </div>
      <button class="todo-add-btn" onclick="addTodo('${panel}','${id}')" title="Add">+</button>
    </div>
    ${linkInputRow}`;

    const isManual = todoDisplayMode === 'manual-open' || todoDisplayMode === 'manual-closed';
    const headerClick = isManual ? `onclick="toggleTodos('${id}')"` : '';
    return `<div class="todo-section${isOpen?' open':''}" id="ts-${id}">
      <div class="todo-header" ${headerClick}>
        <span class="todo-label">${t('todos_label')}</span>
        <span class="todo-summary">${done}/${todos.length}</span>
        <span class="todo-chevron">&#9660;</span>
      </div>
      <div class="todo-body">${itemsHtml}${addRow}</div>
    </div>`;
  }

  // ── Render ────────────────────────────────────────────
  function renderPanel(panel) {
    const list   = document.getElementById(`${panel}-list`);
    const count  = document.getElementById(`${panel}-count`);
    const hcount = document.getElementById(`h-${panel}-count`);
    const scroll = list.scrollTop;
    const raw    = data[panel];

    const openItems = raw.filter(i => !i.done);
    count.textContent  = openItems.length;
    hcount.textContent = openItems.length;
    const openTasks = [...data.proj, ...data.qdr]
      .filter(i => !i.done)
      .reduce((s, i) => s + (i.todos ?? []).filter(t => !t.done).length, 0);
    document.getElementById('h-task-count').textContent = openTasks;

    if (!raw.length) {
      list.innerHTML = `<div class="empty-state">${t('empty_msg', panelLabel(panel).toLowerCase())}</div>`;
      return;
    }

    // QDRs: priority items first, then by entry date asc
    let items = panel !== 'qdr' ? [...raw] : [...raw].sort((a, b) => {
      const ap = a.priority ? 1 : 0, bp = b.priority ? 1 : 0;
      if (ap !== bp) return bp - ap;
      if (a.date && b.date) return a.date < b.date ? -1 : a.date > b.date ? 1 : 0;
      if (a.date) return -1;
      if (b.date) return  1;
      return 0;
    });

    // Done items always sink to the bottom
    items = [...items.filter(i => !i.done), ...items.filter(i => i.done)];

    // Search filter (searches open and done alike)
    const q = searchQuery[panel].toLowerCase().trim();
    if (q) {
      items = items.filter(item =>
        item.name.toLowerCase().includes(q) ||
        (item.desc ?? '').toLowerCase().includes(q) ||
        (item.todos ?? []).some(td => td.text.toLowerCase().includes(q))
      );
    }

    if (!items.length) {
      list.innerHTML = `<div class="search-empty">${t('search_no_results', esc(q))}</div>`;
      return;
    }

    const sliced = items.slice(0, panelShown[panel]);

    list.innerHTML = sliced.map(item => {
      const linkDiv = item.link
        ? `<div class="card-link"><a href="${esc(item.link)}" target="_blank" rel="noopener">&#128279; ${esc(item.link)}</a></div>`
        : '';
      const priorityBtn = panel === 'qdr' && !item.done
        ? `<button class="btn-priority${item.priority ? ' is-priority' : ''}" onclick="togglePriority('${item.id}')">${item.priority ? t('btn_back_normal') : t('btn_prioritize')}</button>`
        : '';
      const completeBtn = `<button class="btn-complete${item.done ? ' is-done' : ''}" onclick="toggleItemDone('${panel}','${item.id}')">${item.done ? t('btn_reopen') : t('btn_complete')}</button>`;
      const actions = `<div class="card-actions">
        ${priorityBtn}
        ${completeBtn}
        <button class="btn-icon" onclick="editItem('${panel}','${item.id}')" title="Edit">&#9998;</button>
        <button class="btn-icon del" onclick="confirmDelete('${panel}','${item.id}')" title="Delete">&#10005;</button>
      </div>`;

      // Progress bar
      const todos = item.todos ?? [];
      const progressBar = todos.length
        ? `<div class="todo-progress"><div class="todo-progress-bar" style="width:${Math.round(todos.filter(td=>td.done).length/todos.length*100)}%"></div></div>`
        : '';

      let topContent;
      if (panel === 'proj') {
        const nm = nextMilestone(item);
        const nextMsBadge = nm ? (() => {
          const today = new Date(); today.setHours(0,0,0,0);
          const [my,mm,md] = nm.date.split('-').map(Number);
          const diff = Math.round((new Date(my,mm-1,md) - today) / 86400000);
          const cls   = diff < 0 ? 'overdue' : diff === 0 ? 'today' : '';
          const label = diff < 0 ? t('ms_overdue', Math.abs(diff)) : diff === 0 ? t('ms_today') : t('ms_in_days', diff);
          return `<span class="next-ms-badge ${cls}">&#128204; ${label} &middot; ${esc(nm.name)}</span>`;
        })() : '';
        const leftHtml = `
          <div class="card-title">${esc(item.name)}</div>
          ${progressBar}
          ${nextMsBadge ? `<div class="card-meta">${nextMsBadge}</div>` : ''}`;
        const rightHtml = item.desc
          ? `<div class="card-right"><div class="card-desc">${esc(item.desc)}</div></div>`
          : '';
        topContent = rightHtml
          ? `<div class="card-split"><div class="card-left">${leftHtml}</div>${rightHtml}</div>${linkDiv}`
          : `${leftHtml}${linkDiv}`;
      } else {
        const dateSpan = item.date
          ? `<span class="card-date">&#128203; ${t('card_entry')}: ${fmtDate(item.date)}</span>`
          : '';
        const nm = nextMilestone(item);
        const nextMsBadge = nm ? (() => {
          const today = new Date(); today.setHours(0,0,0,0);
          const [my,mm,md] = nm.date.split('-').map(Number);
          const diff = Math.round((new Date(my,mm-1,md) - today) / 86400000);
          const cls   = diff < 0 ? 'overdue' : diff === 0 ? 'today' : '';
          const label = diff < 0 ? t('ms_overdue', Math.abs(diff)) : diff === 0 ? t('ms_today') : t('ms_in_days', diff);
          return `<span class="next-ms-badge ${cls}">&#128204; ${label} &middot; ${esc(nm.name)}</span>`;
        })() : '';
        const ageDays = (() => {
          if (!item.date || item.done) return 0;
          const today = new Date(); today.setHours(0,0,0,0);
          const [y,m,d] = item.date.split('-').map(Number);
          return Math.round((today - new Date(y,m-1,d)) / 86400000);
        })();
        const ageBadge = ageDays >= qdrTargetDays
          ? `<span class="age-badge">&#9201; ${ageDays}d old</span>` : '';
        const leftHtml = `
          <div class="card-title">${esc(item.name)}</div>
          ${progressBar}
          <div class="card-meta">
            ${dayCircle(item.date)}
            ${dateSpan}
            ${nextMsBadge}
            ${ageBadge}
          </div>`;
        const rightHtml = item.desc
          ? `<div class="card-right"><div class="card-desc">${esc(item.desc)}</div></div>`
          : '';
        topContent = `
          <div class="card-split">
            <div class="card-left">${leftHtml}</div>
            ${rightHtml}
          </div>
          ${linkDiv}`;
      }

      const isDraggable = panel === 'proj' && !item.done;
      const dragHandle = isDraggable
        ? `<span class="drag-handle" title="Drag to reorder">&#8942;&#8942;</span>`
        : '';

      const priorityClass = (panel === 'qdr' && item.priority && !item.done) ? ' card--priority' : '';
      const agedClass = (() => {
        if (panel !== 'qdr' || item.done || !item.date) return '';
        const today = new Date(); today.setHours(0,0,0,0);
        const [y,m,d] = item.date.split('-').map(Number);
        return Math.round((today - new Date(y,m-1,d)) / 86400000) >= qdrTargetDays ? ' card--aged' : '';
      })();
      const doneClass = item.done ? ' card--done' : '';
      const hoverPin = todoDisplayMode === 'hover' ? ` onclick="handleCardHoverClick(event,'${item.id}')"` : '';
      return `<div class="card${priorityClass}${agedClass}${doneClass}" data-id="${item.id}"${isDraggable ? ' draggable="true"' : ''}${hoverPin}>
        <div class="card-top">
          ${dragHandle}
          <div class="card-body">${topContent}</div>
          ${actions}
        </div>
        ${renderTodos(item, panel)}
        ${item.hasMilestones ? renderMilestones(item) : ''}
      </div>`;
    }).join('');

    list.scrollTop = scroll;
    if (panel === 'proj') setupDragDrop();

    // Infinite scroll: append sentinel if more items remain
    if (items.length > sliced.length) {
      const sentinel = document.createElement('div');
      sentinel.className = 'load-sentinel';
      sentinel.innerHTML = '<span class="load-more-dots">· · ·</span>';
      list.appendChild(sentinel);
      const obs = new IntersectionObserver(entries => {
        if (entries[0].isIntersecting) {
          obs.disconnect();
          panelShown[panel] += BATCH;
          renderPanel(panel);
        }
      }, { root: list, threshold: 0.1 });
      obs.observe(sentinel);
    }
  }

  function renderAll() { renderPanel('proj'); renderPanel('qdr'); }

  // ── Drag & drop (projects) ────────────────────────────
  let dragSrcId = null;

  function setupDragDrop() {
    const list = document.getElementById('proj-list');
    list.querySelectorAll('.card:not(.card--done)').forEach(card => {
      card.addEventListener('dragstart', e => {
        dragSrcId = card.dataset.id;
        setTimeout(() => card.classList.add('dragging'), 0);
        e.dataTransfer.effectAllowed = 'move';
      });
      card.addEventListener('dragend', () => {
        card.classList.remove('dragging');
        list.querySelectorAll('.card').forEach(c => c.classList.remove('drag-over'));
        dragSrcId = null;
      });
      card.addEventListener('dragover', e => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        if (card.dataset.id !== dragSrcId) {
          list.querySelectorAll('.card').forEach(c => c.classList.remove('drag-over'));
          card.classList.add('drag-over');
        }
      });
      card.addEventListener('dragleave', e => {
        // only remove if leaving to something outside this card
        if (!card.contains(e.relatedTarget)) card.classList.remove('drag-over');
      });
      card.addEventListener('drop', e => {
        e.preventDefault();
        if (!dragSrcId || card.dataset.id === dragSrcId) return;
        const srcIdx = data.proj.findIndex(x => x.id === dragSrcId);
        const tgtIdx = data.proj.findIndex(x => x.id === card.dataset.id);
        const [moved] = data.proj.splice(srcIdx, 1);
        data.proj.splice(tgtIdx, 0, moved);
        save();
        renderPanel('proj');
      });
    });
  }

  // ── Todo actions ──────────────────────────────────────
  function toggleTodos(id) {
    if (closedTodos.has(id)) closedTodos.delete(id);
    else closedTodos.add(id);
    // find which panel this item belongs to
    const panel = data.proj.some(x => x.id === id) ? 'proj' : 'qdr';
    renderPanel(panel);
  }

  function toggleHoverPin(id) {
    pinnedHoverTodo = (pinnedHoverTodo === id) ? null : id;
    renderPanel('proj'); renderPanel('qdr');
  }

  function handleCardHoverClick(e, id) {
    if (e.target.closest('.card-actions, .todo-body, button, input, a, select, textarea')) return;
    toggleHoverPin(id);
  }

  function addTodo(panel, itemId) {
    const textEl = document.getElementById(`todo-t-${itemId}`);
    const dateEl = document.getElementById(`todo-d-${itemId}`);
    const linkEl = document.getElementById(`todo-l-${itemId}`);
    const text   = textEl?.value.trim();
    if (!text) { textEl?.focus(); return; }
    const item = data[panel].find(x => x.id === itemId);
    if (!item) return;
    if (!item.todos) item.todos = [];
    item.todos.push({
      id: crypto.randomUUID(),
      text,
      dueDate: dateEl?.value ?? '',
      link:    linkEl?.value.trim() ?? '',
      done:    false,
    });
    save(); renderPanel(panel);
  }

  function toggleTodo(panel, itemId, todoId) {
    const item = data[panel].find(x => x.id === itemId);
    const todo = item?.todos?.find(t => t.id === todoId);
    if (!todo) return;
    todo.done = !todo.done;
    if (todo.done) todo.doneAt = new Date().toISOString();
    else           delete todo.doneAt;
    save(); renderPanel(panel);
  }

  function toggleHighlight(panel, itemId, todoId) {
    const item = data[panel].find(x => x.id === itemId);
    const todo = item?.todos?.find(t => t.id === todoId);
    if (!todo) return;
    todo.highlighted = !todo.highlighted;
    save(); renderPanel(panel);
  }

  function toggleItemDone(panel, id) {
    const item = data[panel].find(x => x.id === id);
    if (!item) return;
    item.done = !item.done;
    if (item.done) item.closedAt = new Date().toISOString();
    else           delete item.closedAt;
    save(); renderPanel(panel);
  }

  // ── Milestones ────────────────────────────────────────
  function nextMilestone(item) {
    if (!item.hasMilestones || !item.milestones?.length) return null;
    const today = new Date().toISOString().split('T')[0];
    return (item.milestones)
      .filter(m => !m.done && m.date)
      .sort((a, b) => a.date < b.date ? -1 : a.date > b.date ? 1 : 0)[0] ?? null;
  }

  function renderMilestones(item) {
    const milestones = item.milestones ?? [];
    const done  = milestones.filter(m => m.done).length;
    const isOpen = !closedMilestones.has(item.id);

    const msHtml = milestones.map(m => {
      const dateStr = m.date ? fmtDate(m.date) : '';
      return `<div class="milestone-item${m.done ? ' done' : ''}">
        <input class="milestone-cb" type="checkbox" ${m.done ? 'checked' : ''}
          onchange="toggleMilestoneDone('${item.id}','${m.id}')">
        <span class="milestone-name">${esc(m.name)}</span>
        ${dateStr ? `<span class="milestone-date">&#128197; ${dateStr}</span>` : ''}
        <button class="milestone-del" onclick="deleteMilestone('${item.id}','${m.id}')">&#10005;</button>
      </div>`;
    }).join('');

    const addRow = `<div class="milestone-add-row">
      <input class="milestone-add-name" id="ms-n-${item.id}" placeholder="${t('ms_name_ph')}"
        onkeydown="if(event.key==='Enter'){event.preventDefault();addMilestone('${item.id}');}">
      <div class="ms-date-wrap">
        <input class="milestone-add-date" type="date" id="ms-d-${item.id}">
        <button type="button" class="ms-btn-cal" onclick="document.getElementById('ms-d-${item.id}').showPicker()" title="Pick date">&#128197;</button>
      </div>
      <button class="milestone-add-btn" onclick="addMilestone('${item.id}')">+</button>
    </div>`;

    return `<div class="milestone-section${isOpen ? ' open' : ''}" id="mts-${item.id}">
      <div class="milestone-header" onclick="toggleMilestones('${item.id}')">
        <span class="milestone-label">&#128204; Milestones</span>
        <span class="milestone-summary">${done}/${milestones.length}</span>
        <span class="milestone-chevron">&#9660;</span>
      </div>
      <div class="milestone-body">${msHtml}${addRow}</div>
    </div>`;
  }

  function toggleMilestones(id) {
    if (closedMilestones.has(id)) closedMilestones.delete(id);
    else closedMilestones.add(id);
    renderPanel(data.proj.some(x => x.id === id) ? 'proj' : 'qdr');
  }

  function addMilestone(itemId) {
    const nameEl = document.getElementById(`ms-n-${itemId}`);
    const dateEl = document.getElementById(`ms-d-${itemId}`);
    const name = nameEl?.value.trim();
    if (!name) { nameEl?.focus(); return; }
    const panel = data.proj.some(x => x.id === itemId) ? 'proj' : 'qdr';
    const item = data[panel].find(x => x.id === itemId);
    if (!item) return;
    if (!item.milestones) item.milestones = [];
    item.milestones.push({ id: crypto.randomUUID(), name, date: dateEl?.value ?? '', done: false });
    save(); renderPanel(panel);
  }

  function deleteMilestone(itemId, msId) {
    const panel = data.proj.some(x => x.id === itemId) ? 'proj' : 'qdr';
    const item = data[panel].find(x => x.id === itemId);
    if (!item) return;
    item.milestones = (item.milestones ?? []).filter(m => m.id !== msId);
    save(); renderPanel(panel);
  }

  function toggleMilestoneDone(itemId, msId) {
    const panel = data.proj.some(x => x.id === itemId) ? 'proj' : 'qdr';
    const item = data[panel].find(x => x.id === itemId);
    const ms   = item?.milestones?.find(m => m.id === msId);
    if (!ms) return;
    ms.done = !ms.done;
    save(); renderPanel(panel);
  }

  function deleteTodo(panel, itemId, todoId) {
    const item = data[panel].find(x => x.id === itemId);
    if (!item) return;
    item.todos = (item.todos ?? []).filter(t => t.id !== todoId);
    save(); renderPanel(panel);
  }

  function startEditTodo(panel, todoId) {
    editingTodos.add(todoId);
    renderPanel(panel);
  }

  function saveEditTodo(panel, itemId, todoId) {
    const textEl = document.getElementById(`todo-et-${todoId}`);
    const dateEl = document.getElementById(`todo-ed-${todoId}`);
    const linkEl = document.getElementById(`todo-el-${todoId}`);
    const text   = textEl?.value.trim();
    if (!text) { textEl?.focus(); return; }
    const item = data[panel].find(x => x.id === itemId);
    const todo = item?.todos?.find(t => t.id === todoId);
    if (!todo) return;
    todo.text    = text;
    todo.dueDate = dateEl?.value ?? '';
    if (linkEl) todo.link = linkEl.value.trim();
    editingTodos.delete(todoId);
    save(); renderPanel(panel);
  }

  function cancelEditTodo(panel, todoId) {
    editingTodos.delete(todoId);
    renderPanel(panel);
  }

  // ── Modal ─────────────────────────────────────────────
  let currentPanel = 'proj';

  function openModal(panel, item = null) {
    currentPanel = panel;
    editState = { panel, id: item?.id ?? null };
    const modal = document.getElementById('modal');
    modal.className = `modal ${panel}-modal`;
    document.getElementById('modal-title').textContent =
      item ? t('modal_edit', panelLabelSingular(panel)) : t('modal_new', panelLabelSingular(panel));

    // Show/hide QDR-only fields
    document.getElementById('f-qdr-fields').style.display = panel === 'qdr' ? 'contents' : 'none';

    document.getElementById('f-name').value = item?.name ?? '';
    document.getElementById('f-link').value = item?.link ?? '';
    if (panel === 'qdr') {
      document.getElementById('f-date').value = item?.date ?? '';
    }
    document.getElementById('f-desc').value       = item?.desc ?? '';
    document.getElementById('f-milestones').checked = item?.hasMilestones ?? false;

    document.getElementById('modal-overlay').classList.add('open');
    document.getElementById('f-name').focus();
  }

  function closeModal() {
    document.getElementById('modal-overlay').classList.remove('open');
    editState = { panel: null, id: null };
  }

  function overlayClick(e) {
    if (e.target === document.getElementById('modal-overlay')) closeModal();
  }

  function saveItem() {
    const name = document.getElementById('f-name').value.trim();
    if (!name) { document.getElementById('f-name').focus(); return; }
    const panel    = editState.panel || currentPanel;
    const existing = editState.id ? data[panel].find(x => x.id === editState.id) : null;

    const item = {
      id:    editState.id || crypto.randomUUID(),
      name,
      link:  document.getElementById('f-link').value.trim(),
      todos: existing?.todos ?? [],
      done:     existing?.done     ?? false,
      priority: existing?.priority ?? false,
    };

    if (panel === 'qdr') {
      item.date = document.getElementById('f-date').value;
    }
    item.desc          = document.getElementById('f-desc').value.trim();
    item.hasMilestones = document.getElementById('f-milestones').checked;
    item.milestones    = existing?.milestones ?? [];

    if (editState.id) {
      const idx = data[panel].findIndex(x => x.id === editState.id);
      if (idx !== -1) data[panel][idx] = item;
    } else {
      data[panel].push(item);
    }
    save(); renderPanel(panel); closeModal();
  }

  // ── Search ────────────────────────────────────────────
  function setSearch(panel, val) {
    searchQuery[panel] = val;
    renderPanel(panel);
  }

  // ── Undo delete ───────────────────────────────────────
  let _undoState  = null;
  let _undoTimer  = null;
  let _undoBarTimer = null;

  function showUndoToast(panel, name) {
    clearTimeout(_undoTimer);
    cancelAnimationFrame(_undoBarTimer);
    const toast = document.getElementById('undo-toast');
    const bar   = document.getElementById('undo-bar');
    document.getElementById('undo-msg').textContent = t('undo_deleted', name);
    bar.style.transition = 'none';
    bar.style.width = '100%';
    toast.classList.add('visible');
    // animate bar shrinking over 5 seconds
    requestAnimationFrame(() => {
      bar.style.transition = 'width 5s linear';
      bar.style.width = '0%';
    });
    _undoTimer = setTimeout(dismissUndo, 5000);
  }

  function dismissUndo() {
    clearTimeout(_undoTimer);
    document.getElementById('undo-toast').classList.remove('visible');
    _undoState = null;
  }

  function undoDelete() {
    if (!_undoState) return;
    const { panel, item, index } = _undoState;
    data[panel].splice(index, 0, item);
    save(); renderPanel(panel);
    dismissUndo();
  }

  function togglePriority(id) {
    const item = data.qdr.find(x => x.id === id);
    if (!item) return;
    item.priority = !item.priority;
    save(); renderPanel('qdr');
  }

  function editItem(panel, id) {
    const item = data[panel].find(x => x.id === id);
    if (item) openModal(panel, item);
  }
  let _deleteState = { panel: null, id: null };
  function confirmDelete(panel, id) {
    const item = data[panel].find(x => x.id === id);
    if (!item) return;
    _deleteState = { panel, id };
    document.getElementById('confirm-name').textContent = item.name;
    document.getElementById('confirm-overlay').classList.add('open');
  }
  function closeConfirm() {
    document.getElementById('confirm-overlay').classList.remove('open');
    _deleteState = { panel: null, id: null };
  }
  function doDelete() {
    const { panel, id } = _deleteState;
    if (!panel || !id) return;
    const index = data[panel].findIndex(x => x.id === id);
    const item  = JSON.parse(JSON.stringify(data[panel][index]));
    _undoState  = { panel, id, item, index };
    data[panel] = data[panel].filter(x => x.id !== id);
    save(); renderPanel(panel);
    closeConfirm();
    showUndoToast(panel, item.name);
  }

  document.getElementById('confirm-overlay').addEventListener('click', e => {
    if (e.target === document.getElementById('confirm-overlay')) closeConfirm();
  });

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      closeModal();
      closeConfirm();
    }
    if (e.key === 'Enter' && document.getElementById('modal-overlay').classList.contains('open'))
      if (document.activeElement.tagName !== 'TEXTAREA') saveItem();
  });

  // ── View switching ────────────────────────────────────
  let currentView = 'board';

  function setView(view) {
    currentView = view;
    document.getElementById('view-board').style.display        = view === 'board'         ? ''     : 'none';
    document.getElementById('view-calendar').style.display     = view === 'calendar'     ? 'flex' : 'none';
    document.getElementById('view-settings').style.display     = view === 'settings'     ? 'flex' : 'none';
    document.getElementById('view-achievements').style.display = view === 'achievements' ? 'flex' : 'none';
    document.getElementById('view-open-todos').style.display   = view === 'open-todos'   ? 'flex' : 'none';
    document.querySelectorAll('.tab-btn').forEach(b =>
      b.classList.toggle('active', b.dataset.view === view)
    );
    if (view === 'calendar')     renderCalendar();
    if (view === 'settings')     { renderLangGrid(); renderPanelNamesGrid(); renderTodoDisplayGrid(); renderColors(); renderColorVisionGrid(); loadQdrTarget(); loadCalSettings(); renderDataStats(); renderFortune(); }
    if (view === 'achievements') renderAchievements();
    if (view === 'open-todos')   renderOpenTodos();
  }

  // ── Calendar ──────────────────────────────────────────
  let calMonths      = [];   // [{year, month}, …] rendered months in order
  let calDeadlines   = {};
  let selectedCalDate = null;
  let _calObservers  = [];
  const CAL_LOAD     = 2;   // months to append/prepend per batch
  let calWeekStart   = 1;   // 0=Sunday, 1=Monday
  let calShowWeekNums = true;

  function isoWeekNum(year, month, day) {
    const d = new Date(year, month, day);
    d.setDate(d.getDate() + 3 - (d.getDay() + 6) % 7);
    const w1 = new Date(d.getFullYear(), 0, 4);
    return 1 + Math.round(((d - w1) / 86400000 - 3 + (w1.getDay() + 6) % 7) / 7);
  }

  function normalizeYM(year, month) {
    while (month < 0)  { month += 12; year--; }
    while (month > 11) { month -= 12; year++; }
    return { year, month };
  }

  function buildDeadlines() {
    const dl = {};
    const addTodos = (items, panel) => {
      items.forEach(item => {
        (item.todos ?? []).forEach(t => {
          if (!t.dueDate) return;
          (dl[t.dueDate] ??= []).push({ panel, itemName: item.name, todoText: t.text, done: t.done, itemDone: !!item.done });
        });
      });
    };
    addTodos(data.proj, 'proj');
    addTodos(data.qdr,  'qdr');
    return dl;
  }

  function renderMonthHTML(year, month) {
    const locale      = LANG_LOCALE[currentLang] || 'en-US';
    const label       = new Date(year, month, 1).toLocaleDateString(locale, { month: 'long', year: 'numeric' });
    const todayStr    = new Date().toISOString().split('T')[0];
    const rawFirstDay = new Date(year, month, 1).getDay(); // 0=Sun
    const firstDay    = calWeekStart === 1 ? (rawFirstDay + 6) % 7 : rawFirstDay;
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    const dayFmt = new Intl.DateTimeFormat(locale, { weekday: 'short' });
    // Build ordered day indices: if Mon start, [1,2,3,4,5,6,0]; if Sun start, [0,1,2,3,4,5,6]
    const dayOrder = calWeekStart === 1
      ? [1,2,3,4,5,6,0]
      : [0,1,2,3,4,5,6];
    // Reference dates for day names: Jan 5 2025=Sun, Jan 6=Mon, ..., Jan 11=Sat
    const refSunday = new Date(2025, 0, 5);
    const dayHeaders = dayOrder.map(dow => {
      const d = new Date(refSunday); d.setDate(refSunday.getDate() + dow);
      return `<div class="cal-day-header">${dayFmt.format(d)}</div>`;
    }).join('');

    // Build flat list of day values (null = empty)
    const allDays = [...Array(firstDay).fill(null),
                     ...Array.from({length: daysInMonth}, (_, i) => i + 1)];
    while (allDays.length % 7 !== 0) allDays.push(null);

    // Render week rows
    let cells = '';
    const weekCount = allDays.length / 7;
    for (let row = 0; row < weekCount; row++) {
      const rowDays = allDays.slice(row * 7, (row + 1) * 7);
      if (calShowWeekNums) {
        const firstRealDay = rowDays.find(d => d !== null);
        const wn = firstRealDay != null ? isoWeekNum(year, month, firstRealDay) : '';
        cells += `<div class="cal-week-num">${wn}</div>`;
      }
      rowDays.forEach(d => {
        if (d === null) { cells += '<div class="cal-cell cal-cell--empty"></div>'; return; }
        const ds     = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const events = calDeadlines[ds] ?? [];
        const projEvts = events.filter(e => e.panel === 'proj');
        const qdrEvts  = events.filter(e => e.panel === 'qdr');
        const projDot  = projEvts.length ? `<span class="cal-dot cal-dot--proj${projEvts.every(e => e.done || e.itemDone) ? ' cal-dot--faded' : ''}"></span>` : '';
        const qdrDot   = qdrEvts.length  ? `<span class="cal-dot cal-dot--qdr${qdrEvts.every(e => e.done || e.itemDone)  ? ' cal-dot--faded' : ''}"></span>` : '';
        const dots     = (projDot || qdrDot) ? `<div class="cal-dots">${projDot}${qdrDot}</div>` : '';
        const sel   = ds === selectedCalDate;
        const hover = events.length ? `onmouseenter="showCalTip(this,'${ds}')" onmouseleave="hideCalTip()"` : '';
        const click = events.length ? `onclick="selectCalDate('${ds}')"` : '';
        cells += `<div class="cal-cell${ds===todayStr?' cal-cell--today':''}${events.length?' cal-cell--has-events':''}${sel?' cal-cell--selected':''}" data-ds="${ds}" ${hover} ${click}>
          <span class="cal-day-num">${d}</span>${dots}</div>`;
      });
    }

    const wnHeader = calShowWeekNums ? '<div class="cal-week-num-header">W</div>' : '';
    const gridClass = calShowWeekNums ? 'cal-grid with-weeknums' : 'cal-grid';
    return `<div class="cal-month-section" data-ym="${year}-${month}">
      <div class="cal-section-label">${label}</div>
      <div class="${gridClass}">
        ${wnHeader}${dayHeaders}
        ${cells}
      </div>
    </div>`;
  }

  function setupCalObservers() {
    _calObservers.forEach(o => o.disconnect());
    _calObservers = [];
    const wrap      = document.getElementById('cal-months-wrap');
    const container = document.getElementById('cal-scroll');

    // Bottom sentinel → append future months
    const bot = document.createElement('div');
    bot.className = 'cal-sentinel'; bot.textContent = '· · ·';
    wrap.appendChild(bot);
    const botObs = new IntersectionObserver(entries => {
      if (!entries[0].isIntersecting) return;
      botObs.disconnect(); bot.remove();
      appendCalBatch();
    }, { root: container, threshold: 0.1 });
    botObs.observe(bot);
    _calObservers.push(botObs);

    // Top sentinel → prepend past months
    const top = document.createElement('div');
    top.className = 'cal-sentinel'; top.textContent = '· · ·';
    wrap.prepend(top);
    const topObs = new IntersectionObserver(entries => {
      if (!entries[0].isIntersecting) return;
      topObs.disconnect(); top.remove();
      prependCalBatch();
    }, { root: container, threshold: 0.1 });
    topObs.observe(top);
    _calObservers.push(topObs);
  }

  function appendCalBatch() {
    calDeadlines = buildDeadlines();
    const wrap = document.getElementById('cal-months-wrap');
    const last = calMonths[calMonths.length - 1];
    for (let i = 1; i <= CAL_LOAD; i++) {
      const ym = normalizeYM(last.year, last.month + i);
      calMonths.push(ym);
      wrap.insertAdjacentHTML('beforeend', renderMonthHTML(ym.year, ym.month));
    }
    setupCalObservers();
  }

  function prependCalBatch() {
    calDeadlines = buildDeadlines();
    const wrap      = document.getElementById('cal-months-wrap');
    const container = document.getElementById('cal-scroll');
    const first     = calMonths[0];
    const newMonths = [];
    for (let i = CAL_LOAD; i >= 1; i--) newMonths.push(normalizeYM(first.year, first.month - i));
    calMonths.unshift(...newMonths);
    const prevH = container.scrollHeight;
    newMonths.forEach(ym => wrap.insertAdjacentHTML('afterbegin', renderMonthHTML(ym.year, ym.month)));
    requestAnimationFrame(() => { container.scrollTop += container.scrollHeight - prevH; });
    setupCalObservers();
  }

  function renderCalendar() {
    calDeadlines = buildDeadlines();
    const wrap      = document.getElementById('cal-months-wrap');
    const container = document.getElementById('cal-scroll');

    if (!calMonths.length) {
      const now = new Date();
      calMonths = [
        normalizeYM(now.getFullYear(), now.getMonth() - 1),
        { year: now.getFullYear(), month: now.getMonth() },
        normalizeYM(now.getFullYear(), now.getMonth() + 1),
      ];
      wrap.innerHTML = calMonths.map(({year, month}) => renderMonthHTML(year, month)).join('');
      setupCalObservers();
      requestAnimationFrame(() => requestAnimationFrame(() => {
        const curr = wrap.querySelector(`.cal-month-section[data-ym="${now.getFullYear()}-${now.getMonth()}"]`);
        if (curr) {
          const cRect = container.getBoundingClientRect();
          const sRect = curr.getBoundingClientRect();
          const target = sRect.top - cRect.top + container.scrollTop - (container.clientHeight - sRect.height) / 2;
          container.scrollTop = Math.max(0, target);
        }
      }));
    } else {
      // Re-render existing months (data may have changed), preserve scroll
      const prevScroll = container.scrollTop;
      wrap.innerHTML = calMonths.map(({year, month}) => renderMonthHTML(year, month)).join('');
      setupCalObservers();
      container.scrollTop = prevScroll;
    }
  }

  function scrollToToday() {
    const now = new Date();
    const container = document.getElementById('cal-scroll');
    const section = document.querySelector(`.cal-month-section[data-ym="${now.getFullYear()}-${now.getMonth()}"]`);
    if (section) {
      const cRect = container.getBoundingClientRect();
      const sRect = section.getBoundingClientRect();
      const target = sRect.top - cRect.top + container.scrollTop - (container.clientHeight - sRect.height) / 2;
      container.scrollTo({ top: Math.max(0, target), behavior: 'smooth' });
    } else {
      calMonths = [];
      renderCalendar();
    }
  }

  function showCalTip(el, ds) {
    const events = calDeadlines[ds] ?? [];
    if (!events.length) return;
    const [y, m, d] = ds.split('-');
    const dateLabel = new Date(+y, +m-1, +d).toLocaleDateString(LANG_LOCALE[currentLang] || 'en-US', { weekday:'short', month:'short', day:'numeric' });

    document.getElementById('cal-tooltip').innerHTML =
      `<div class="cal-tip-date">${dateLabel}</div>` +
      events.map(e => `
        <div class="cal-tip-item">
          <span class="cal-tip-dot cal-tip-dot--${e.panel}"></span>
          <div class="cal-tip-body">
            <span class="cal-tip-parent">${esc(e.itemName)}</span>
            <span class="cal-tip-todo${e.done ? ' cal-tip-done' : ''}">${esc(e.todoText)}</span>
          </div>
        </div>`).join('');

    const tip  = document.getElementById('cal-tooltip');
    const rect = el.getBoundingClientRect();
    tip.style.display = 'block';

    // position: prefer below, flip above if not enough space
    const tipH = tip.offsetHeight;
    const spaceBelow = window.innerHeight - rect.bottom - 10;
    tip.style.top  = spaceBelow >= tipH ? `${rect.bottom + 8}px` : `${rect.top - tipH - 8}px`;

    // position: prefer right-aligned to cell, clamp to viewport
    let left = rect.left;
    if (left + tip.offsetWidth > window.innerWidth - 10) left = window.innerWidth - tip.offsetWidth - 10;
    tip.style.left = `${left}px`;
  }

  function hideCalTip() {
    document.getElementById('cal-tooltip').style.display = 'none';
  }

  // ── Calendar day detail ───────────────────────────────
  function selectCalDate(ds) {
    hideCalTip();
    document.querySelectorAll('.cal-cell--selected').forEach(el => el.classList.remove('cal-cell--selected'));
    if (selectedCalDate === ds) {
      selectedCalDate = null;
      document.getElementById('cal-day-detail').style.display = 'none';
      return;
    }
    selectedCalDate = ds;
    const cell = document.querySelector(`.cal-cell[data-ds="${ds}"]`);
    if (cell) cell.classList.add('cal-cell--selected');
    renderDayDetail(ds);
  }

  function renderDayDetail(ds) {
    const events = calDeadlines[ds] ?? [];
    const panel  = document.getElementById('cal-day-detail');
    if (!events.length) { panel.style.display = 'none'; return; }

    const [y, m, d] = ds.split('-');
    const dateLabel = new Date(+y, +m - 1, +d)
      .toLocaleDateString(LANG_LOCALE[currentLang] || 'en-US', { weekday: 'long', month: 'long', day: 'numeric' });

    panel.style.display = 'flex';
    panel.innerHTML = `
      <div class="cal-detail-header">
        <div>
          <div class="cal-detail-date">${dateLabel}</div>
          <div class="cal-detail-count">${events.length !== 1 ? t('cal_task_many', events.length) : t('cal_task_one', events.length)}</div>
        </div>
        <button class="cal-detail-close" onclick="closeCalDetail()" title="Close">&#10005;</button>
      </div>
      <div class="cal-detail-list">
        ${events.map((e, i) => `
          <div class="cal-detail-item${(e.done || e.itemDone) ? ' done' : ''}" onclick="goToTask('${e.panel}','${ds}',${i})">
            <span class="cal-detail-dot cal-detail-dot--${e.panel}"></span>
            <div class="cal-detail-body">
              <span class="cal-detail-parent">${panelLabel(e.panel)} &middot; ${esc(e.itemName)}</span>
              <span class="cal-detail-todo${(e.done || e.itemDone) ? ' done' : ''}">${esc(e.todoText)}</span>
            </div>
            <span class="cal-detail-nav">${t('cal_go')}</span>
          </div>`).join('')}
      </div>`;
  }

  function closeCalDetail() {
    selectedCalDate = null;
    document.querySelectorAll('.cal-cell--selected').forEach(el => el.classList.remove('cal-cell--selected'));
    document.getElementById('cal-day-detail').style.display = 'none';
  }

  function goToTask(panel, ds, idx) {
    const e = (calDeadlines[ds] ?? [])[idx];
    if (!e) return;
    setView('board');
    searchQuery[panel] = e.itemName;
    const input = document.getElementById('search-' + panel);
    if (input) input.value = e.itemName;
    panelShown[panel] = BATCH;
    renderPanel(panel);
    // scroll matched card into view and flash it
    requestAnimationFrame(() => {
      const list = document.getElementById(panel + '-list');
      const card = list?.querySelector('.card');
      if (card) {
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        card.classList.add('card--found');
        setTimeout(() => card.classList.remove('card--found'), 2500);
      }
    });
  }

  function goToItem(panel, id) {
    const item = (data[panel] || []).find(x => x.id === id);
    if (!item) return;
    setView('board');
    searchQuery[panel] = item.name;
    const input = document.getElementById('search-' + panel);
    if (input) input.value = item.name;
    panelShown[panel] = BATCH;
    renderPanel(panel);
    requestAnimationFrame(() => {
      const list = document.getElementById(panel + '-list');
      const card = list?.querySelector('.card');
      if (card) {
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        card.classList.add('card--found');
        setTimeout(() => card.classList.remove('card--found'), 2500);
      }
    });
  }

  // ── Themes ────────────────────────────────────────────
  const THEMES = {
    default: {
      name: 'Default',
      vars: { '--bg':'#f3f4f8','--surface':'#ffffff','--surface2':'#e8ebf3','--border':'#c8cedc',
        '--text':'#0f172a','--muted':'#64748b',
        '--proj-a':'#1e3a8a','--proj-b':'#2563eb','--qdr-a':'#134e4a','--qdr-b':'#0f766e',
        '--header-bg':'rgba(243,244,248,.94)','--tabbar-bg':'rgba(243,244,248,.90)',
        '--bg-glow-a':'rgba(30,58,138,.06)','--bg-glow-b':'rgba(19,78,74,.05)','--bg-glow-c':'rgba(37,99,235,.04)' }
    },
    light: {
      name: 'Happy',
      vars: { '--bg':'#f1f4fb','--surface':'#ffffff','--surface2':'#e8ecf6','--border':'#c8d0e8',
        '--text':'#1e2140','--muted':'#64748b',
        '--proj-a':'#7c3aed','--proj-b':'#db2777','--qdr-a':'#0284c7','--qdr-b':'#16a34a',
        '--header-bg':'rgba(241,244,251,.92)','--tabbar-bg':'rgba(241,244,251,.88)',
        '--bg-glow-a':'rgba(124,58,237,.08)','--bg-glow-b':'rgba(2,132,199,.06)','--bg-glow-c':'rgba(219,39,119,.06)' }
    },
    dark: {
      name: 'Emo',
      vars: { '--bg':'#000000','--surface':'#080808','--surface2':'#0f0f0f','--border':'#1c1c1c',
        '--text':'#e2e8f0','--muted':'#64748b',
        '--proj-a':'#8b5cf6','--proj-b':'#ec4899','--qdr-a':'#22d3ee','--qdr-b':'#86efac',
        '--header-bg':'rgba(8,8,8,.95)','--tabbar-bg':'rgba(8,8,8,.9)',
        '--bg-glow-a':'rgba(139,92,246,.10)','--bg-glow-b':'rgba(34,211,238,.08)','--bg-glow-c':'rgba(236,72,153,.07)' }
    },
    fuchsia: {
      name: 'Fuchsia',
      vars: { '--bg':'#fdf4ff','--surface':'#ffffff','--surface2':'#fae8ff','--border':'#e9d5f5',
        '--text':'#3b0764','--muted':'#a855f7',
        '--proj-a':'#a21caf','--proj-b':'#c026d3','--qdr-a':'#7e22ce','--qdr-b':'#9333ea',
        '--header-bg':'rgba(253,244,255,.94)','--tabbar-bg':'rgba(253,244,255,.90)',
        '--bg-glow-a':'rgba(162,28,175,.08)','--bg-glow-b':'rgba(126,34,206,.06)','--bg-glow-c':'rgba(192,38,211,.05)' }
    },
    ocean: {
      name: 'Ocean',
      vars: { '--bg':'#f0f8ff','--surface':'#ffffff','--surface2':'#e0f2fe','--border':'#bae6fd',
        '--text':'#0c2a4a','--muted':'#0369a1',
        '--proj-a':'#0369a1','--proj-b':'#0ea5e9','--qdr-a':'#4338ca','--qdr-b':'#6366f1',
        '--header-bg':'rgba(240,248,255,.94)','--tabbar-bg':'rgba(240,248,255,.90)',
        '--bg-glow-a':'rgba(3,105,161,.08)','--bg-glow-b':'rgba(67,56,202,.06)','--bg-glow-c':'rgba(14,165,233,.05)' }
    },
    gray: {
      name: 'Gray',
      vars: { '--bg':'#080808','--surface':'#111111','--surface2':'#1a1a1a','--border':'#282828',
        '--text':'#e5e7eb','--muted':'#6b7280',
        '--proj-a':'#9ca3af','--proj-b':'#d1d5db','--qdr-a':'#6b7280','--qdr-b':'#9ca3af',
        '--header-bg':'rgba(17,17,17,.9)','--tabbar-bg':'rgba(17,17,17,.8)',
        '--bg-glow-a':'rgba(156,163,175,.06)','--bg-glow-b':'rgba(107,114,128,.04)','--bg-glow-c':'rgba(209,213,219,.04)' }
    },
    disco: {
      name: 'Disco Inferno',
      vars: { '--bg':'#0a0906','--surface':'#141008','--surface2':'#1e1a0c','--border':'#332c10',
        '--text':'#ffd700','--muted':'#8a7830',
        '--proj-a':'#ff1493','--proj-b':'#ffee00','--qdr-a':'#00bfff','--qdr-b':'#ff6600',
        '--header-bg':'rgba(20,16,8,.93)','--tabbar-bg':'rgba(20,16,8,.86)',
        '--bg-glow-a':'rgba(255,20,147,.18)','--bg-glow-b':'rgba(0,191,255,.12)','--bg-glow-c':'rgba(255,102,0,.12)' }
    },
    coral: {
      name: 'Haunted Coral',
      vars: { '--bg':'#080400','--surface':'#120900','--surface2':'#1c1100','--border':'#301e08',
        '--text':'#ff9e9e','--muted':'#7a4e3a',
        '--proj-a':'#ff4500','--proj-b':'#40e0d0','--qdr-a':'#7cfc00','--qdr-b':'#ff69b4',
        '--header-bg':'rgba(18,9,0,.93)','--tabbar-bg':'rgba(18,9,0,.86)',
        '--bg-glow-a':'rgba(255,69,0,.18)','--bg-glow-b':'rgba(124,252,0,.10)','--bg-glow-c':'rgba(64,224,208,.10)' }
    },
    voodoo: {
      name: 'Digital Voodoo',
      vars: { '--bg':'#020106','--surface':'#07040e','--surface2':'#0e0818','--border':'#1c1030',
        '--text':'#adff2f','--muted':'#5a6a30',
        '--proj-a':'#bf00ff','--proj-b':'#ff4500','--qdr-a':'#00ced1','--qdr-b':'#ff69b4',
        '--header-bg':'rgba(7,4,14,.93)','--tabbar-bg':'rgba(7,4,14,.86)',
        '--bg-glow-a':'rgba(191,0,255,.18)','--bg-glow-b':'rgba(0,206,209,.12)','--bg-glow-c':'rgba(255,69,0,.12)' }
    },
    blackhole: {
      name: 'Black Hole',
      vars: { '--bg':'#050402','--surface':'#0e0b05','--surface2':'#1a1409','--border':'#2e2410',
        '--text':'#fff8f0','--muted':'#a07850',
        '--proj-a':'#f97316','--proj-b':'#fb923c','--qdr-a':'#fbbf24','--qdr-b':'#f59e0b',
        '--header-bg':'rgba(14,11,5,.92)','--tabbar-bg':'rgba(14,11,5,.85)',
        '--bg-glow-a':'rgba(249,115,22,.18)','--bg-glow-b':'rgba(251,191,36,.10)','--bg-glow-c':'rgba(251,146,60,.10)' }
    },
    mint: {
      name: 'Mint',
      vars: { '--bg':'#f0faf5','--surface':'#ffffff','--surface2':'#e2f5ec','--border':'#b6d9c6',
        '--text':'#1a3028','--muted':'#4a7c63',
        '--proj-a':'#059669','--proj-b':'#0d9488','--qdr-a':'#0284c7','--qdr-b':'#16a34a',
        '--header-bg':'rgba(240,250,245,.93)','--tabbar-bg':'rgba(240,250,245,.88)',
        '--bg-glow-a':'rgba(5,150,105,.09)','--bg-glow-b':'rgba(2,132,199,.07)','--bg-glow-c':'rgba(13,148,136,.06)' }
    },
    sunrise: {
      name: 'Sunrise',
      vars: { '--bg':'#fff7f0','--surface':'#ffffff','--surface2':'#feeee0','--border':'#f0c9b0',
        '--text':'#3d1f0a','--muted':'#8b5e3c',
        '--proj-a':'#ea580c','--proj-b':'#dc2626','--qdr-a':'#d97706','--qdr-b':'#ca8a04',
        '--header-bg':'rgba(255,247,240,.93)','--tabbar-bg':'rgba(255,247,240,.88)',
        '--bg-glow-a':'rgba(234,88,12,.09)','--bg-glow-b':'rgba(217,119,6,.07)','--bg-glow-c':'rgba(220,38,38,.06)' }
    },
    lavender: {
      name: 'Lavender',
      vars: { '--bg':'#f5f0ff','--surface':'#ffffff','--surface2':'#ede6ff','--border':'#cfc0f5',
        '--text':'#2d1f4a','--muted':'#7c6fa0',
        '--proj-a':'#7c3aed','--proj-b':'#9333ea','--qdr-a':'#db2777','--qdr-b':'#e879f9',
        '--header-bg':'rgba(245,240,255,.93)','--tabbar-bg':'rgba(245,240,255,.88)',
        '--bg-glow-a':'rgba(124,58,237,.09)','--bg-glow-b':'rgba(219,39,119,.07)','--bg-glow-c':'rgba(147,51,234,.06)' }
    },
    lightblue: {
      name: 'Light Blue',
      vars: { '--bg':'#f0f8ff','--surface':'#ffffff','--surface2':'#e1f0fd','--border':'#b8d9f5',
        '--text':'#0f2d4a','--muted':'#4a7fa8',
        '--proj-a':'#0369a1','--proj-b':'#0284c7','--qdr-a':'#0ea5e9','--qdr-b':'#38bdf8',
        '--header-bg':'rgba(240,248,255,.93)','--tabbar-bg':'rgba(240,248,255,.88)',
        '--bg-glow-a':'rgba(3,105,161,.09)','--bg-glow-b':'rgba(14,165,233,.07)','--bg-glow-c':'rgba(2,132,199,.06)' }
    },
    mayan: {
      name: 'Mayan Prophecy',
      vars: { '--bg':'#06080e','--surface':'#0a0f1c','--surface2':'#0f1828','--border':'#1e2a10',
        '--text':'#f5e842','--muted':'#7a8050',
        '--proj-a':'#ff003c','--proj-b':'#ff6a00','--qdr-a':'#00ffaa','--qdr-b':'#9d00ff',
        '--header-bg':'rgba(10,15,28,.93)','--tabbar-bg':'rgba(10,15,28,.86)',
        '--bg-glow-a':'rgba(255,0,60,.18)','--bg-glow-b':'rgba(0,255,170,.12)','--bg-glow-c':'rgba(157,0,255,.10)' }
    },
    plutonium: {
      name: 'Plutonium',
      vars: { '--bg':'#00080c','--surface':'#001018','--surface2':'#001a26','--border':'#003848',
        '--text':'#ccffee','--muted':'#40b090',
        '--proj-a':'#00ff41','--proj-b':'#ff006e','--qdr-a':'#ffff00','--qdr-b':'#ff6200',
        '--header-bg':'rgba(0,16,24,.93)','--tabbar-bg':'rgba(0,16,24,.86)',
        '--bg-glow-a':'rgba(0,255,65,.22)','--bg-glow-b':'rgba(255,0,110,.18)','--bg-glow-c':'rgba(255,255,0,.14)' }
    },
    rave: {
      name: 'Rave Cave',
      vars: { '--bg':'#0d0020','--surface':'#160038','--surface2':'#1e0050','--border':'#360080',
        '--text':'#ffffff','--muted':'#a880d8',
        '--proj-a':'#ff00ff','--proj-b':'#ffff00','--qdr-a':'#00ffff','--qdr-b':'#ff4400',
        '--header-bg':'rgba(22,0,56,.93)','--tabbar-bg':'rgba(22,0,56,.86)',
        '--bg-glow-a':'rgba(255,0,255,.22)','--bg-glow-b':'rgba(0,255,255,.18)','--bg-glow-c':'rgba(255,255,0,.14)' }
    },
    lemonacid: {
      name: 'Lemon Acid',
      vars: { '--bg':'#000c1a','--surface':'#001028','--surface2':'#00163c','--border':'#002860',
        '--text':'#ffff00','--muted':'#aaaa00',
        '--proj-a':'#ff00aa','--proj-b':'#aa00ff','--qdr-a':'#00ff88','--qdr-b':'#ff4400',
        '--header-bg':'rgba(0,16,40,.93)','--tabbar-bg':'rgba(0,16,40,.86)',
        '--bg-glow-a':'rgba(255,255,0,.20)','--bg-glow-b':'rgba(255,0,170,.16)','--bg-glow-c':'rgba(0,255,136,.14)' }
    }
  };

  // ── Panel name sets ───────────────────────────────────
  const PANEL_NAMES = {
    default:    { id: 'default',    proj: 'Projects', qdr: 'QDRs',      proj_s: 'Project',  qdr_s: 'QDR',     icon_proj: '&#128193;', icon_qdr: '&#9889;' },
    marathon:   { id: 'marathon',   proj: 'Marathon',  qdr: 'Sprint',   proj_s: 'Marathon', qdr_s: 'Sprint',  icon_proj: '&#127939;', icon_qdr: '&#9889;' },
    epics:      { id: 'epics',      proj: 'Epics',     qdr: 'Sprints',  proj_s: 'Epic',     qdr_s: 'Sprint',  icon_proj: '&#128203;', icon_qdr: '&#9889;' },
    goals:      { id: 'goals',      proj: 'Goals',     qdr: 'Tasks',    proj_s: 'Goal',     qdr_s: 'Task',    icon_proj: '&#127919;', icon_qdr: '&#9989;' },
    campaigns:  { id: 'campaigns',  proj: 'Campaigns', qdr: 'Missions', proj_s: 'Campaign', qdr_s: 'Mission', icon_proj: '&#128640;', icon_qdr: '&#9889;' },
    quests:     { id: 'quests',     proj: 'Quests',    qdr: 'Bounties', proj_s: 'Quest',    qdr_s: 'Bounty',  icon_proj: '&#9876;',   icon_qdr: '&#128142;' },
    yinyang:    { id: 'yinyang',    proj: 'Yin',       qdr: 'Yang',     proj_s: 'Yin',      qdr_s: 'Yang',    icon_proj: '&#9775;',   icon_qdr: '&#9775;' },
    custom:     { id: 'custom',     proj: 'Custom',    qdr: 'Custom',   proj_s: 'Custom',   qdr_s: 'Custom',  icon_proj: '&#9998;',   icon_qdr: '&#9998;' },
  };

  // ── Internationalisation ──────────────────────────────
  const LANG_LOCALE = { en:'en-US', de:'de-DE', es:'es-ES', fr:'fr-FR', it:'it-IT', zh:'zh-CN', ja:'ja-JP', ko:'ko-KR', pt:'pt-BR', hu:'hu-HU', da:'da-DK' };

  const STRINGS = {
    en: {
      tab_board:'Board', tab_calendar:'Calendar', tab_settings:'Settings',
      h_lang:'🌐 Language', sub_lang:'Choose the display language. Saved automatically.',
      h_panel_names:'📌 Panel Names', sub_panel_names:'Choose how to label your two work panels. Saved automatically.',
      h_color:'🎨 Color Theme', sub_color:'Choose a color theme for the app. Your choice is saved automatically.',
      h_data:'💾 Data & Backup', h_fortune:'🍪 Fortune Cookie', h_about:'ℹ About',
      fortune_desc:'One fortune per day. Crack the cookie and see what the universe has to say.',
      modal_name_lbl:'Name / Title', modal_date_lbl:'Entry Date', modal_desc_lbl:'Description / Notes', modal_link_lbl:'Link (URL)',
      modal_name_ph:'e.g. Alpha Initiative or QDR-042', modal_desc_ph:'Short description…', modal_link_ph:'https://…',
      modal_save:'Save', modal_cancel:'Cancel', modal_new:'New {0}', modal_edit:'Edit {0}',
      confirm_body:'This cannot be undone.', confirm_delete:'Delete', confirm_cancel:'Cancel',
      undo_deleted:'"{0}" deleted', undo_btn:'Undo',
      add_item:'+ Add {0}', search_ph:'Search {0}…',
      empty_msg:'No {0} yet.<br>Hit <strong>+ Add</strong> to create one.',
      todos_label:'✓ To-dos', todo_ph:'New to-do…', todo_link_ph:'Link (optional) https://…', todo_edit_link_ph:'Link https://…',
      todo_save:'✓ Save', todo_cancel:'✕', lnk_label:'Link', card_entry:'Entry',
      tip_highlight:'Highlight', tip_edit:'Edit', tip_remove:'Remove',
      cal_go:'→ Go', cal_task_one:'{0} task', cal_task_many:'{0} tasks',
      data_current:'📊 Current data', data_total:'Total to-dos', data_done:'Done',
      data_warn_title:'Your data lives in the browser — back it up!',
      data_warn_body:'All your items and todos are stored in your browser\'s <strong>localStorage</strong>. The data is <strong>only on this device and this browser</strong> — it is not synced anywhere.<br><br><strong>If you clear your browser\'s cache, cookies, or site data, all your data will be permanently lost.</strong> Before cleaning your browser, use the <strong>Export</strong> button to save a backup file, then reload it with <strong>Import</strong> afterwards.',
      data_exp_title:'⬇ Export backup', data_exp_desc:'Downloads a <strong>.json</strong> file with all your data. Keep it somewhere safe.', data_exp_btn:'⬇ Download backup',
      data_imp_title:'⬆ Import backup', data_imp_desc:'Load a previously exported <strong>.json</strong> backup file. <strong>This will replace all current data.</strong>', data_imp_btn:'📂 Choose backup file…',
      data_ok:'✓ Data loaded successfully!', data_err:'✕ Invalid backup file. Please choose a valid export.',
      fortune_hint:'Click the cookie for today\'s fortune', fortune_tmrw:'✨ Come back tomorrow for a new fortune',
      about_ai_lbl:'Built with AI', about_lic_title:'License', about_lic_name:'The Unlicense — Public Domain',
      about_lic_text:'This is free and unencumbered software released into the public domain. Anyone is free to copy, modify, publish, use, compile, sell, or distribute this software, for any purpose, commercial or non-commercial, and by any means. No conditions. No attribution required. Do whatever you want with it.',
      about_priv_title:'Privacy & Storage Declaration',
      about_nc_lbl:'No cookies', about_nc_val:'This app <strong>does not use cookies</strong> of any kind — tracking, functional, or otherwise.',
      about_ls_lbl:'Local storage only', about_ls_val:'All data is stored exclusively in your browser\'s <strong>localStorage</strong> on this device. <em>Nothing is sent to any server. No network requests are made. No data leaves your browser.</em>',
      about_stored_lbl:'What is stored',
      btn_prioritize:'⭐ Prioritize', btn_back_normal:'↩ Back to normal', btn_reopen:'↩ Reopen', btn_complete:'✓ Complete',
      ms_overdue:'{0}d overdue', ms_today:'Today', ms_in_days:'in {0}d',
      dc_day:'day', dc_days:'days',
      search_no_results:'No results for "{0}"',
      h_tasks:'Tasks',
      ms_name_ph:'Milestone name…',
      age_alert_title:'⏱ {0} Age Alert', age_alert_sub:'{0} cards older than this many days will be highlighted.', age_alert_lbl:'days until {0} age alert',
      cal_week_mon:'Start week on Monday', cal_show_wk_nums:'Show week numbers',
      data_share_title:'⬇ Share your open tasks', data_share_desc:'Downloads a <strong>.json</strong> file with your open tasks. Send it to a colleague so they can cover for you.', data_share_btn:'🏖 Export open tasks',
      data_imp_col_title:'⬆ Import a colleague\'s tasks', data_imp_col_desc:'Load a colleague\'s open tasks into your board. Enter their name below — imported items will appear with <strong>[Name]</strong> in brackets. Your existing data is untouched.', data_imp_col_btn:'📂 Choose tasks file…',
      col_name_ph:'Colleague\'s name…', col_import_ok_1:'✓ 1 item imported from {0}.', col_import_ok_n:'✓ {0} items imported from {1}.', col_import_err:'✕ Invalid file. Please choose a valid open-tasks export.', col_name_err:'✕ Please enter your colleague\'s name first.',
      cv_sub_text:'Adjust colors for different types of color vision. Affects {0} and {1} accent colors.',
      h_tdm:'📋 To-do Visibility', sub_tdm:'Choose how to-do lists are shown on each card.',
      h_cv:'👁 Color Vision',
      tdm_always_lbl:'Always visible', tdm_always_desc:'To-dos are always expanded on every card.',
      tdm_hover_lbl:'Hover to peek', tdm_hover_desc:'To-dos appear when hovering over the card.',
      tdm_man_open_lbl:'Manual — start open', tdm_man_open_desc:'Starts expanded. Click the corner to collapse.',
      tdm_man_closed_lbl:'Manual — start closed', tdm_man_closed_desc:'Starts collapsed. Click the corner to expand.',
      tdm_never_lbl:'Always hidden', tdm_never_desc:'To-dos are never shown on the card.',
      cv_standard_name:'Standard', cv_standard_sub:'Default colors',
      cv_deuteranopia_name:'Blue-Orange', cv_deuteranopia_sub:'Red-green color blindness',
      cv_tritanopia_name:'Rose-Teal', cv_tritanopia_sub:'Blue-yellow color blindness',
      cv_high_contrast_name:'High Contrast', cv_high_contrast_sub:'Maximum luminance contrast',
      tab_achievements:'Achievements', ach_empty_title:'Nothing closed yet', ach_empty_sub:'Close your first item or to-do to start your streak', ach_streak_label:'workday streak', ach_total_label:'items closed', ach_today:'Today', ach_yesterday:'Yesterday', ach_n_done:'{0} closed', ach_todos_done:'to-dos done',
      tab_open_todos:'Pending', ot_empty_title:'All clear!', ot_empty_sub:'No open to-dos right now', ot_overdue:'Overdue', ot_due_today:'Due today',
    },
    de: {
      tab_board:'Tafel', tab_calendar:'Kalender', tab_settings:'Einstellungen',
      h_lang:'🌐 Sprache', sub_lang:'Anzeigesprache wählen. Wird automatisch gespeichert.',
      h_panel_names:'📌 Bereichsnamen', sub_panel_names:'Bezeichnungen für die zwei Arbeitsbereiche wählen. Wird automatisch gespeichert.',
      h_color:'🎨 Farbthema', sub_color:'Farbthema für die App wählen. Wird automatisch gespeichert.',
      h_data:'💾 Daten & Backup', h_fortune:'🍪 Glückskeks', h_about:'ℹ Über',
      fortune_desc:'Ein Glücksmotto pro Tag. Klicke den Keks und sieh, was das Universum zu sagen hat.',
      modal_name_lbl:'Name / Titel', modal_date_lbl:'Eingabedatum', modal_desc_lbl:'Beschreibung / Notizen', modal_link_lbl:'Link (URL)',
      modal_name_ph:'z.B. Alpha-Initiative oder QDR-042', modal_desc_ph:'Kurze Beschreibung…', modal_link_ph:'https://…',
      modal_save:'Speichern', modal_cancel:'Abbrechen', modal_new:'Neues {0}', modal_edit:'{0} bearbeiten',
      confirm_body:'Diese Aktion kann nicht rückgängig gemacht werden.', confirm_delete:'Löschen', confirm_cancel:'Abbrechen',
      undo_deleted:'„{0}" gelöscht', undo_btn:'Rückgängig',
      add_item:'+ {0} hinzufügen', search_ph:'{0} durchsuchen…',
      empty_msg:'Noch keine {0}.<br>Klicke auf <strong>+ Hinzufügen</strong>.',
      todos_label:'✓ Aufgaben', todo_ph:'Neue Aufgabe…', todo_link_ph:'Link (optional) https://…', todo_edit_link_ph:'Link https://…',
      todo_save:'✓ Speichern', todo_cancel:'✕', lnk_label:'Link', card_entry:'Eingabe',
      tip_highlight:'Hervorheben', tip_edit:'Bearbeiten', tip_remove:'Entfernen',
      cal_go:'→ Gehe zu', cal_task_one:'{0} Aufgabe', cal_task_many:'{0} Aufgaben',
      data_current:'📊 Aktuelle Daten', data_total:'Aufgaben gesamt', data_done:'Erledigt',
      data_warn_title:'Deine Daten liegen im Browser — erstelle ein Backup!',
      data_warn_body:'Alle Einträge und Aufgaben werden in der <strong>localStorage</strong> deines Browsers gespeichert. Die Daten sind <strong>nur auf diesem Gerät und Browser</strong> vorhanden.<br><br><strong>Wenn du den Browser-Cache oder die Websitedaten leerst, gehen alle Daten dauerhaft verloren.</strong> Exportiere vorher ein Backup.',
      data_exp_title:'⬇ Backup exportieren', data_exp_desc:'Lädt eine <strong>.json</strong>-Datei mit allen Daten herunter. Bewahre sie an einem sicheren Ort auf.', data_exp_btn:'⬇ Backup herunterladen',
      data_imp_title:'⬆ Backup importieren', data_imp_desc:'Ein früheres Backup wiederherstellen. <strong>Alle aktuellen Daten werden ersetzt.</strong>', data_imp_btn:'📂 Backup-Datei wählen…',
      data_ok:'✓ Daten erfolgreich geladen!', data_err:'✕ Ungültige Backup-Datei.',
      fortune_hint:'Klicke auf den Keks für dein heutiges Motto', fortune_tmrw:'✨ Komm morgen für ein neues Glücksmotto',
      about_ai_lbl:'Mit KI erstellt', about_lic_title:'Lizenz', about_lic_name:'The Unlicense — Gemeinfrei',
      about_lic_text:'Dies ist freie und uneingeschränkte Software, die in die Gemeinfreiheit entlassen wird. Jeder darf sie für jeden Zweck kopieren, ändern, veröffentlichen, nutzen oder verkaufen, ohne Bedingungen.',
      about_priv_title:'Datenschutz- und Speichererklärung',
      about_nc_lbl:'Keine Cookies', about_nc_val:'Diese App verwendet <strong>keinerlei Cookies</strong> — weder Tracking noch funktionale.',
      about_ls_lbl:'Nur lokaler Speicher', about_ls_val:'Alle Daten werden ausschließlich in der <strong>localStorage</strong> deines Browsers gespeichert. <em>Nichts wird an Server übertragen. Keine Netzwerkanfragen.</em>',
      about_stored_lbl:'Was gespeichert wird',
      btn_prioritize:'⭐ Priorisieren', btn_back_normal:'↩ Zurück zu normal', btn_reopen:'↩ Wieder öffnen', btn_complete:'✓ Abschließen',
      ms_overdue:'{0}T überfällig', ms_today:'Heute', ms_in_days:'in {0}T',
      dc_day:'Tag', dc_days:'Tage',
      search_no_results:'Keine Ergebnisse für „{0}"',
      h_tasks:'Aufgaben',
      ms_name_ph:'Meilensteinname…',
      age_alert_title:'⏱ {0} Alterswarnung', age_alert_sub:'{0}-Karten, die älter als diese Tagesanzahl sind, werden hervorgehoben.', age_alert_lbl:'Tage bis zur {0}-Alterswarnung',
      cal_week_mon:'Woche mit Montag beginnen', cal_show_wk_nums:'Kalenderwochen anzeigen',
      data_share_title:'⬇ Offene Aufgaben teilen', data_share_desc:'Lädt eine <strong>.json</strong>-Datei mit deinen offenen Aufgaben herunter. Schick sie einem Kollegen, damit er dich vertreten kann.', data_share_btn:'🏖 Offene Aufgaben exportieren',
      data_imp_col_title:'⬆ Aufgaben eines Kollegen importieren', data_imp_col_desc:'Lade die offenen Aufgaben eines Kollegen auf dein Board. Gib ihren Namen ein — importierte Einträge erscheinen mit <strong>[Name]</strong>. Deine bestehenden Daten bleiben unberührt.', data_imp_col_btn:'📂 Aufgabendatei wählen…',
      col_name_ph:'Name des Kollegen…', col_import_ok_1:'✓ 1 Eintrag von {0} importiert.', col_import_ok_n:'✓ {0} Einträge von {1} importiert.', col_import_err:'✕ Ungültige Datei. Bitte wähle eine gültige Aufgaben-Exportdatei.', col_name_err:'✕ Bitte gib zuerst den Namen deines Kollegen ein.',
      cv_sub_text:'Farben für verschiedene Farbwahrnehmungstypen anpassen. Betrifft {0}- und {1}-Akzentfarben.',
      h_tdm:'📋 Aufgaben-Sichtbarkeit', sub_tdm:'Wähle, wie Aufgabenlisten auf den Karten angezeigt werden.',
      h_cv:'👁 Farbwahrnehmung',
      tdm_always_lbl:'Immer sichtbar', tdm_always_desc:'Aufgaben sind auf jeder Karte immer aufgeklappt.',
      tdm_hover_lbl:'Hover zum Anzeigen', tdm_hover_desc:'Aufgaben erscheinen beim Überfahren der Karte.',
      tdm_man_open_lbl:'Manuell — offen', tdm_man_open_desc:'Startet aufgeklappt. Klicke auf die Ecke zum Einklappen.',
      tdm_man_closed_lbl:'Manuell — geschlossen', tdm_man_closed_desc:'Startet eingeklappt. Klicke auf die Ecke zum Aufklappen.',
      tdm_never_lbl:'Immer versteckt', tdm_never_desc:'Aufgaben werden nie auf der Karte angezeigt.',
      cv_standard_name:'Standard', cv_standard_sub:'Standardfarben',
      cv_deuteranopia_name:'Blau-Orange', cv_deuteranopia_sub:'Rot-Grün-Sehschwäche',
      cv_tritanopia_name:'Rosa-Türkis', cv_tritanopia_sub:'Blau-Gelb-Sehschwäche',
      cv_high_contrast_name:'Hoher Kontrast', cv_high_contrast_sub:'Maximaler Helligkeitskontrast',
      tab_achievements:'Erfolge', ach_empty_title:'Noch nichts abgeschlossen', ach_empty_sub:'Schließe deinen ersten Eintrag oder eine Aufgabe, um eine Serie zu starten', ach_streak_label:'Arbeitstag-Serie', ach_total_label:'Einträge abgeschlossen', ach_today:'Heute', ach_yesterday:'Gestern', ach_n_done:'{0} abgeschlossen', ach_todos_done:'Aufgaben erledigt',
      tab_open_todos:'Ausstehend', ot_empty_title:'Alles erledigt!', ot_empty_sub:'Keine offenen Aufgaben', ot_overdue:'Überfällig', ot_due_today:'Heute fällig',
    },
    es: {
      tab_board:'Tablero', tab_calendar:'Calendario', tab_settings:'Ajustes',
      h_lang:'🌐 Idioma', sub_lang:'Elige el idioma de visualización. Se guarda automáticamente.',
      h_panel_names:'📌 Nombres de Panel', sub_panel_names:'Elige cómo etiquetar tus dos paneles de trabajo. Se guarda automáticamente.',
      h_color:'🎨 Tema de Color', sub_color:'Elige un tema de color para la app. Tu elección se guarda automáticamente.',
      h_data:'💾 Datos y Copia de Seguridad', h_fortune:'🍪 Galleta de la Fortuna', h_about:'ℹ Acerca de',
      fortune_desc:'Una fortuna por día. Abre la galleta y ve qué tiene que decirte el universo.',
      modal_name_lbl:'Nombre / Título', modal_date_lbl:'Fecha de entrada', modal_desc_lbl:'Descripción / Notas', modal_link_lbl:'Enlace (URL)',
      modal_name_ph:'ej. Iniciativa Alpha o QDR-042', modal_desc_ph:'Descripción breve…', modal_link_ph:'https://…',
      modal_save:'Guardar', modal_cancel:'Cancelar', modal_new:'Nuevo {0}', modal_edit:'Editar {0}',
      confirm_body:'Esta acción no se puede deshacer.', confirm_delete:'Eliminar', confirm_cancel:'Cancelar',
      undo_deleted:'"{0}" eliminado', undo_btn:'Deshacer',
      add_item:'+ Agregar {0}', search_ph:'Buscar {0}…',
      empty_msg:'Sin {0} todavía.<br>Pulsa <strong>+ Agregar</strong> para crear uno.',
      todos_label:'✓ Tareas', todo_ph:'Nueva tarea…', todo_link_ph:'Enlace (opcional) https://…', todo_edit_link_ph:'Enlace https://…',
      todo_save:'✓ Guardar', todo_cancel:'✕', lnk_label:'Enlace', card_entry:'Entrada',
      tip_highlight:'Resaltar', tip_edit:'Editar', tip_remove:'Eliminar',
      cal_go:'→ Ir', cal_task_one:'{0} tarea', cal_task_many:'{0} tareas',
      data_current:'📊 Datos actuales', data_total:'Total de tareas', data_done:'Hecho',
      data_warn_title:'Tus datos viven en el navegador — ¡haz una copia de seguridad!',
      data_warn_body:'Todos tus elementos y tareas se almacenan en el <strong>localStorage</strong> de tu navegador. Los datos están <strong>solo en este dispositivo y navegador</strong>.<br><br><strong>Si limpias la caché del navegador, todos tus datos se perderán permanentemente.</strong> Exporta una copia de seguridad antes.',
      data_exp_title:'⬇ Exportar copia', data_exp_desc:'Descarga un archivo <strong>.json</strong> con todos tus datos. Guárdalo en un lugar seguro.', data_exp_btn:'⬇ Descargar copia',
      data_imp_title:'⬆ Importar copia', data_imp_desc:'Restaura una copia anterior. <strong>Esto reemplazará todos los datos actuales.</strong>', data_imp_btn:'📂 Elegir archivo…',
      data_ok:'✓ ¡Datos cargados correctamente!', data_err:'✕ Archivo de copia inválido.',
      fortune_hint:'Haz clic en la galleta para tu fortuna de hoy', fortune_tmrw:'✨ Vuelve mañana para una nueva fortuna',
      about_ai_lbl:'Creado con IA', about_lic_title:'Licencia', about_lic_name:'The Unlicense — Dominio Público',
      about_lic_text:'Este es software libre e irrestricto liberado al dominio público. Cualquiera puede copiarlo, modificarlo, publicarlo, usarlo o venderlo para cualquier fin, sin condiciones.',
      about_priv_title:'Declaración de Privacidad y Almacenamiento',
      about_nc_lbl:'Sin cookies', about_nc_val:'Esta app <strong>no utiliza cookies</strong> de ningún tipo.',
      about_ls_lbl:'Solo almacenamiento local', about_ls_val:'Todos los datos se almacenan exclusivamente en el <strong>localStorage</strong> de tu navegador. <em>Nada se envía a ningún servidor.</em>',
      about_stored_lbl:'Qué se almacena',
      btn_prioritize:'⭐ Priorizar', btn_back_normal:'↩ Volver a normal', btn_reopen:'↩ Reabrir', btn_complete:'✓ Completar',
      ms_overdue:'{0}d de retraso', ms_today:'Hoy', ms_in_days:'en {0}d',
      dc_day:'día', dc_days:'días',
      search_no_results:'Sin resultados para "{0}"',
      h_tasks:'Tareas',
      ms_name_ph:'Nombre del hito…',
      age_alert_title:'⏱ Alerta antigüedad {0}', age_alert_sub:'Las tarjetas {0} más antiguas que estos días serán resaltadas.', age_alert_lbl:'días hasta la alerta antigüedad {0}',
      cal_week_mon:'Comenzar semana en lunes', cal_show_wk_nums:'Mostrar números de semana',
      data_share_title:'⬇ Compartir tareas abiertas', data_share_desc:'Descarga un archivo <strong>.json</strong> con tus tareas abiertas. Envíalo a un colega para que te cubra.', data_share_btn:'🏖 Exportar tareas abiertas',
      data_imp_col_title:'⬆ Importar tareas de un colega', data_imp_col_desc:'Carga las tareas abiertas de un colega en tu tablero. Ingresa su nombre — los elementos importados aparecerán con <strong>[Nombre]</strong>. Tus datos actuales no se modificarán.', data_imp_col_btn:'📂 Elegir archivo de tareas…',
      col_name_ph:'Nombre del colega…', col_import_ok_1:'✓ 1 elemento importado de {0}.', col_import_ok_n:'✓ {0} elementos importados de {1}.', col_import_err:'✕ Archivo inválido. Elige un archivo de exportación válido.', col_name_err:'✕ Por favor ingresa primero el nombre de tu colega.',
      cv_sub_text:'Ajusta colores para diferentes tipos de visión. Afecta los colores de {0} y {1}.',
      h_tdm:'📋 Visibilidad de Tareas', sub_tdm:'Elige cómo se muestran las listas de tareas en cada tarjeta.',
      h_cv:'👁 Visión de Color',
      tdm_always_lbl:'Siempre visible', tdm_always_desc:'Las tareas siempre están expandidas en cada tarjeta.',
      tdm_hover_lbl:'Hover para ver', tdm_hover_desc:'Las tareas aparecen al pasar el cursor sobre la tarjeta.',
      tdm_man_open_lbl:'Manual — empieza abierto', tdm_man_open_desc:'Empieza expandido. Haz clic en la esquina para colapsar.',
      tdm_man_closed_lbl:'Manual — empieza cerrado', tdm_man_closed_desc:'Empieza colapsado. Haz clic en la esquina para expandir.',
      tdm_never_lbl:'Siempre oculto', tdm_never_desc:'Las tareas nunca se muestran en la tarjeta.',
      cv_standard_name:'Estándar', cv_standard_sub:'Colores predeterminados',
      cv_deuteranopia_name:'Azul-Naranja', cv_deuteranopia_sub:'Daltonismo rojo-verde',
      cv_tritanopia_name:'Rosa-Verde azulado', cv_tritanopia_sub:'Daltonismo azul-amarillo',
      cv_high_contrast_name:'Alto Contraste', cv_high_contrast_sub:'Máximo contraste de luminancia',
      tab_achievements:'Logros', ach_empty_title:'Nada cerrado aún', ach_empty_sub:'Cierra tu primer elemento o tarea para comenzar tu racha', ach_streak_label:'días laborables', ach_total_label:'elementos cerrados', ach_today:'Hoy', ach_yesterday:'Ayer', ach_n_done:'{0} cerrados', ach_todos_done:'tareas hechas',
      tab_open_todos:'Pendientes', ot_empty_title:'¡Todo al día!', ot_empty_sub:'Sin tareas pendientes ahora mismo', ot_overdue:'Atrasado', ot_due_today:'Vence hoy',
    },
    fr: {
      tab_board:'Tableau', tab_calendar:'Calendrier', tab_settings:'Paramètres',
      h_lang:'🌐 Langue', sub_lang:'Choisissez la langue d\'affichage. Sauvegardé automatiquement.',
      h_panel_names:'📌 Noms des panneaux', sub_panel_names:'Choisissez comment nommer vos deux panneaux. Sauvegardé automatiquement.',
      h_color:'🎨 Thème de couleur', sub_color:'Choisissez un thème de couleur. Votre choix est sauvegardé automatiquement.',
      h_data:'💾 Données & Sauvegarde', h_fortune:'🍪 Cookie de Fortune', h_about:'ℹ À propos',
      fortune_desc:'Une fortune par jour. Craquez le cookie et voyez ce que l\'univers a à vous dire.',
      modal_name_lbl:'Nom / Titre', modal_date_lbl:'Date d\'entrée', modal_desc_lbl:'Description / Notes', modal_link_lbl:'Lien (URL)',
      modal_name_ph:'ex. Initiative Alpha ou QDR-042', modal_desc_ph:'Courte description…', modal_link_ph:'https://…',
      modal_save:'Enregistrer', modal_cancel:'Annuler', modal_new:'Nouveau {0}', modal_edit:'Modifier {0}',
      confirm_body:'Cette action est irréversible.', confirm_delete:'Supprimer', confirm_cancel:'Annuler',
      undo_deleted:'« {0} » supprimé', undo_btn:'Annuler',
      add_item:'+ Ajouter {0}', search_ph:'Rechercher {0}…',
      empty_msg:'Aucun {0} pour l\'instant.<br>Cliquez sur <strong>+ Ajouter</strong>.',
      todos_label:'✓ Tâches', todo_ph:'Nouvelle tâche…', todo_link_ph:'Lien (optionnel) https://…', todo_edit_link_ph:'Lien https://…',
      todo_save:'✓ Enregistrer', todo_cancel:'✕', lnk_label:'Lien', card_entry:'Entrée',
      tip_highlight:'Mettre en avant', tip_edit:'Modifier', tip_remove:'Supprimer',
      cal_go:'→ Aller', cal_task_one:'{0} tâche', cal_task_many:'{0} tâches',
      data_current:'📊 Données actuelles', data_total:'Tâches totales', data_done:'Fait',
      data_warn_title:'Vos données sont dans le navigateur — sauvegardez-les !',
      data_warn_body:'Tous vos éléments et tâches sont stockés dans le <strong>localStorage</strong> de votre navigateur. Les données sont <strong>uniquement sur cet appareil</strong>.<br><br><strong>Si vous effacez le cache du navigateur, toutes vos données seront définitivement perdues.</strong> Exportez une sauvegarde au préalable.',
      data_exp_title:'⬇ Exporter', data_exp_desc:'Télécharge un fichier <strong>.json</strong> avec toutes vos données. Gardez-le en lieu sûr.', data_exp_btn:'⬇ Télécharger la sauvegarde',
      data_imp_title:'⬆ Importer', data_imp_desc:'Restaure une sauvegarde. <strong>Cela remplacera toutes les données actuelles.</strong>', data_imp_btn:'📂 Choisir un fichier…',
      data_ok:'✓ Données chargées avec succès !', data_err:'✕ Fichier de sauvegarde invalide.',
      fortune_hint:'Cliquez sur le cookie pour votre fortune du jour', fortune_tmrw:'✨ Revenez demain pour une nouvelle fortune',
      about_ai_lbl:'Créé avec l\'IA', about_lic_title:'Licence', about_lic_name:'The Unlicense — Domaine Public',
      about_lic_text:'Ce logiciel est versé dans le domaine public. Chacun est libre de le copier, modifier, publier, utiliser ou vendre à toutes fins, sans conditions.',
      about_priv_title:'Déclaration de confidentialité et de stockage',
      about_nc_lbl:'Aucun cookie', about_nc_val:'Cette app <strong>n\'utilise aucun cookie</strong> — ni de suivi ni fonctionnel.',
      about_ls_lbl:'Stockage local uniquement', about_ls_val:'Toutes les données sont stockées dans le <strong>localStorage</strong> de votre navigateur. <em>Rien n\'est envoyé à un serveur.</em>',
      about_stored_lbl:'Ce qui est stocké',
      btn_prioritize:'⭐ Prioriser', btn_back_normal:'↩ Retour à la normale', btn_reopen:'↩ Rouvrir', btn_complete:'✓ Terminer',
      ms_overdue:'{0}j de retard', ms_today:'Aujourd\'hui', ms_in_days:'dans {0}j',
      dc_day:'jour', dc_days:'jours',
      search_no_results:'Aucun résultat pour « {0} »',
      h_tasks:'Tâches',
      ms_name_ph:'Nom du jalon…',
      age_alert_title:'⏱ Alerte ancienneté {0}', age_alert_sub:'Les cartes {0} plus anciennes que ce nombre de jours seront mises en évidence.', age_alert_lbl:'jours avant l\'alerte ancienneté {0}',
      cal_week_mon:'Commencer la semaine le lundi', cal_show_wk_nums:'Afficher les numéros de semaine',
      data_share_title:'⬇ Partager les tâches ouvertes', data_share_desc:'Télécharge un fichier <strong>.json</strong> avec vos tâches ouvertes. Envoyez-le à un collègue pour qu\'il vous remplace.', data_share_btn:'🏖 Exporter les tâches ouvertes',
      data_imp_col_title:'⬆ Importer les tâches d\'un collègue', data_imp_col_desc:'Chargez les tâches ouvertes d\'un collègue dans votre tableau. Entrez son nom — les éléments importés apparaîtront avec <strong>[Nom]</strong>. Vos données existantes ne seront pas modifiées.', data_imp_col_btn:'📂 Choisir un fichier de tâches…',
      col_name_ph:'Nom du collègue…', col_import_ok_1:'✓ 1 élément importé de {0}.', col_import_ok_n:'✓ {0} éléments importés de {1}.', col_import_err:'✕ Fichier invalide. Choisissez un fichier d\'export valide.', col_name_err:'✕ Veuillez d\'abord saisir le nom de votre collègue.',
      cv_sub_text:'Ajuster les couleurs pour différents types de vision. Affecte les couleurs de {0} et {1}.',
      h_tdm:'📋 Visibilité des Tâches', sub_tdm:'Choisissez comment les listes de tâches sont affichées sur chaque carte.',
      h_cv:'👁 Vision des Couleurs',
      tdm_always_lbl:'Toujours visible', tdm_always_desc:'Les tâches sont toujours dépliées sur chaque carte.',
      tdm_hover_lbl:'Survol pour aperçu', tdm_hover_desc:'Les tâches apparaissent au survol de la carte.',
      tdm_man_open_lbl:'Manuel — démarrer ouvert', tdm_man_open_desc:'Démarre déplié. Cliquez sur le coin pour replier.',
      tdm_man_closed_lbl:'Manuel — démarrer fermé', tdm_man_closed_desc:'Démarre replié. Cliquez sur le coin pour déplier.',
      tdm_never_lbl:'Toujours caché', tdm_never_desc:'Les tâches ne sont jamais affichées sur la carte.',
      cv_standard_name:'Standard', cv_standard_sub:'Couleurs par défaut',
      cv_deuteranopia_name:'Bleu-Orange', cv_deuteranopia_sub:'Daltonisme rouge-vert',
      cv_tritanopia_name:'Rose-Sarcelle', cv_tritanopia_sub:'Daltonisme bleu-jaune',
      cv_high_contrast_name:'Contraste Élevé', cv_high_contrast_sub:'Contraste de luminance maximal',
      tab_achievements:'Succès', ach_empty_title:'Rien de clôturé pour l\'instant', ach_empty_sub:'Clôture ton premier élément ou tâche pour démarrer une série', ach_streak_label:'jours ouvrés', ach_total_label:'éléments clôturés', ach_today:'Aujourd\'hui', ach_yesterday:'Hier', ach_n_done:'{0} clôturés', ach_todos_done:'tâches faites',
      tab_open_todos:'En attente', ot_empty_title:'Tout est fait !', ot_empty_sub:'Aucune tâche en attente pour l\'instant', ot_overdue:'En retard', ot_due_today:'Dû aujourd\'hui',
    },
    it: {
      tab_board:'Bacheca', tab_calendar:'Calendario', tab_settings:'Impostazioni',
      h_lang:'🌐 Lingua', sub_lang:'Scegli la lingua di visualizzazione. Salvata automaticamente.',
      h_panel_names:'📌 Nomi Pannello', sub_panel_names:'Scegli come denominare i tuoi due pannelli. Salvato automaticamente.',
      h_color:'🎨 Tema Colore', sub_color:'Scegli un tema colore per l\'app. La scelta viene salvata automaticamente.',
      h_data:'💾 Dati & Backup', h_fortune:'🍪 Biscotto della Fortuna', h_about:'ℹ Informazioni',
      fortune_desc:'Una fortuna al giorno. Rompi il biscotto e scopri cosa ha da dirti l\'universo.',
      modal_name_lbl:'Nome / Titolo', modal_date_lbl:'Data di inserimento', modal_desc_lbl:'Descrizione / Note', modal_link_lbl:'Link (URL)',
      modal_name_ph:'es. Iniziativa Alpha o QDR-042', modal_desc_ph:'Breve descrizione…', modal_link_ph:'https://…',
      modal_save:'Salva', modal_cancel:'Annulla', modal_new:'Nuovo {0}', modal_edit:'Modifica {0}',
      confirm_body:'Questa azione non può essere annullata.', confirm_delete:'Elimina', confirm_cancel:'Annulla',
      undo_deleted:'"{0}" eliminato', undo_btn:'Annulla',
      add_item:'+ Aggiungi {0}', search_ph:'Cerca {0}…',
      empty_msg:'Nessun {0} ancora.<br>Clicca <strong>+ Aggiungi</strong> per crearne uno.',
      todos_label:'✓ Attività', todo_ph:'Nuova attività…', todo_link_ph:'Link (opzionale) https://…', todo_edit_link_ph:'Link https://…',
      todo_save:'✓ Salva', todo_cancel:'✕', lnk_label:'Link', card_entry:'Inserimento',
      tip_highlight:'Evidenzia', tip_edit:'Modifica', tip_remove:'Rimuovi',
      cal_go:'→ Vai', cal_task_one:'{0} attività', cal_task_many:'{0} attività',
      data_current:'📊 Dati attuali', data_total:'Attività totali', data_done:'Fatto',
      data_warn_title:'I tuoi dati sono nel browser — esegui un backup!',
      data_warn_body:'Tutti i tuoi elementi e attività sono memorizzati nel <strong>localStorage</strong> del browser. I dati sono <strong>solo su questo dispositivo e browser</strong>.<br><br><strong>Se svuoti la cache del browser, tutti i dati andranno persi definitivamente.</strong> Prima di pulire il browser, usa il pulsante <strong>Esporta</strong> per salvare un backup, poi ricaricalo con <strong>Importa</strong>.',
      data_exp_title:'⬇ Esporta backup', data_exp_desc:'Scarica un file <strong>.json</strong> con tutti i tuoi dati. Conservalo in un posto sicuro.', data_exp_btn:'⬇ Scarica backup',
      data_imp_title:'⬆ Importa backup', data_imp_desc:'Carica un backup esportato in precedenza. <strong>Questo sostituirà tutti i dati attuali.</strong>', data_imp_btn:'📂 Scegli file di backup…',
      data_ok:'✓ Dati caricati con successo!', data_err:'✕ File di backup non valido.',
      fortune_hint:'Clicca il biscotto per la fortuna di oggi', fortune_tmrw:'✨ Torna domani per una nuova fortuna',
      about_ai_lbl:'Creato con IA', about_lic_title:'Licenza', about_lic_name:'The Unlicense — Dominio Pubblico',
      about_lic_text:'Questo è software libero e senza restrizioni rilasciato nel dominio pubblico. Chiunque è libero di copiarlo, modificarlo, pubblicarlo, usarlo o venderlo per qualsiasi scopo, senza condizioni.',
      about_priv_title:'Dichiarazione sulla Privacy e Archiviazione',
      about_nc_lbl:'Nessun cookie', about_nc_val:'Questa app <strong>non utilizza cookie</strong> di alcun tipo — né di tracciamento né funzionali.',
      about_ls_lbl:'Solo archiviazione locale', about_ls_val:'Tutti i dati sono memorizzati esclusivamente nel <strong>localStorage</strong> del browser. <em>Nulla viene inviato a server. Nessuna richiesta di rete. Nessun dato lascia il browser.</em>',
      about_stored_lbl:'Cosa viene memorizzato',
      btn_prioritize:'⭐ Priorità', btn_back_normal:'↩ Torna a normale', btn_reopen:'↩ Riapri', btn_complete:'✓ Completa',
      ms_overdue:'{0}g di ritardo', ms_today:'Oggi', ms_in_days:'tra {0}g',
      dc_day:'giorno', dc_days:'giorni',
      search_no_results:'Nessun risultato per "{0}"',
      h_tasks:'Attività',
      ms_name_ph:'Nome pietra miliare…',
      age_alert_title:'⏱ Avviso età {0}', age_alert_sub:'Le schede {0} più vecchie di questi giorni verranno evidenziate.', age_alert_lbl:'giorni prima dell\'avviso età {0}',
      cal_week_mon:'Inizia la settimana di lunedì', cal_show_wk_nums:'Mostra numeri settimana',
      data_share_title:'⬇ Condividi le attività aperte', data_share_desc:'Scarica un file <strong>.json</strong> con le tue attività aperte. Invialo a un collega per sostituirti.', data_share_btn:'🏖 Esporta attività aperte',
      data_imp_col_title:'⬆ Importa le attività di un collega', data_imp_col_desc:'Carica le attività aperte di un collega nella tua bacheca. Inserisci il suo nome — gli elementi importati appariranno con <strong>[Nome]</strong>. I tuoi dati esistenti non verranno modificati.', data_imp_col_btn:'📂 Scegli file attività…',
      col_name_ph:'Nome del collega…', col_import_ok_1:'✓ 1 elemento importato da {0}.', col_import_ok_n:'✓ {0} elementi importati da {1}.', col_import_err:'✕ File non valido. Scegli un file di esportazione valido.', col_name_err:'✕ Inserisci prima il nome del tuo collega.',
      cv_sub_text:'Regola i colori per diversi tipi di visione. Influisce sui colori {0} e {1}.',
      h_tdm:'📋 Visibilità Attività', sub_tdm:'Scegli come vengono mostrate le liste attività su ogni scheda.',
      h_cv:'👁 Visione Colori',
      tdm_always_lbl:'Sempre visibile', tdm_always_desc:'Le attività sono sempre espanse su ogni scheda.',
      tdm_hover_lbl:'Passa il cursore', tdm_hover_desc:'Le attività appaiono passando il cursore sulla scheda.',
      tdm_man_open_lbl:'Manuale — inizia aperto', tdm_man_open_desc:'Inizia espanso. Clicca l\'angolo per ridurre.',
      tdm_man_closed_lbl:'Manuale — inizia chiuso', tdm_man_closed_desc:'Inizia ridotto. Clicca l\'angolo per espandere.',
      tdm_never_lbl:'Sempre nascosto', tdm_never_desc:'Le attività non vengono mai mostrate sulla scheda.',
      cv_standard_name:'Standard', cv_standard_sub:'Colori predefiniti',
      cv_deuteranopia_name:'Blu-Arancio', cv_deuteranopia_sub:'Daltonismo rosso-verde',
      cv_tritanopia_name:'Rosa-Verde acqua', cv_tritanopia_sub:'Daltonismo blu-giallo',
      cv_high_contrast_name:'Alto Contrasto', cv_high_contrast_sub:'Massimo contrasto di luminanza',
      tab_achievements:'Traguardi', ach_empty_title:'Ancora nulla chiuso', ach_empty_sub:'Chiudi il tuo primo elemento o attività per iniziare la serie', ach_streak_label:'giorni lavorativi', ach_total_label:'elementi chiusi', ach_today:'Oggi', ach_yesterday:'Ieri', ach_n_done:'{0} chiusi', ach_todos_done:'attività fatte',
      tab_open_todos:'In sospeso', ot_empty_title:'Tutto fatto!', ot_empty_sub:'Nessun to-do aperto al momento', ot_overdue:'Scaduto', ot_due_today:'Scade oggi',
    },
    zh: {
      tab_board:'看板', tab_calendar:'日历', tab_settings:'设置',
      h_lang:'🌐 语言', sub_lang:'选择显示语言。自动保存。',
      h_panel_names:'📌 面板名称', sub_panel_names:'选择两个工作面板的标签。自动保存。',
      h_color:'🎨 颜色主题', sub_color:'为应用选择颜色主题。自动保存。',
      h_data:'💾 数据与备份', h_fortune:'🍪 幸运饼干', h_about:'ℹ 关于',
      fortune_desc:'每天一条运势。点击饼干，听听宇宙想说什么。',
      modal_name_lbl:'名称 / 标题', modal_date_lbl:'录入日期', modal_desc_lbl:'描述 / 备注', modal_link_lbl:'链接（URL）',
      modal_name_ph:'例：Alpha 计划或 QDR-042', modal_desc_ph:'简短描述…', modal_link_ph:'https://…',
      modal_save:'保存', modal_cancel:'取消', modal_new:'新建 {0}', modal_edit:'编辑 {0}',
      confirm_body:'此操作无法撤销。', confirm_delete:'删除', confirm_cancel:'取消',
      undo_deleted:'已删除"{0}"', undo_btn:'撤销',
      add_item:'+ 添加{0}', search_ph:'搜索{0}…',
      empty_msg:'暂无{0}。<br>点击 <strong>+ 添加</strong> 创建。',
      todos_label:'✓ 待办', todo_ph:'新待办…', todo_link_ph:'链接（可选）https://…', todo_edit_link_ph:'链接 https://…',
      todo_save:'✓ 保存', todo_cancel:'✕', lnk_label:'链接', card_entry:'录入',
      tip_highlight:'高亮', tip_edit:'编辑', tip_remove:'删除',
      cal_go:'→ 跳转', cal_task_one:'{0} 项', cal_task_many:'{0} 项',
      data_current:'📊 当前数据', data_total:'待办总数', data_done:'已完成',
      data_warn_title:'数据存储在浏览器中——请备份！',
      data_warn_body:'所有条目和待办存储在浏览器的 <strong>localStorage</strong> 中，<strong>仅在此设备和此浏览器</strong>上可用。<br><br><strong>清除浏览器缓存或网站数据将导致所有数据永久丢失。</strong>请先导出备份。',
      data_exp_title:'⬇ 导出备份', data_exp_desc:'下载包含所有数据的 <strong>.json</strong> 文件，请妥善保存。', data_exp_btn:'⬇ 下载备份',
      data_imp_title:'⬆ 导入备份', data_imp_desc:'恢复之前的备份。<strong>这将替换所有当前数据。</strong>', data_imp_btn:'📂 选择备份文件…',
      data_ok:'✓ 数据加载成功！', data_err:'✕ 无效的备份文件。',
      fortune_hint:'点击饼干获取今日运势', fortune_tmrw:'✨ 明天再来获取新运势',
      about_ai_lbl:'由 AI 构建', about_lic_title:'许可证', about_lic_name:'The Unlicense — 公共领域',
      about_lic_text:'本软件已释放至公共领域，任何人可出于任何目的自由复制、修改、发布、使用或出售，无需任何条件。',
      about_priv_title:'隐私与存储声明',
      about_nc_lbl:'无 Cookie', about_nc_val:'本应用<strong>不使用任何类型的 Cookie</strong>——无追踪，无功能性 Cookie。',
      about_ls_lbl:'仅本地存储', about_ls_val:'所有数据仅存储在您浏览器的 <strong>localStorage</strong> 中。<em>不向任何服务器发送数据，不发起任何网络请求。</em>',
      about_stored_lbl:'存储内容',
      btn_prioritize:'⭐ 优先处理', btn_back_normal:'↩ 恢复正常', btn_reopen:'↩ 重新开启', btn_complete:'✓ 完成',
      ms_overdue:'逾期{0}天', ms_today:'今天', ms_in_days:'{0}天后',
      dc_day:'天', dc_days:'天',
      search_no_results:'"{0}"无搜索结果',
      h_tasks:'任务',
      ms_name_ph:'里程碑名称…',
      age_alert_title:'⏱ {0}老化提醒', age_alert_sub:'超过此天数的{0}卡片将被标记为老化。', age_alert_lbl:'{0}老化提醒的天数',
      cal_week_mon:'从周一开始', cal_show_wk_nums:'显示周数',
      data_share_title:'⬇ 分享开放任务', data_share_desc:'下载包含你开放任务的<strong>.json</strong>文件，发送给同事让他们帮你处理。', data_share_btn:'🏖 导出开放任务',
      data_imp_col_title:'⬆ 导入同事的任务', data_imp_col_desc:'将同事的开放任务加载到你的看板。输入他们的名字 — 导入的项目将以<strong>[姓名]</strong>显示。你的现有数据不受影响。', data_imp_col_btn:'📂 选择任务文件…',
      col_name_ph:'同事姓名…', col_import_ok_1:'✓ 已从{0}导入1个项目。', col_import_ok_n:'✓ 已从{1}导入{0}个项目。', col_import_err:'✕ 文件无效，请选择有效的任务导出文件。', col_name_err:'✕ 请先输入同事的名字。',
      cv_sub_text:'为不同类型的色觉调整颜色。影响{0}和{1}的强调色。',
      h_tdm:'📋 待办可见性', sub_tdm:'选择待办列表在卡片上的显示方式。',
      h_cv:'👁 色觉',
      tdm_always_lbl:'始终可见', tdm_always_desc:'每张卡片上的待办始终展开显示。',
      tdm_hover_lbl:'悬停查看', tdm_hover_desc:'悬停在卡片上时显示待办。',
      tdm_man_open_lbl:'手动 — 默认展开', tdm_man_open_desc:'默认展开。点击角落可折叠。',
      tdm_man_closed_lbl:'手动 — 默认折叠', tdm_man_closed_desc:'默认折叠。点击角落可展开。',
      tdm_never_lbl:'始终隐藏', tdm_never_desc:'卡片上不显示待办。',
      cv_standard_name:'标准', cv_standard_sub:'默认颜色',
      cv_deuteranopia_name:'蓝橙', cv_deuteranopia_sub:'红绿色盲',
      cv_tritanopia_name:'玫瑰青', cv_tritanopia_sub:'蓝黄色盲',
      cv_high_contrast_name:'高对比度', cv_high_contrast_sub:'最大亮度对比',
      tab_achievements:'成就', ach_empty_title:'还没有关闭任何项目', ach_empty_sub:'关闭第一个项目或任务以开始你的连胜', ach_streak_label:'工作日连胜', ach_total_label:'已关闭项目', ach_today:'今天', ach_yesterday:'昨天', ach_n_done:'{0}个已关闭', ach_todos_done:'任务已完成',
      tab_open_todos:'待处理', ot_empty_title:'全部完成！', ot_empty_sub:'目前没有未完成的待办事项', ot_overdue:'已逾期', ot_due_today:'今天到期',
    },
    ja: {
      tab_board:'ボード', tab_calendar:'カレンダー', tab_settings:'設定',
      h_lang:'🌐 言語', sub_lang:'表示言語を選択してください。自動的に保存されます。',
      h_panel_names:'📌 パネル名', sub_panel_names:'2つの作業パネルのラベルを選択してください。自動的に保存されます。',
      h_color:'🎨 カラーテーマ', sub_color:'アプリのカラーテーマを選択してください。自動的に保存されます。',
      h_data:'💾 データ & バックアップ', h_fortune:'🍪 フォーチュンクッキー', h_about:'ℹ このアプリについて',
      fortune_desc:'1日1回の運勢。クッキーをクリックして、宇宙からのメッセージを受け取りましょう。',
      modal_name_lbl:'名前 / タイトル', modal_date_lbl:'登録日', modal_desc_lbl:'説明 / メモ', modal_link_lbl:'リンク（URL）',
      modal_name_ph:'例：アルファ計画 または QDR-042', modal_desc_ph:'短い説明…', modal_link_ph:'https://…',
      modal_save:'保存', modal_cancel:'キャンセル', modal_new:'新規 {0}', modal_edit:'{0} を編集',
      confirm_body:'この操作は取り消せません。', confirm_delete:'削除', confirm_cancel:'キャンセル',
      undo_deleted:'「{0}」を削除しました', undo_btn:'元に戻す',
      add_item:'+ {0}を追加', search_ph:'{0}を検索…',
      empty_msg:'{0}はまだありません。<br><strong>+ 追加</strong>をクリックして作成してください。',
      todos_label:'✓ タスク', todo_ph:'新しいタスク…', todo_link_ph:'リンク（任意）https://…', todo_edit_link_ph:'リンク https://…',
      todo_save:'✓ 保存', todo_cancel:'✕', lnk_label:'リンク', card_entry:'登録日',
      tip_highlight:'ハイライト', tip_edit:'編集', tip_remove:'削除',
      cal_go:'→ 移動', cal_task_one:'{0} 件', cal_task_many:'{0} 件',
      data_current:'📊 現在のデータ', data_total:'タスク合計', data_done:'完了',
      data_warn_title:'データはブラウザに保存されています — バックアップを！',
      data_warn_body:'すべての項目とタスクはブラウザの <strong>localStorage</strong> に保存されています。データは<strong>このデバイスとブラウザのみ</strong>に存在します。<br><br><strong>ブラウザのキャッシュやデータを消去すると、すべてのデータが永久に失われます。</strong>事前にエクスポートしてください。',
      data_exp_title:'⬇ エクスポート', data_exp_desc:'すべてのデータを含む <strong>.json</strong> ファイルをダウンロードします。', data_exp_btn:'⬇ バックアップをダウンロード',
      data_imp_title:'⬆ インポート', data_imp_desc:'以前のバックアップを復元します。<strong>現在のデータはすべて置き換えられます。</strong>', data_imp_btn:'📂 バックアップファイルを選択…',
      data_ok:'✓ データを正常に読み込みました！', data_err:'✕ 無効なバックアップファイルです。',
      fortune_hint:'クッキーをクリックして今日の運勢を確認', fortune_tmrw:'✨ 明日また新しい運勢が届きます',
      about_ai_lbl:'AIで構築', about_lic_title:'ライセンス', about_lic_name:'The Unlicense — パブリックドメイン',
      about_lic_text:'このソフトウェアはパブリックドメインに解放されたフリーソフトウェアです。誰でも、いかなる目的でも、条件なしにコピー、変更、公開、使用、販売することができます。',
      about_priv_title:'プライバシーとストレージに関する宣言',
      about_nc_lbl:'Cookieなし', about_nc_val:'このアプリは<strong>いかなる種類のCookieも使用しません</strong>。',
      about_ls_lbl:'ローカルストレージのみ', about_ls_val:'すべてのデータはブラウザの <strong>localStorage</strong> にのみ保存されます。<em>サーバーへの送信はありません。</em>',
      about_stored_lbl:'保存される内容',
      btn_prioritize:'⭐ 優先', btn_back_normal:'↩ 通常に戻す', btn_reopen:'↩ 再開', btn_complete:'✓ 完了',
      ms_overdue:'{0}日延滞', ms_today:'今日', ms_in_days:'{0}日後',
      dc_day:'日', dc_days:'日',
      search_no_results:'「{0}」の結果なし',
      h_tasks:'タスク',
      ms_name_ph:'マイルストーン名…',
      age_alert_title:'⏱ {0}年齢アラート', age_alert_sub:'この日数より古い{0}カードは強調表示されます。', age_alert_lbl:'{0}年齢アラートまでの日数',
      cal_week_mon:'月曜日から週を始める', cal_show_wk_nums:'週番号を表示',
      data_share_title:'⬇ 未完了タスクを共有', data_share_desc:'未完了タスクを含む<strong>.json</strong>ファイルをダウンロードします。同僚に送って代わりに対応してもらいましょう。', data_share_btn:'🏖 未完了タスクをエクスポート',
      data_imp_col_title:'⬆ 同僚のタスクをインポート', data_imp_col_desc:'同僚の未完了タスクをボードに読み込みます。名前を入力してください — インポートされたアイテムは<strong>[名前]</strong>付きで表示されます。既存のデータはそのままです。', data_imp_col_btn:'📂 タスクファイルを選択…',
      col_name_ph:'同僚の名前…', col_import_ok_1:'✓ {0}から1件インポートしました。', col_import_ok_n:'✓ {1}から{0}件インポートしました。', col_import_err:'✕ 無効なファイルです。有効なエクスポートファイルを選択してください。', col_name_err:'✕ 最初に同僚の名前を入力してください。',
      cv_sub_text:'{0}と{1}のアクセントカラーに影響します。',
      h_tdm:'📋 タスク表示', sub_tdm:'各カードのタスクリストの表示方法を選択します。',
      h_cv:'👁 色覚',
      tdm_always_lbl:'常に表示', tdm_always_desc:'すべてのカードでタスクを常に展開表示します。',
      tdm_hover_lbl:'ホバーで表示', tdm_hover_desc:'カードにホバーするとタスクが表示されます。',
      tdm_man_open_lbl:'手動 — 展開スタート', tdm_man_open_desc:'展開済みで開始。角をクリックで折りたたみ。',
      tdm_man_closed_lbl:'手動 — 折りたたみスタート', tdm_man_closed_desc:'折りたたみで開始。角をクリックで展開。',
      tdm_never_lbl:'常に非表示', tdm_never_desc:'カードにタスクは表示されません。',
      cv_standard_name:'スタンダード', cv_standard_sub:'デフォルトカラー',
      cv_deuteranopia_name:'ブルー・オレンジ', cv_deuteranopia_sub:'赤緑色覚異常',
      cv_tritanopia_name:'ローズ・ティール', cv_tritanopia_sub:'青黄色覚異常',
      cv_high_contrast_name:'ハイコントラスト', cv_high_contrast_sub:'最大輝度コントラスト',
      tab_achievements:'実績', ach_empty_title:'まだ何も完了していません', ach_empty_sub:'最初のアイテムまたはタスクを完了してストリークを始めよう', ach_streak_label:'稼働日連続', ach_total_label:'完了したアイテム', ach_today:'今日', ach_yesterday:'昨日', ach_n_done:'{0}件完了', ach_todos_done:'タスク完了',
      tab_open_todos:'未完了', ot_empty_title:'すべて完了！', ot_empty_sub:'未完了のタスクはありません', ot_overdue:'期限超過', ot_due_today:'今日が期限',
    },
    ko: {
      tab_board:'보드', tab_calendar:'캘린더', tab_settings:'설정',
      h_lang:'🌐 언어', sub_lang:'표시 언어를 선택하세요. 자동으로 저장됩니다.',
      h_panel_names:'📌 패널 이름', sub_panel_names:'두 작업 패널의 레이블을 선택하세요. 자동으로 저장됩니다.',
      h_color:'🎨 색상 테마', sub_color:'앱의 색상 테마를 선택하세요. 자동으로 저장됩니다.',
      h_data:'💾 데이터 및 백업', h_fortune:'🍪 포춘 쿠키', h_about:'ℹ 정보',
      fortune_desc:'하루 한 번의 운세. 쿠키를 클릭하고 우주가 전하는 말을 들어보세요.',
      modal_name_lbl:'이름 / 제목', modal_date_lbl:'입력일', modal_desc_lbl:'설명 / 메모', modal_link_lbl:'링크 (URL)',
      modal_name_ph:'예: 알파 이니셔티브 또는 QDR-042', modal_desc_ph:'간단한 설명…', modal_link_ph:'https://…',
      modal_save:'저장', modal_cancel:'취소', modal_new:'새 {0}', modal_edit:'{0} 편집',
      confirm_body:'이 작업은 취소할 수 없습니다.', confirm_delete:'삭제', confirm_cancel:'취소',
      undo_deleted:'"{0}" 삭제됨', undo_btn:'실행 취소',
      add_item:'+ {0} 추가', search_ph:'{0} 검색…',
      empty_msg:'{0}이(가) 없습니다.<br><strong>+ 추가</strong>를 눌러 만드세요.',
      todos_label:'✓ 할 일', todo_ph:'새 할 일…', todo_link_ph:'링크 (선택) https://…', todo_edit_link_ph:'링크 https://…',
      todo_save:'✓ 저장', todo_cancel:'✕', lnk_label:'링크', card_entry:'입력일',
      tip_highlight:'강조', tip_edit:'편집', tip_remove:'삭제',
      cal_go:'→ 이동', cal_task_one:'{0}개', cal_task_many:'{0}개',
      data_current:'📊 현재 데이터', data_total:'할 일 합계', data_done:'완료',
      data_warn_title:'데이터는 브라우저에 있습니다 — 백업하세요!',
      data_warn_body:'모든 항목과 할 일은 브라우저의 <strong>localStorage</strong>에 저장됩니다. 데이터는 <strong>이 기기와 브라우저에만</strong> 존재합니다.<br><br><strong>브라우저 캐시나 사이트 데이터를 지우면 모든 데이터가 영구적으로 손실됩니다.</strong> 먼저 내보내기를 사용하세요.',
      data_exp_title:'⬇ 내보내기', data_exp_desc:'모든 데이터가 담긴 <strong>.json</strong> 파일을 다운로드합니다.', data_exp_btn:'⬇ 백업 다운로드',
      data_imp_title:'⬆ 가져오기', data_imp_desc:'이전 백업을 복원합니다. <strong>현재 데이터가 모두 교체됩니다.</strong>', data_imp_btn:'📂 백업 파일 선택…',
      data_ok:'✓ 데이터를 성공적으로 불러왔습니다!', data_err:'✕ 유효하지 않은 백업 파일입니다.',
      fortune_hint:'쿠키를 클릭하여 오늘의 운세를 확인하세요', fortune_tmrw:'✨ 내일 새로운 운세를 확인하세요',
      about_ai_lbl:'AI로 제작', about_lic_title:'라이선스', about_lic_name:'The Unlicense — 퍼블릭 도메인',
      about_lic_text:'이 소프트웨어는 퍼블릭 도메인에 공개된 자유 소프트웨어입니다. 누구든 어떤 목적으로든 조건 없이 복사, 수정, 배포, 사용, 판매할 수 있습니다.',
      about_priv_title:'개인정보 보호 및 저장소 선언',
      about_nc_lbl:'쿠키 없음', about_nc_val:'이 앱은 <strong>어떠한 종류의 쿠키도 사용하지 않습니다</strong>.',
      about_ls_lbl:'로컬 스토리지 전용', about_ls_val:'모든 데이터는 브라우저의 <strong>localStorage</strong>에만 저장됩니다. <em>어떤 서버에도 전송되지 않습니다.</em>',
      about_stored_lbl:'저장되는 항목',
      btn_prioritize:'⭐ 우선순위 설정', btn_back_normal:'↩ 일반으로 돌아가기', btn_reopen:'↩ 다시 열기', btn_complete:'✓ 완료',
      ms_overdue:'{0}일 연체', ms_today:'오늘', ms_in_days:'{0}일 후',
      dc_day:'일', dc_days:'일',
      search_no_results:'"{0}"에 대한 결과 없음',
      h_tasks:'작업',
      ms_name_ph:'마일스톤 이름…',
      age_alert_title:'⏱ {0} 기간 경고', age_alert_sub:'이 일수보다 오래된 {0} 카드는 강조 표시됩니다.', age_alert_lbl:'{0} 기간 경고까지 일수',
      cal_week_mon:'월요일부터 주 시작', cal_show_wk_nums:'주 번호 표시',
      data_share_title:'⬇ 미완료 작업 공유', data_share_desc:'미완료 작업이 담긴 <strong>.json</strong> 파일을 다운로드합니다. 동료에게 보내 대신 처리하도록 하세요.', data_share_btn:'🏖 미완료 작업 내보내기',
      data_imp_col_title:'⬆ 동료 작업 가져오기', data_imp_col_desc:'동료의 미완료 작업을 보드에 불러옵니다. 이름을 입력하세요 — 가져온 항목은 <strong>[이름]</strong>으로 표시됩니다. 기존 데이터는 변경되지 않습니다.', data_imp_col_btn:'📂 작업 파일 선택…',
      col_name_ph:'동료 이름…', col_import_ok_1:'✓ {0}에서 1개 항목을 가져왔습니다.', col_import_ok_n:'✓ {1}에서 {0}개 항목을 가져왔습니다.', col_import_err:'✕ 잘못된 파일입니다. 유효한 작업 내보내기 파일을 선택하세요.', col_name_err:'✕ 동료의 이름을 먼저 입력하세요.',
      cv_sub_text:'{0} 및 {1} 강조 색상에 영향을 줍니다.',
      h_tdm:'📋 할일 표시', sub_tdm:'각 카드에서 할일 목록을 표시하는 방법을 선택하세요.',
      h_cv:'👁 색각',
      tdm_always_lbl:'항상 표시', tdm_always_desc:'모든 카드에서 할일이 항상 펼쳐져 있습니다.',
      tdm_hover_lbl:'호버로 보기', tdm_hover_desc:'카드에 마우스를 올리면 할일이 나타납니다.',
      tdm_man_open_lbl:'수동 — 열려서 시작', tdm_man_open_desc:'펼쳐진 상태로 시작합니다. 모서리를 클릭해 접습니다.',
      tdm_man_closed_lbl:'수동 — 닫혀서 시작', tdm_man_closed_desc:'접힌 상태로 시작합니다. 모서리를 클릭해 펼칩니다.',
      tdm_never_lbl:'항상 숨김', tdm_never_desc:'카드에 할일이 표시되지 않습니다.',
      cv_standard_name:'기본', cv_standard_sub:'기본 색상',
      cv_deuteranopia_name:'파란-주황', cv_deuteranopia_sub:'적록 색각 이상',
      cv_tritanopia_name:'장미-청록', cv_tritanopia_sub:'청황 색각 이상',
      cv_high_contrast_name:'고대비', cv_high_contrast_sub:'최대 휘도 대비',
      tab_achievements:'성과', ach_empty_title:'아직 완료된 항목 없음', ach_empty_sub:'첫 번째 항목 또는 할 일을 완료하여 연속 기록을 시작하세요', ach_streak_label:'연속 업무일', ach_total_label:'완료된 항목', ach_today:'오늘', ach_yesterday:'어제', ach_n_done:'{0}개 완료', ach_todos_done:'할 일 완료',
      tab_open_todos:'미완료', ot_empty_title:'모두 완료!', ot_empty_sub:'현재 열린 할 일이 없습니다', ot_overdue:'기한 초과', ot_due_today:'오늘 마감',
    },
    pt: {
      tab_board:'Quadro', tab_calendar:'Calendário', tab_settings:'Configurações',
      h_lang:'🌐 Idioma', sub_lang:'Escolha o idioma de exibição. Salvo automaticamente.',
      h_panel_names:'📌 Nomes dos Painéis', sub_panel_names:'Escolha como nomear seus dois painéis de trabalho. Salvo automaticamente.',
      h_color:'🎨 Tema de Cor', sub_color:'Escolha um tema de cor para o app. Salvo automaticamente.',
      h_data:'💾 Dados & Backup', h_fortune:'🍪 Biscoito da Sorte', h_about:'ℹ Sobre',
      fortune_desc:'Uma fortuna por dia. Abra o biscoito e veja o que o universo tem a dizer.',
      modal_name_lbl:'Nome / Título', modal_date_lbl:'Data de Entrada', modal_desc_lbl:'Descrição / Notas', modal_link_lbl:'Link (URL)',
      modal_name_ph:'ex. Iniciativa Alpha ou QDR-042', modal_desc_ph:'Descrição breve…', modal_link_ph:'https://…',
      modal_save:'Salvar', modal_cancel:'Cancelar', modal_new:'Novo {0}', modal_edit:'Editar {0}',
      confirm_body:'Esta ação não pode ser desfeita.', confirm_delete:'Excluir', confirm_cancel:'Cancelar',
      undo_deleted:'"{0}" excluído', undo_btn:'Desfazer',
      add_item:'+ Adicionar {0}', search_ph:'Buscar {0}…',
      empty_msg:'Nenhum {0} ainda.<br>Clique em <strong>+ Adicionar</strong>.',
      todos_label:'✓ Tarefas', todo_ph:'Nova tarefa…', todo_link_ph:'Link (opcional) https://…', todo_edit_link_ph:'Link https://…',
      todo_save:'✓ Salvar', todo_cancel:'✕', lnk_label:'Link', card_entry:'Entrada',
      tip_highlight:'Destacar', tip_edit:'Editar', tip_remove:'Remover',
      cal_go:'→ Ir', cal_task_one:'{0} tarefa', cal_task_many:'{0} tarefas',
      data_current:'📊 Dados atuais', data_total:'Total de tarefas', data_done:'Concluído',
      data_warn_title:'Seus dados estão no navegador — faça um backup!',
      data_warn_body:'Todos os seus itens e tarefas são armazenados no <strong>localStorage</strong> do navegador. Os dados estão <strong>apenas neste dispositivo e navegador</strong>.<br><br><strong>Se você limpar o cache do navegador, todos os dados serão perdidos permanentemente.</strong> Exporte um backup antes.',
      data_exp_title:'⬇ Exportar backup', data_exp_desc:'Baixa um arquivo <strong>.json</strong> com todos os seus dados.', data_exp_btn:'⬇ Baixar backup',
      data_imp_title:'⬆ Importar backup', data_imp_desc:'Restaura um backup anterior. <strong>Isso substituirá todos os dados atuais.</strong>', data_imp_btn:'📂 Escolher arquivo…',
      data_ok:'✓ Dados carregados com sucesso!', data_err:'✕ Arquivo de backup inválido.',
      fortune_hint:'Clique no biscoito para sua sorte de hoje', fortune_tmrw:'✨ Volte amanhã para uma nova sorte',
      about_ai_lbl:'Criado com IA', about_lic_title:'Licença', about_lic_name:'The Unlicense — Domínio Público',
      about_lic_text:'Este é software livre e irrestrito liberado para o domínio público. Qualquer pessoa pode copiá-lo, modificá-lo, publicá-lo, usá-lo ou vendê-lo para qualquer finalidade, sem condições.',
      about_priv_title:'Declaração de Privacidade e Armazenamento',
      about_nc_lbl:'Sem cookies', about_nc_val:'Este app <strong>não usa cookies</strong> de nenhum tipo.',
      about_ls_lbl:'Apenas armazenamento local', about_ls_val:'Todos os dados são armazenados exclusivamente no <strong>localStorage</strong> do seu navegador. <em>Nada é enviado para nenhum servidor.</em>',
      about_stored_lbl:'O que é armazenado',
      btn_prioritize:'⭐ Priorizar', btn_back_normal:'↩ Voltar ao normal', btn_reopen:'↩ Reabrir', btn_complete:'✓ Concluir',
      ms_overdue:'{0}d de atraso', ms_today:'Hoje', ms_in_days:'em {0}d',
      dc_day:'dia', dc_days:'dias',
      search_no_results:'Sem resultados para "{0}"',
      h_tasks:'Tarefas',
      ms_name_ph:'Nome do marco…',
      age_alert_title:'⏱ Alerta de idade {0}', age_alert_sub:'Cartões {0} mais antigos que este número de dias serão destacados.', age_alert_lbl:'dias até o alerta de idade {0}',
      cal_week_mon:'Iniciar semana na segunda-feira', cal_show_wk_nums:'Mostrar números de semana',
      data_share_title:'⬇ Compartilhar tarefas abertas', data_share_desc:'Baixa um arquivo <strong>.json</strong> com suas tarefas abertas. Envie para um colega para que possa cobri-lo.', data_share_btn:'🏖 Exportar tarefas abertas',
      data_imp_col_title:'⬆ Importar tarefas de um colega', data_imp_col_desc:'Carrega as tarefas abertas de um colega no seu quadro. Digite o nome — os itens importados aparecerão com <strong>[Nome]</strong>. Seus dados existentes não serão alterados.', data_imp_col_btn:'📂 Escolher arquivo de tarefas…',
      col_name_ph:'Nome do colega…', col_import_ok_1:'✓ 1 item importado de {0}.', col_import_ok_n:'✓ {0} itens importados de {1}.', col_import_err:'✕ Arquivo inválido. Escolha um arquivo de exportação válido.', col_name_err:'✕ Por favor, insira primeiro o nome do seu colega.',
      cv_sub_text:'Ajuste as cores para diferentes tipos de visão. Afeta as cores de {0} e {1}.',
      h_tdm:'📋 Visibilidade de Tarefas', sub_tdm:'Escolha como as listas de tarefas são exibidas em cada cartão.',
      h_cv:'👁 Visão de Cores',
      tdm_always_lbl:'Sempre visível', tdm_always_desc:'As tarefas estão sempre expandidas em cada cartão.',
      tdm_hover_lbl:'Passar o cursor para ver', tdm_hover_desc:'As tarefas aparecem ao passar o cursor sobre o cartão.',
      tdm_man_open_lbl:'Manual — inicia aberto', tdm_man_open_desc:'Inicia expandido. Clique no canto para recolher.',
      tdm_man_closed_lbl:'Manual — inicia fechado', tdm_man_closed_desc:'Inicia recolhido. Clique no canto para expandir.',
      tdm_never_lbl:'Sempre oculto', tdm_never_desc:'As tarefas nunca são mostradas no cartão.',
      cv_standard_name:'Padrão', cv_standard_sub:'Cores padrão',
      cv_deuteranopia_name:'Azul-Laranja', cv_deuteranopia_sub:'Daltonismo vermelho-verde',
      cv_tritanopia_name:'Rosa-Verde-azulado', cv_tritanopia_sub:'Daltonismo azul-amarelo',
      cv_high_contrast_name:'Alto Contraste', cv_high_contrast_sub:'Contraste de luminância máximo',
      tab_achievements:'Conquistas', ach_empty_title:'Nada fechado ainda', ach_empty_sub:'Feche seu primeiro item ou tarefa para começar sua sequência', ach_streak_label:'dias úteis seguidos', ach_total_label:'itens fechados', ach_today:'Hoje', ach_yesterday:'Ontem', ach_n_done:'{0} fechados', ach_todos_done:'tarefas feitas',
      tab_open_todos:'Pendentes', ot_empty_title:'Tudo em dia!', ot_empty_sub:'Nenhum to-do aberto no momento', ot_overdue:'Atrasado', ot_due_today:'Vence hoje',
    },
    hu: {
      tab_board:'Tábla', tab_calendar:'Naptár', tab_settings:'Beállítások',
      h_lang:'🌐 Nyelv', sub_lang:'Válassz megjelenítési nyelvet. Automatikusan mentve.',
      h_panel_names:'📌 Panel Nevek', sub_panel_names:'Válaszd meg a két munkaterület nevét. Automatikusan mentve.',
      h_color:'🎨 Színtéma', sub_color:'Válassz színtémát az alkalmazáshoz. Automatikusan mentve.',
      h_data:'💾 Adatok & Mentés', h_fortune:'🍪 Szerencse Süti', h_about:'ℹ Névjegy',
      fortune_desc:'Naponta egy szerencse. Kattints a sütire, és hallgasd meg, mit üzen az univerzum.',
      modal_name_lbl:'Név / Cím', modal_date_lbl:'Rögzítés dátuma', modal_desc_lbl:'Leírás / Megjegyzések', modal_link_lbl:'Link (URL)',
      modal_name_ph:'pl. Alfa Kezdeményezés vagy QDR-042', modal_desc_ph:'Rövid leírás…', modal_link_ph:'https://…',
      modal_save:'Mentés', modal_cancel:'Mégse', modal_new:'Új {0}', modal_edit:'{0} szerkesztése',
      confirm_body:'Ez a művelet nem vonható vissza.', confirm_delete:'Törlés', confirm_cancel:'Mégse',
      undo_deleted:'„{0}" törölve', undo_btn:'Visszavonás',
      add_item:'+ {0} hozzáadása', search_ph:'{0} keresése…',
      empty_msg:'Még nincs {0}.<br>Kattints a <strong>+ Hozzáadás</strong> gombra.',
      todos_label:'✓ Feladatok', todo_ph:'Új feladat…', todo_link_ph:'Link (opcionális) https://…', todo_edit_link_ph:'Link https://…',
      todo_save:'✓ Mentés', todo_cancel:'✕', lnk_label:'Link', card_entry:'Rögzítve',
      tip_highlight:'Kiemelés', tip_edit:'Szerkesztés', tip_remove:'Eltávolítás',
      cal_go:'→ Ugrás', cal_task_one:'{0} feladat', cal_task_many:'{0} feladat',
      data_current:'📊 Jelenlegi adatok', data_total:'Összes feladat', data_done:'Kész',
      data_warn_title:'Az adataid a böngészőben vannak — készíts mentést!',
      data_warn_body:'Minden elem és feladat a böngésző <strong>localStorage</strong>-ában tárolódik. Az adatok <strong>csak ezen az eszközön és böngészőben</strong> érhetők el.<br><br><strong>Ha törlöd a böngésző gyorsítótárát vagy webhelyadatait, minden adatod véglegesen elvész.</strong> Exportálj mentést előbb.',
      data_exp_title:'⬇ Mentés exportálása', data_exp_desc:'Letölt egy <strong>.json</strong> fájlt az összes adatoddal.', data_exp_btn:'⬇ Mentés letöltése',
      data_imp_title:'⬆ Mentés importálása', data_imp_desc:'Visszaállít egy korábbi mentést. <strong>Ez felülírja az összes jelenlegi adatot.</strong>', data_imp_btn:'📂 Mentési fájl kiválasztása…',
      data_ok:'✓ Az adatok sikeresen betöltve!', data_err:'✕ Érvénytelen mentési fájl.',
      fortune_hint:'Kattints a sütire a mai szerencséd megtekintéséhez', fortune_tmrw:'✨ Gyere vissza holnap egy új szerencséért',
      about_ai_lbl:'MI segítségével készült', about_lic_title:'Licenc', about_lic_name:'The Unlicense — Közkincs',
      about_lic_text:'Ez egy szabad szoftver, amely közkincsként kerül kiadásra. Bárki bármilyen célra másolhatja, módosíthatja, közzéteheti, felhasználhatja vagy értékesítheti, feltételek nélkül.',
      about_priv_title:'Adatvédelmi és Tárolási Nyilatkozat',
      about_nc_lbl:'Nincs cookie', about_nc_val:'Ez az alkalmazás <strong>semmilyen cookie-t nem használ</strong>.',
      about_ls_lbl:'Csak helyi tárolás', about_ls_val:'Minden adat kizárólag a böngésző <strong>localStorage</strong>-ában tárolódik. <em>Semmi nem kerül szervernek küldésre.</em>',
      about_stored_lbl:'Mi tárolódik',
      btn_prioritize:'⭐ Priorizálás', btn_back_normal:'↩ Visszaállítás', btn_reopen:'↩ Újranyitás', btn_complete:'✓ Teljesítve',
      ms_overdue:'{0} napja késik', ms_today:'Ma', ms_in_days:'{0} nap múlva',
      dc_day:'nap', dc_days:'nap',
      search_no_results:'Nincs találat: „{0}"',
      h_tasks:'Feladatok',
      ms_name_ph:'Mérföldkő neve…',
      age_alert_title:'⏱ {0} életkor figyelmeztetés', age_alert_sub:'Az ennyi napnál régebbi {0} kártyák kiemelten jelennek meg.', age_alert_lbl:'nap a {0} életkor figyelmeztetésig',
      cal_week_mon:'Hét hétfőn kezdődik', cal_show_wk_nums:'Hétszámok megjelenítése',
      data_share_title:'⬇ Nyitott feladatok megosztása', data_share_desc:'Letölti a nyitott feladataidat tartalmazó <strong>.json</strong> fájlt. Küldd el egy kollégának, hogy helyettesíthessen.', data_share_btn:'🏖 Nyitott feladatok exportálása',
      data_imp_col_title:'⬆ Kolléga feladatainak importálása', data_imp_col_desc:'Töltsd be egy kolléga nyitott feladatait a tábládra. Add meg a nevét — az importált elemek <strong>[Névvel]</strong> jelennek meg. Meglévő adataid érintetlenek maradnak.', data_imp_col_btn:'📂 Feladatfájl kiválasztása…',
      col_name_ph:'Kolléga neve…', col_import_ok_1:'✓ 1 elem importálva tőle: {0}.', col_import_ok_n:'✓ {0} elem importálva tőle: {1}.', col_import_err:'✕ Érvénytelen fájl. Kérjük, válassz érvényes exportfájlt.', col_name_err:'✕ Kérjük, először add meg a kolléga nevét.',
      cv_sub_text:'Állítsd be a színeket különböző színlátású felhasználók számára. A {0} és {1} akcentszínekre hat.',
      h_tdm:'📋 Feladatok láthatósága', sub_tdm:'Válaszd meg, hogyan jelenjenek meg a feladatlisták a kártyákon.',
      h_cv:'👁 Színlátás',
      tdm_always_lbl:'Mindig látható', tdm_always_desc:'A feladatok minden kártyán mindig kinyitva vannak.',
      tdm_hover_lbl:'Hover az előnézethez', tdm_hover_desc:'A feladatok megjelennek a kártya fölé mozgatáskor.',
      tdm_man_open_lbl:'Kézi — nyitva indul', tdm_man_open_desc:'Kinyitva indul. Kattints a sarokra a bezáráshoz.',
      tdm_man_closed_lbl:'Kézi — zárva indul', tdm_man_closed_desc:'Zárva indul. Kattints a sarokra a megnyitáshoz.',
      tdm_never_lbl:'Mindig rejtve', tdm_never_desc:'A feladatok soha nem jelennek meg a kártyán.',
      cv_standard_name:'Alapértelmezett', cv_standard_sub:'Alapértelmezett színek',
      cv_deuteranopia_name:'Kék-Narancs', cv_deuteranopia_sub:'Vörös-zöld színtévesztés',
      cv_tritanopia_name:'Rózsa-Kékeszöld', cv_tritanopia_sub:'Kék-sárga színtévesztés',
      cv_high_contrast_name:'Magas kontraszt', cv_high_contrast_sub:'Maximális fényességkontraszt',
      tab_achievements:'Eredmények', ach_empty_title:'Még semmi sem lezárva', ach_empty_sub:'Zárd le az első elemet vagy feladatot a sorozat indításához', ach_streak_label:'munkanap-sorozat', ach_total_label:'lezárt elemek', ach_today:'Ma', ach_yesterday:'Tegnap', ach_n_done:'{0} lezárva', ach_todos_done:'feladat elvégezve',
      tab_open_todos:'Függőben', ot_empty_title:'Minden kész!', ot_empty_sub:'Nincs nyitott teendő jelenleg', ot_overdue:'Késedelmes', ot_due_today:'Ma esedékes',
    },
    da: {
      tab_board:'Tavle', tab_calendar:'Kalender', tab_settings:'Indstillinger',
      h_lang:'🌐 Sprog', sub_lang:'Vælg visningssprog. Gemmes automatisk.',
      h_panel_names:'📌 Panelnavne', sub_panel_names:'Vælg hvordan dine to arbejdspaneler skal mærkes. Gemmes automatisk.',
      h_color:'🎨 Farvetema', sub_color:'Vælg et farvetema til appen. Dit valg gemmes automatisk.',
      h_data:'💾 Data og sikkerhedskopi', h_fortune:'🍪 Lykkehjul', h_about:'ℹ Om',
      fortune_desc:'Én lykke om dagen. Knæk kagen og se hvad universet har at sige.',
      modal_name_lbl:'Navn / Titel', modal_date_lbl:'Indgangsdato', modal_desc_lbl:'Beskrivelse / Noter', modal_link_lbl:'Link (URL)',
      modal_name_ph:'f.eks. Alpha-initiativ eller QDR-042', modal_desc_ph:'Kort beskrivelse…', modal_link_ph:'https://…',
      modal_save:'Gem', modal_cancel:'Annuller', modal_new:'Ny {0}', modal_edit:'Rediger {0}',
      confirm_body:'Dette kan ikke fortrydes.', confirm_delete:'Slet', confirm_cancel:'Annuller',
      undo_deleted:'"{0}" slettet', undo_btn:'Fortryd',
      add_item:'+ Tilføj {0}', search_ph:'Søg {0}…',
      empty_msg:'Ingen {0} endnu.<br>Tryk <strong>+ Tilføj</strong> for at oprette en.',
      todos_label:'✓ Opgaver', todo_ph:'Ny opgave…', todo_link_ph:'Link (valgfrit) https://…', todo_edit_link_ph:'Link https://…',
      todo_save:'✓ Gem', todo_cancel:'✕', lnk_label:'Link', card_entry:'Post',
      tip_highlight:'Fremhæv', tip_edit:'Rediger', tip_remove:'Fjern',
      cal_go:'→ Gå', cal_task_one:'{0} opgave', cal_task_many:'{0} opgaver',
      data_current:'📊 Aktuelle data', data_total:'Opgaver i alt', data_done:'Udført',
      data_warn_title:'Dine data lever i browseren — tag en sikkerhedskopi!',
      data_warn_body:'Alle dine elementer og opgaver er gemt i din browsers <strong>localStorage</strong>. Dataene er <strong>kun på denne enhed og denne browser</strong>.<br><br><strong>Hvis du rydder browserens cache, mister du alle data permanent.</strong> Eksporter en sikkerhedskopi først.',
      data_exp_title:'⬇ Eksporter sikkerhedskopi', data_exp_desc:'Downloader en <strong>.json</strong>-fil med alle dine data. Opbevar den et sikkert sted.', data_exp_btn:'⬇ Download sikkerhedskopi',
      data_imp_title:'⬆ Importer sikkerhedskopi', data_imp_desc:'Indlæs en tidligere eksporteret sikkerhedskopi. <strong>Dette erstatter alle aktuelle data.</strong>', data_imp_btn:'📂 Vælg sikkerhedskopifil…',
      data_ok:'✓ Data indlæst korrekt!', data_err:'✕ Ugyldig sikkerhedskopifil.',
      fortune_hint:'Klik på kagen for dagens lykke', fortune_tmrw:'✨ Kom tilbage i morgen for en ny lykke',
      about_ai_lbl:'Bygget med AI', about_lic_title:'Licens', about_lic_name:'The Unlicense — Offentligt domæne',
      about_lic_text:'Dette er fri og ubegrænset software udgivet i det offentlige domæne. Alle er frie til at kopiere, ændre, udgive, bruge, kompilere, sælge eller distribuere denne software til ethvert formål uden betingelser.',
      about_priv_title:'Fortrolighed og lagringserklæring',
      about_nc_lbl:'Ingen cookies', about_nc_val:'Denne app <strong>bruger ikke cookies</strong> af nogen art.',
      about_ls_lbl:'Kun lokal lagring', about_ls_val:'Alle data gemmes udelukkende i din browsers <strong>localStorage</strong> på denne enhed. <em>Intet sendes til nogen server.</em>',
      about_stored_lbl:'Hvad gemmes',
      btn_prioritize:'⭐ Prioriter', btn_back_normal:'↩ Tilbage til normal', btn_reopen:'↩ Genåbn', btn_complete:'✓ Fuldfør',
      ms_overdue:'{0}d forsinket', ms_today:'I dag', ms_in_days:'om {0}d',
      dc_day:'dag', dc_days:'dage',
      search_no_results:'Ingen resultater for "{0}"',
      h_tasks:'Opgaver',
      ms_name_ph:'Milepælsnavn…',
      age_alert_title:'⏱ {0} Aldersadvarsel', age_alert_sub:'{0}-kort ældre end dette antal dage vil blive fremhævet.', age_alert_lbl:'dage til {0} aldersadvarsel',
      cal_week_mon:'Start uge om mandagen', cal_show_wk_nums:'Vis ugenumre',
      data_share_title:'⬇ Del dine åbne opgaver', data_share_desc:'Downloader en <strong>.json</strong>-fil med dine åbne opgaver. Send den til en kollega, så de kan dække for dig.', data_share_btn:'🏖 Eksporter åbne opgaver',
      data_imp_col_title:'⬆ Importer en kollegas opgaver', data_imp_col_desc:'Indlæs en kollegas åbne opgaver i dit tavle. Indtast deres navn — importerede elementer vises med <strong>[Navn]</strong>. Dine eksisterende data berøres ikke.', data_imp_col_btn:'📂 Vælg opgavefil…',
      col_name_ph:'Kollegas navn…', col_import_ok_1:'✓ 1 element importeret fra {0}.', col_import_ok_n:'✓ {0} elementer importeret fra {1}.', col_import_err:'✕ Ugyldig fil. Vælg en gyldig eksportfil.', col_name_err:'✕ Angiv venligst kollegaens navn først.',
      cv_sub_text:'Juster farver for forskellige typer farvsyn. Påvirker {0} og {1} accentfarver.',
      h_tdm:'📋 Opgavesynlighed', sub_tdm:'Vælg hvordan opgavelister vises på hvert kort.',
      h_cv:'👁 Farvsyn',
      tdm_always_lbl:'Altid synlig', tdm_always_desc:'Opgaver er altid udvidet på hvert kort.',
      tdm_hover_lbl:'Hover for at se', tdm_hover_desc:'Opgaver vises, når du holder musen over kortet.',
      tdm_man_open_lbl:'Manuel — start åben', tdm_man_open_desc:'Starter udvidet. Klik i hjørnet for at lukke.',
      tdm_man_closed_lbl:'Manuel — start lukket', tdm_man_closed_desc:'Starter lukket. Klik i hjørnet for at åbne.',
      tdm_never_lbl:'Altid skjult', tdm_never_desc:'Opgaver vises aldrig på kortet.',
      cv_standard_name:'Standard', cv_standard_sub:'Standardfarver',
      cv_deuteranopia_name:'Blå-Orange', cv_deuteranopia_sub:'Rød-grøn farveblindhed',
      cv_tritanopia_name:'Rose-Turkis', cv_tritanopia_sub:'Blå-gul farveblindhed',
      cv_high_contrast_name:'Høj kontrast', cv_high_contrast_sub:'Maksimal luminanskontrast',
      tab_achievements:'Resultater', ach_empty_title:'Intet lukket endnu', ach_empty_sub:'Luk dit første element eller opgave for at starte din serie', ach_streak_label:'arbejdsdages serie', ach_total_label:'elementer lukket', ach_today:'I dag', ach_yesterday:'I går', ach_n_done:'{0} lukket', ach_todos_done:'opgaver klaret',
      tab_open_todos:'Afventer', ot_empty_title:'Alt klaret!', ot_empty_sub:'Ingen åbne opgaver lige nu', ot_overdue:'Forsinket', ot_due_today:'Forfalder i dag',
    },
  };

  let currentLang = 'en';

  function t(key, ...args) {
    let s = (STRINGS[currentLang] ?? STRINGS.en)[key] ?? STRINGS.en[key] ?? key;
    args.forEach((a, i) => { s = s.split(`{${i}}`).join(a); });
    return s;
  }

  function applyLang(id, { rerender = true } = {}) {
    currentLang = id in STRINGS ? id : 'en';
    localStorage.setItem('qe_lang', currentLang);
    if (rerender) {
      updateStaticStrings();
      applyPanelNames(currentPanelNames);
      renderAll();
      if (currentView === 'settings')     { renderLangGrid(); renderPanelNamesGrid(); renderTodoDisplayGrid(); renderColors(); renderColorVisionGrid(); renderDataStats(); renderFortune(); }
      if (currentView === 'achievements') renderAchievements();
      if (currentView === 'open-todos')   renderOpenTodos();
    }
  }

  function loadLang() {
    const saved = localStorage.getItem('qe_lang') || 'en';
    currentLang = saved in STRINGS ? saved : 'en';
  }

  function updateStaticStrings() {
    document.querySelectorAll('[data-i18n]').forEach(el => { el.innerHTML = t(el.dataset.i18n); });
    updateHeaderDate();
    // Inputs that need placeholder updates
    const fName = document.getElementById('f-name');   if (fName) fName.placeholder = t('modal_name_ph');
    const fDesc = document.getElementById('f-desc');   if (fDesc) fDesc.placeholder = t('modal_desc_ph');
    const fLink = document.getElementById('f-link');   if (fLink) fLink.placeholder = t('modal_link_ph');
    const colName = document.getElementById('colleague-name'); if (colName) colName.placeholder = t('col_name_ph');
    // Confirm dialog
    const caw = document.getElementById('confirm-action-word'); if (caw) caw.textContent = t('confirm_delete');
    const cbt = document.getElementById('confirm-body-text');    if (cbt) cbt.textContent = t('confirm_body');
    const ccb = document.getElementById('confirm-cancel-btn');  if (ccb) ccb.textContent = t('confirm_cancel');
    const cdb = document.getElementById('confirm-delete-btn');  if (cdb) cdb.textContent = t('confirm_delete');
  }

  function renderLangGrid() {
    const grid = document.getElementById('lang-grid');
    if (!grid) return;
    const langs = [
      { id:'zh', label:'中文',      eng:'Chinese'    },
      { id:'da', label:'Dansk',     eng:'Danish'     },
      { id:'en', label:'English',   eng:''           },
      { id:'fr', label:'Français',  eng:'French'     },
      { id:'de', label:'Deutsch',   eng:'German'     },
      { id:'hu', label:'Magyar',    eng:'Hungarian'  },
      { id:'it', label:'Italiano',  eng:'Italian'    },
      { id:'ja', label:'日本語',    eng:'Japanese'   },
      { id:'ko', label:'한국어',    eng:'Korean'     },
      { id:'pt', label:'Português', eng:'Portuguese' },
      { id:'es', label:'Español',   eng:'Spanish'    },
    ];
    grid.innerHTML = langs.map(l => {
      const sel = l.id === currentLang;
      return `<div class="lang-card${sel ? ' selected' : ''}" onclick="applyLang('${l.id}')">
        ${sel ? '<span class="lang-check">&#10003;</span>' : ''}
        <span class="lang-native">${l.label}</span>
        ${l.eng ? `<span class="lang-eng">${l.eng}</span>` : ''}
      </div>`;
    }).join('');
  }

  function panelLabelSingular(panel) {
    return (PANEL_NAMES[currentPanelNames] ?? PANEL_NAMES.default)[panel + '_s'];
  }

  let currentPanelNames = 'default';

  function panelLabel(panel) {
    return (PANEL_NAMES[currentPanelNames] ?? PANEL_NAMES.default)[panel];
  }

  function applyPanelNames(id, { rerender = true } = {}) {
    const set = PANEL_NAMES[id];
    if (!set) return;
    currentPanelNames = id;
    localStorage.setItem('qe_panel_names', id);
    // Update static HTML elements
    document.getElementById('h-proj-label').textContent = set.proj;
    document.getElementById('h-qdr-label').textContent  = set.qdr;
    document.getElementById('proj-title-label').innerHTML = set.icon_proj + ' ' + set.proj;
    document.getElementById('qdr-title-label').innerHTML  = set.icon_qdr  + ' ' + set.qdr;
    document.getElementById('btn-add-proj').textContent = t('add_item', set.proj_s);
    document.getElementById('btn-add-qdr').textContent  = t('add_item', set.qdr_s);
    document.getElementById('search-proj').placeholder  = t('search_ph', set.proj.toLowerCase());
    document.getElementById('search-qdr').placeholder   = t('search_ph', set.qdr.toLowerCase());
    const cvSub = document.getElementById('cv-subtitle');
    if (cvSub) cvSub.innerHTML = t('cv_sub_text', set.proj.toLowerCase(), set.qdr.toLowerCase());
    if (rerender) {
      renderAll();
      if (currentView === 'settings') { renderPanelNamesGrid(); renderDataStats(); }
    }
  }

  function loadPanelNames() {
    const savedCustom = localStorage.getItem('qe_panel_custom');
    if (savedCustom) {
      try {
        const { proj, qdr } = JSON.parse(savedCustom);
        if (proj) { PANEL_NAMES.custom.proj = proj; PANEL_NAMES.custom.proj_s = proj; }
        if (qdr)  { PANEL_NAMES.custom.qdr  = qdr;  PANEL_NAMES.custom.qdr_s  = qdr;  }
      } catch(e) {}
    }
    const saved = localStorage.getItem('qe_panel_names') || 'default';
    currentPanelNames = saved in PANEL_NAMES ? saved : 'default';
    applyPanelNames(currentPanelNames, { rerender: false });
  }

  // ── Todo display mode ─────────────────────────────────
  const TODO_DISPLAY_MODES = ['always','hover','manual-open','manual-closed','never'];
  let todoDisplayMode = 'manual-open';

  function applyTodoDisplay(mode, { rerender = true } = {}) {
    todoDisplayMode = TODO_DISPLAY_MODES.includes(mode) ? mode : 'manual-open';
    localStorage.setItem('qe_todo_display', todoDisplayMode);
    TODO_DISPLAY_MODES.forEach(m => document.body.classList.remove(`tdm-${m}`));
    document.body.classList.add(`tdm-${todoDisplayMode}`);
    if (rerender) {
      closedTodos.clear();
      pinnedHoverTodo = null;
      renderAll();
      if (currentView === 'settings') renderTodoDisplayGrid();
    }
  }

  function loadTodoDisplay() {
    const saved = localStorage.getItem('qe_todo_display') || 'manual-open';
    todoDisplayMode = TODO_DISPLAY_MODES.includes(saved) ? saved : 'manual-open';
    TODO_DISPLAY_MODES.forEach(m => document.body.classList.remove(`tdm-${m}`));
    document.body.classList.add(`tdm-${todoDisplayMode}`);
  }

  function renderTodoDisplayGrid() {
    const grid = document.getElementById('tdm-grid');
    if (!grid) return;
    const modes = [
      { id: 'always',        icon: '👁',  label: t('tdm_always_lbl'),      desc: t('tdm_always_desc') },
      { id: 'hover',         icon: '✋',  label: t('tdm_hover_lbl'),        desc: t('tdm_hover_desc') },
      { id: 'manual-open',   icon: '📂',  label: t('tdm_man_open_lbl'),     desc: t('tdm_man_open_desc') },
      { id: 'manual-closed', icon: '📁',  label: t('tdm_man_closed_lbl'),   desc: t('tdm_man_closed_desc') },
      { id: 'never',         icon: '🙈',  label: t('tdm_never_lbl'),        desc: t('tdm_never_desc') },
    ];
    grid.innerHTML = modes.map(m => {
      const sel = m.id === todoDisplayMode;
      return `<div class="tdm-card${sel ? ' selected' : ''}" onclick="applyTodoDisplay('${m.id}')">
        <div class="tdm-card-top">
          <span class="tdm-card-icon">${m.icon}</span>
          ${sel ? '<span class="tdm-card-check">&#10003;</span>' : ''}
        </div>
        <div class="tdm-card-label">${m.label}</div>
        <div class="tdm-card-desc">${m.desc}</div>
      </div>`;
    }).join('');
  }

  function applyCustomPanelNames() {
    const proj = (document.getElementById('pname-custom-proj')?.value || '').trim() || 'Custom';
    const qdr  = (document.getElementById('pname-custom-qdr')?.value  || '').trim() || 'Custom';
    PANEL_NAMES.custom.proj = PANEL_NAMES.custom.proj_s = proj;
    PANEL_NAMES.custom.qdr  = PANEL_NAMES.custom.qdr_s  = qdr;
    localStorage.setItem('qe_panel_custom', JSON.stringify({ proj, qdr }));
    applyPanelNames('custom');
  }

  function renderPanelNamesGrid() {
    const grid = document.getElementById('panel-names-grid');
    if (!grid) return;
    grid.innerHTML = Object.values(PANEL_NAMES).map(set => {
      const sel = set.id === currentPanelNames;
      if (set.id === 'custom') {
        const cv = PANEL_NAMES.custom;
        const projVal = (cv.proj === 'Custom') ? '' : cv.proj;
        const qdrVal  = (cv.qdr  === 'Custom') ? '' : cv.qdr;
        return `<div class="pname-card custom-card${sel ? ' selected' : ''}">
          <div class="pname-custom-row">
            <span class="pname-custom-label">&#128193;</span>
            <input id="pname-custom-proj" class="pname-custom-input" type="text"
              placeholder="Ice" value="${projVal}"
              onclick="event.stopPropagation()"
              onkeydown="if(event.key==='Enter')applyCustomPanelNames()">
          </div>
          <div class="pname-custom-row">
            <span class="pname-custom-label">&#9889;</span>
            <input id="pname-custom-qdr" class="pname-custom-input" type="text"
              placeholder="Fire" value="${qdrVal}"
              onclick="event.stopPropagation()"
              onkeydown="if(event.key==='Enter')applyCustomPanelNames()">
          </div>
          <button class="pname-custom-set" onclick="applyCustomPanelNames()">Set</button>
          ${sel ? '<div class="pname-check" style="text-align:center">&#10003; Active</div>' : ''}
        </div>`;
      }
      return `<div class="pname-card${sel ? ' selected' : ''}" onclick="applyPanelNames('${set.id}')">
        <div class="pname-pair">
          <span class="pname-a">${set.proj}</span>
          <span class="pname-sep">&#10230;</span>
          <span class="pname-b">${set.qdr}</span>
        </div>
        ${sel ? '<div class="pname-check">&#10003;</div>' : ''}
      </div>`;
    }).join('');
  }

  let qdrTargetDays = 14;
  let colorVisionMode = 'standard';
  let currentTheme = 'default';
  let colorMode = 'light';

  const LIGHT_BASE = {
    '--bg':'#f3f4f8','--surface':'#ffffff','--surface2':'#e8ebf3','--border':'#c8cedc',
    '--text':'#0f172a','--muted':'#64748b',
    '--header-bg':'rgba(243,244,248,.94)','--tabbar-bg':'rgba(243,244,248,.90)'
  };
  const DARK_BASE = {
    '--bg':'#07080f','--surface':'#10121e','--surface2':'#181b2e','--border':'#252840',
    '--text':'#eef0ff','--muted':'#7b82a8',
    '--header-bg':'rgba(16,18,30,.85)','--tabbar-bg':'rgba(16,18,30,.70)'
  };

  function applyTheme(id) {
    const theme = THEMES[id];
    if (!theme) return;
    currentTheme = id;
    const root = document.documentElement;
    Object.entries(theme.vars).forEach(([k, v]) => root.style.setProperty(k, v));
    // overlay light/dark mode base vars
    Object.entries(colorMode === 'dark' ? DARK_BASE : LIGHT_BASE).forEach(([k, v]) => root.style.setProperty(k, v));
    localStorage.setItem('qe_theme', id);
    if (currentView === 'settings') renderColors();
  }

  function applyColorMode(mode) {
    colorMode = mode;
    localStorage.setItem('qe_color_mode', mode);
    const root = document.documentElement;
    Object.entries(mode === 'dark' ? DARK_BASE : LIGHT_BASE).forEach(([k, v]) => root.style.setProperty(k, v));
    if (currentView === 'settings') renderColors();
  }

  function loadColorMode() {
    colorMode = localStorage.getItem('qe_color_mode') || 'light';
  }

  function loadTheme() {
    const saved = localStorage.getItem('qe_theme') || 'default';
    const theme = THEMES[saved] || THEMES.default;
    currentTheme = saved in THEMES ? saved : 'default';
    const root = document.documentElement;
    Object.entries(theme.vars).forEach(([k, v]) => root.style.setProperty(k, v));
    Object.entries(colorMode === 'dark' ? DARK_BASE : LIGHT_BASE).forEach(([k, v]) => root.style.setProperty(k, v));
  }

  // ── Calendar settings ─────────────────────────────────
  function loadCalSettings() {
    calWeekStart    = parseInt(localStorage.getItem('qe_cal_week_start') ?? '1') || 0;
    calShowWeekNums = localStorage.getItem('qe_cal_week_nums') !== 'false';
    const wsCb = document.getElementById('cal-week-start');
    if (wsCb) wsCb.checked = calWeekStart === 1;
    const wnCb = document.getElementById('cal-show-weeknums');
    if (wnCb) wnCb.checked = calShowWeekNums;
  }

  function saveCalSettings() {
    const ws = document.getElementById('cal-week-start')?.checked ? 1 : 0;
    const wn = document.getElementById('cal-show-weeknums')?.checked !== false;
    calWeekStart    = ws;
    calShowWeekNums = wn;
    localStorage.setItem('qe_cal_week_start', ws);
    localStorage.setItem('qe_cal_week_nums',  wn);
    calMonths = []; // force full re-render
    if (currentView === 'calendar') renderCalendar();
  }

  // ── QDR Age Alert ──────────────────────────────────────
  function loadQdrTarget() {
    qdrTargetDays = Math.max(1, parseInt(localStorage.getItem('qe_qdr_target') || '14') || 14);
    const el = document.getElementById('qdr-target-days');
    if (el) el.value = qdrTargetDays;
    const label = panelLabel('qdr');
    const h = document.getElementById('qdr-alert-heading');
    if (h) h.textContent = t('age_alert_title', label);
    const sub = document.getElementById('qdr-alert-sub');
    if (sub) sub.textContent = t('age_alert_sub', label);
    const lbl = document.getElementById('qdr-alert-lbl');
    if (lbl) lbl.textContent = t('age_alert_lbl', label.toLowerCase());
  }

  function saveQdrTarget(val) {
    qdrTargetDays = Math.max(1, Math.min(999, parseInt(val) || 14));
    localStorage.setItem('qe_qdr_target', qdrTargetDays);
    renderPanel('qdr');
  }

  // ── Color Vision ───────────────────────────────────────
  const CV_MODES = [
    { id:'standard',     name:'Standard',            sub:'Default colors',               swatches:['#a855f7','#ec4899','#06b6d4','#84cc16'] },
    { id:'deuteranopia', name:'Blue-Orange',          sub:'Red-green color blindness',    swatches:['#3b82f6','#818cf8','#f97316','#fbbf24'] },
    { id:'tritanopia',   name:'Rose-Teal',            sub:'Blue-yellow color blindness',  swatches:['#e11d48','#fb923c','#0d9488','#34d399'] },
    { id:'high-contrast',name:'High Contrast',        sub:'Maximum luminance contrast',   swatches:['#f0abfc','#e879f9','#67e8f9','#22d3ee'] },
  ];

  function applyColorVision(id, { rerender = true } = {}) {
    colorVisionMode = id;
    localStorage.setItem('qe_color_vision', id);
    CV_MODES.forEach(m => document.body.classList.remove(`cv-${m.id}`));
    if (id !== 'standard') document.body.classList.add(`cv-${id}`);
    if (rerender) {
      renderAll();
      if (currentView === 'settings') renderColorVisionGrid();
    }
  }

  function loadColorVision() {
    const saved = localStorage.getItem('qe_color_vision') || 'standard';
    colorVisionMode = CV_MODES.some(m => m.id === saved) ? saved : 'standard';
    CV_MODES.forEach(m => document.body.classList.remove(`cv-${m.id}`));
    if (colorVisionMode !== 'standard') document.body.classList.add(`cv-${colorVisionMode}`);
  }

  function renderColorVisionGrid() {
    const grid = document.getElementById('cv-grid');
    if (!grid) return;
    grid.innerHTML = CV_MODES.map(m => {
      const sel = m.id === colorVisionMode;
      const dots = m.swatches.map(c => `<span class="cv-swatch" style="background:${c}"></span>`).join('');
      return `<div class="cv-card${sel ? ' selected' : ''}" onclick="applyColorVision('${m.id}')">
        <div class="cv-swatches">${dots}</div>
        <div class="cv-name">${t('cv_' + m.id.replace('-','_') + '_name')}</div>
        <div class="cv-sub">${t('cv_' + m.id.replace('-','_') + '_sub')}</div>
      </div>`;
    }).join('');
  }

  function renderColors() {
    document.getElementById('mode-opt-light')?.classList.toggle('active', colorMode === 'light');
    document.getElementById('mode-opt-dark')?.classList.toggle('active',  colorMode === 'dark');
    const grid = document.getElementById('theme-grid');
    const mb = colorMode === 'dark' ? DARK_BASE : LIGHT_BASE;
    grid.innerHTML = Object.entries(THEMES).map(([id, t]) => {
      const v = t.vars;
      const sel = id === currentTheme;
      return `<div class="theme-card${sel ? ' selected' : ''}" onclick="applyTheme('${id}')" style="background:${mb['--surface']};border-color:${mb['--border']}">
        <div class="theme-accent-bar" style="background:linear-gradient(90deg,${v['--proj-a']},${v['--proj-b']},${v['--qdr-a']},${v['--qdr-b']})"></div>
        <div class="theme-swatches">
          <span class="theme-swatch" style="background:${v['--proj-a']}"></span>
          <span class="theme-swatch" style="background:${v['--proj-b']}"></span>
          <span class="theme-swatch" style="background:${v['--qdr-a']}"></span>
          <span class="theme-swatch" style="background:${v['--qdr-b']}"></span>
        </div>
        <div class="theme-name-row">
          <span class="theme-name" style="color:${mb['--text']}">${t.name}</span>
          <span class="theme-check">&#10003;</span>
        </div>
      </div>`;
    }).join('');
  }

  // ── Data / Backup ─────────────────────────────────────
  function renderDataStats() {
    const totalTodos = p =>
      (data[p] ?? []).reduce((s, x) => s + (x.todos?.length ?? 0), 0);
    const doneTodos = p =>
      (data[p] ?? []).reduce((s, x) => s + (x.todos?.filter(t=>t.done).length ?? 0), 0);
    document.getElementById('data-stats').innerHTML = `
      <div class="data-stat">
        <span class="data-stat-val">${data.proj.length}</span>
        <span class="data-stat-lbl">${panelLabel('proj')}</span>
      </div>
      <div class="data-stat">
        <span class="data-stat-val">${data.qdr.length}</span>
        <span class="data-stat-lbl">${panelLabel('qdr')}</span>
      </div>
      <div class="data-stat">
        <span class="data-stat-val">${totalTodos('proj') + totalTodos('qdr')}</span>
        <span class="data-stat-lbl">${t('data_total')}</span>
      </div>
      <div class="data-stat">
        <span class="data-stat-val">${doneTodos('proj') + doneTodos('qdr')}</span>
        <span class="data-stat-lbl">${t('data_done')}</span>
      </div>`;
  }

  function exportData() {
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    const date = new Date().toISOString().split('T')[0];
    a.href     = url;
    a.download = `qe-organizer-backup-${date}.json`;
    a.click();
    URL.revokeObjectURL(url);
  }

  function importData(e) {
    const file = e.target.files?.[0];
    const fb   = document.getElementById('import-feedback');
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const parsed = JSON.parse(ev.target.result);
        if (!parsed.proj || !parsed.qdr) throw new Error('Invalid format');
        data = parsed;
        save();
        renderAll();
        renderDataStats();
        fb.textContent = t('data_ok');
        fb.className   = 'data-feedback ok';
      } catch {
        fb.textContent = t('data_err');
        fb.className   = 'data-feedback err';
      }
      e.target.value = '';
      setTimeout(() => { fb.className = 'data-feedback'; }, 4000);
    };
    reader.readAsText(file);
  }

  function exportHoliday() {
    const filterOpen = items => items
      .filter(item => !item.done)
      .map(item => ({ ...item, todos: (item.todos ?? []).filter(td => !td.done) }));
    const payload = { proj: filterOpen(data.proj), qdr: filterOpen(data.qdr) };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    const date = new Date().toISOString().split('T')[0];
    a.href     = url;
    a.download = `open-tasks-${date}.json`;
    a.click();
    URL.revokeObjectURL(url);
  }

  function importColleague(e) {
    const file     = e.target.files?.[0];
    const fb       = document.getElementById('colleague-feedback');
    const nameEl   = document.getElementById('colleague-name');
    const colleague = (nameEl?.value || '').trim();
    if (!file) return;
    if (!colleague) {
      fb.textContent = t('col_name_err');
      fb.className   = 'data-feedback err';
      e.target.value = '';
      setTimeout(() => { fb.className = 'data-feedback'; }, 4000);
      return;
    }
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const parsed = JSON.parse(ev.target.result);
        if (!parsed.proj || !parsed.qdr) throw new Error('Invalid format');
        const tag = item => ({
          ...item,
          id:    crypto.randomUUID(),
          name:  `${item.name} [${colleague}]`,
          todos: (item.todos ?? []).map(td => ({ ...td, id: crypto.randomUUID() }))
        });
        data.proj.push(...parsed.proj.map(tag));
        data.qdr.push(...parsed.qdr.map(tag));
        save();
        renderAll();
        renderDataStats();
        const count = parsed.proj.length + parsed.qdr.length;
        fb.textContent = count === 1 ? t('col_import_ok_1', colleague) : t('col_import_ok_n', count, colleague);
        fb.className   = 'data-feedback ok';
      } catch {
        fb.textContent = t('col_import_err');
        fb.className   = 'data-feedback err';
      }
      e.target.value = '';
      setTimeout(() => { fb.className = 'data-feedback'; }, 4000);
    };
    reader.readAsText(file);
  }

  // ── Fortune Cookie ────────────────────────────────────
  const FORTUNES = [
    "The universe is not holding you back. You are the universe. Go break something beautiful.",
    "Your potential is so vast the stars got nervous when you showed up.",
    "Today is the day you remember you forgot you were a legend.",
    "Somewhere, a mountain is waiting to be climbed by you. It is already nervous.",
    "You are made of the same stuff as galaxies. Stop apologizing for taking up space.",
    "A single spark of your enthusiasm could warm a city.",
    "Go forward. The universe has already cleared the path. You just cannot see it yet.",
    "Today someone will be glad you exist. Make sure it includes you.",
    "The flower does not wonder if it deserves to bloom. Neither should you.",
    "Your next chapter starts with the very next breath.",
    "Every single person who ever changed the world felt exactly like you feel right now.",
    "Be so outrageously yourself that the world has no choice but to pay attention.",
    "The trees are cheering for you. The trees always cheer for you.",
    "You have solved harder problems before breakfast than most people solve in a week.",
    "Act first. Doubt later. Actually, skip the doubt entirely.",
    "Your friends see in you what you have not discovered yet. Trust them.",
    "The universe conspires in your favor when you move with intention.",
    "You do not need permission. You never did.",
    "Excellence is just enthusiasm with good aim.",
    "The right moment is always now. It has always been now.",
    "Your energy is contagious. Infect everyone.",
    "Every sunrise is the universe offering you a fresh contract. Sign it.",
    "You are the protagonist. Act accordingly.",
    "Somewhere between impossible and inevitable, you will find your name written in light.",
    "Boldness has a magnetic field. Walk into it.",
    "The only thing fiercer than your ambition is your kindness.",
    "You are not behind. You are exactly on time for the life only you can live.",
    "When in doubt, add more love and reduce the hesitation.",
    "The cosmos bookmarked the page where you started believing in yourself.",
    "Do the thing that makes your eyes light up. That light is a compass.",
    "You bring something to the room that no one else can bring. Do not make the room wait.",
    "Impatience is just passion in a hurry. Feed it.",
    "One brave decision today ripples forward into ten courageous ones tomorrow.",
    "Your ideas are seeds. Plant them recklessly.",
    "The universe does not do refunds on unlived moments.",
    "Move. The stars literally realign when you do.",
    "Friendship is the original superpower. Use it freely.",
    "You were forged in the exact conditions needed to build something extraordinary.",
    "Leap. The net has been there the whole time, knitting itself just for you.",
    "The vibration of your joy rewrites the air around you.",
    "Today's small act of courage is tomorrow's favorite story.",
    "Be patient with yourself — but not too patient. The world needs you now.",
    "Your dreams do not have an expiration date, but why keep them waiting?",
    "Walk like someone who knows their destination is magnificent.",
    "The universe will match your energy. So put out ridiculous amounts of good energy.",
    "You are exactly the right person at exactly the right time. Stop waiting for proof.",
    "Magic does not happen to you. It happens because of you.",
    "Every mountain you have ever climbed made the next one smaller.",
    "Your presence is a gift that keeps giving long after you leave the room.",
    "Chase the vision, not the approval.",
    "The world is better with you being unapologetically you.",
    "You are the revolution you have been waiting for.",
    "Let your passion run so loud that doubt cannot hear itself think.",
    "The seeds you plant with love grow into forests of possibilities.",
    "You have been brave every single day without even knowing it.",
    "The most powerful thing you can do today is believe in yourself shamelessly.",
    "There is a version of your future self doing a happy dance right now. Join them.",
    "Go. Now. The perfect timing is a myth invented by fear.",
    "You do not find your purpose. You build it, one passionate day at a time.",
    "The universe gave you curiosity. That alone is a superpower.",
    "Your laugh is someone's favorite sound. Deploy it often.",
    "Abundance is not something you wait for. It is something you radiate.",
    "Every expert was once a wild-eyed beginner. Love that part of yourself.",
    "Act with the confidence of someone who has already succeeded.",
    "The greatest story ever told has not been written yet. You are writing it now.",
    "Your kindness is not weakness. It is your most fearsome strength.",
    "Great things are done by those who refuse to wait until they feel ready.",
    "You are the answer to a question the universe has been pondering.",
    "The only limit that matters is the one you stop believing in.",
    "Something beautiful is already in motion because of you.",
    "Enthusiasm is the original renewable energy. You have reserves for centuries.",
    "Today, pick the brave option. Just to see what happens.",
    "Your soul came here with specific missions. Get moving.",
    "Everything is working out even when it looks like chaos.",
    "You are allowed to be brilliant. You are not allowed to pretend otherwise.",
    "The joy you choose today becomes the foundation of tomorrow.",
    "You are a garden that grows in all directions. Let it.",
    "Whatever you are building, it matters. Do not stop.",
    "Your heart knows the address. Trust its navigation.",
    "Inspiration knocked. You answered. Never stop answering.",
    "Act like the miracle you actually are.",
    "The light at the end of the tunnel is you, arriving.",
    "Dreams do not come true. They come alive. Breathe into yours.",
    "You are the plot twist that makes the story worth reading.",
    "Do it badly, do it boldly, do it now.",
    "Your effort today is someone's miracle tomorrow.",
    "The universe does not make mistakes. You are not a mistake.",
    "Bloom where you are planted, but also run toward the sun.",
    "The person you are becoming is worth every uncomfortable moment.",
    "Hope is not passive. It is a hammer. Use it.",
    "The only thing standing between you and extraordinary is the first step.",
    "Go be so good they cannot ignore you.",
    "You have permission to want great things and to chase them without apology.",
    "Every single breath is an invitation to begin again.",
    "The best version of you is not arriving. It is already here and already moving.",
    "You are the type of person who makes things happen. Go happen.",
    "Love your people loud and your work harder.",
    "The universe is 13.8 billion years old and it made you now, on purpose.",
    "Somewhere a flower decided to grow through concrete. Be that flower.",
    "Mercury is not in retrograde. Your courage is in direct.",
    "Drink water. Move your body. Change the world. In that order.",
    "You are a limited edition in a world full of copies.",
    "The ancestors are proud. The descendants will be inspired.",
    "Three things will get you anywhere: fire, friendship, and audacity.",
    "The moon has been tracking your progress. She is impressed.",
    "If the universe had a highlight reel, you would be in it.",
    "Stop shrinking yourself to fit into spaces designed for smaller dreams.",
    "The caterpillar did not know it was becoming a butterfly. Neither do you yet.",
    "Your vibe is a broadcast. Make it worth tuning in to.",
    "The stars once conspired to place exactly these ingredients inside you. Trust the recipe.",
    "Do things that make you feel alive and then do them again.",
    "You were never meant to be lukewarm. Be scalding hot.",
    "There are worlds inside you that have not been explored yet. Grab a torch.",
    "Your next breakthrough is disguised as your current challenge.",
    "The wind is at your back even when you cannot feel it.",
    "You carry the energy of ten thousand sunrises. Share them liberally.",
    "The trees know your name and they are rooting for you — literally.",
    "Nothing about you is ordinary. Not even your ordinary days.",
    "You are so much closer than you think.",
    "The road you fear is the one that leads somewhere worth going.",
    "Today is not a rehearsal. But it is also not a final exam.",
    "Your passion is the universe's favorite language. Speak it fluently.",
    "The very cells in your body want you to succeed.",
    "Whoever told you to calm down was just afraid of your power.",
    "You are ancient stardust with Wi-Fi and a dream. Use all three.",
    "The person you are becoming would be amazed by what you are doing right now.",
    "Your enthusiasm is not annoying. It is contagious and necessary.",
    "Be the energy you wish to see in the meeting.",
    "The universe keeps receipts of every brave thing you have done.",
    "You are the hero of this story. Heroes do not wait for a better chapter.",
    "Love deeply. Work boldly. Rest without guilt. Repeat.",
    "Your future self sent a message: Keep going. It gets spectacular.",
    "Every single good choice you make sends a ripple into eternity.",
    "You were not born to be comfortable. You were born to be alive.",
    "Surround yourself with people who cheer for you before the victory.",
    "You do not need all the answers. You only need the next brave question.",
    "The universe rewards action. Sometimes immediately. Always eventually.",
    "Your weirdness is your rarest and most valuable asset.",
    "Today a tiny courageous act is worth more than a month of perfect planning.",
    "Be so focused on building your own path that you forget to compare it to others.",
    "The fire in your chest is not anxiety. It is your destiny warming up.",
    "Even the planet loves you. It literally holds you up every single day.",
    "Your smile is doing more work than you realize.",
    "You are magnetic. Things are already moving toward you.",
    "Start before you are ready. Finish before you are tired.",
    "Everything great started in someone's mind as a totally ridiculous idea.",
    "Your friends are your superpowers. Activate them.",
    "The universe does not send challenges to people who cannot handle them.",
    "You are not lost. You are in the middle of a magnificent detour.",
    "Your light does not dim others. It shows them where the switch is.",
    "This is the moment. Not the one after. This one.",
    "You are a walking, breathing, laughing argument for the beauty of existence.",
    "Sometimes the universe whispers. Sometimes it shouts through your own heartbeat.",
    "You were made for moments exactly like this one.",
    "The power of your intention is underestimated by everyone except the universe.",
    "Your joy is an act of resistance and revolution. Feel it fully.",
    "Every idea you act on makes ten more possible.",
    "Keep going. Momentum is secretly on your side.",
    "There is a place in the future that only you can fill. Hurry.",
    "The world is waiting for you to stop preparing and start doing.",
    "You have the audacity of someone who does not know the odds. Keep that.",
    "Your spirit animal is whatever animal runs the fastest toward its dreams.",
    "Let the doubters doubt while you do the thing.",
    "The more you invest in others, the richer you become in ways money does not count.",
    "You are a force of nature in a very polite disguise.",
    "Today you will surprise yourself. Let yourself be surprised.",
    "Go at full speed. You can always slow down after the breakthrough.",
    "Your potential is not behind you. It is running ahead of you, waving.",
    "Be grateful. Then be greedy for more beautiful experiences.",
    "The universe is not subtle about how much it needs you here.",
    "Act now. Course-correct later. That is the actual formula.",
    "You belong at the table. Pull up a chair. Pull up two.",
    "You are not the sum of your fears. You are the product of your courage.",
    "The right people are already on their way to you.",
    "Your discipline today is your freedom tomorrow. And also probably today.",
    "Be the kind of friend you would cross oceans for.",
    "The universe cannot want it for you more than you want it for yourself.",
    "There are exactly zero problems that your belief in yourself cannot help solve.",
    "Even the sun shows up every day without being asked. Be solar.",
    "Do not water yourself down to quench someone else's thirst.",
    "The music of your life is being composed right now. Make it loud.",
    "Wildly alive is the only setting you were meant to run on.",
    "Your next yes will open five doors you did not know existed.",
    "Do not go gently into that good mediocrity.",
    "Something extraordinary is looking for someone exactly like you.",
    "You are the reason the word unstoppable was invented.",
    "Walk like the universe owes you the good stuff. Because it does.",
    "Today is the day you stop waiting for yourself to show up.",
    "The bridge between where you are and where you dream of being is called today.",
    "You cannot be replaced. Not even with a better version.",
    "Every sunrise is the universe saying: fresh start, no extra charge.",
    "Your ambition and your kindness can coexist. Let them.",
    "Sometimes the most rebellious thing you can do is be joyful.",
    "The cosmos rearranges itself for the focused and the brave.",
    "You radiate something. Make sure it is what you want to radiate.",
    "Go make something. Anything. The universe responds to creation.",
    "The size of your dreams is the size of your gratitude for being alive.",
    "Nothing is more powerful than a mind that has finally made up its own mind.",
    "Your curiosity is a ladder that only grows taller the higher you climb.",
    "The most important relationship you have is the one with your own potential.",
    "You are the kind of person that makes other people want to be better. Own that.",
    "Urgency and joy are not opposites. Pursue things urgently and joyfully.",
    "The world is full of people waiting for permission. Do not wait.",
    "You are not in competition with anyone. The universe is infinitely large.",
    "Your next idea might be the one that changes everything. Have it.",
    "Be so thoroughly and completely yourself that comparison becomes irrelevant.",
    "The cost of staying where you are is higher than the cost of moving forward.",
    "Your ancestors survived things that would end most stories. You carry that.",
    "Be the lighthouse. Someone is navigating by your light right now.",
    "Gravity works against everyone. You move anyway. That is heroic.",
    "Your progress is not linear. That is what makes it interesting.",
    "Put your whole self into it. Half measures leave you half satisfied.",
    "The moment you decide is the moment everything starts shifting.",
    "You have more allies in this universe than you know.",
    "Wake up like you have a meeting with greatness. Because you do.",
    "Optimism is not ignorance of difficulty. It is defiance of it.",
    "The truest thing about you is that you are capable of more than you have shown yet.",
    "If not you, then who? If not now, then when? You know the answers.",
    "You are someone's proof that it is possible.",
    "Every kind act you do is a seed in a garden you will never fully see.",
    "Think big. Plan bigger. Execute biggest. Rest. Repeat.",
    "You were never supposed to fit in. You were designed to stand out.",
    "The next chapter cannot begin until you turn this page.",
    "Your presence changes the temperature of a room. Be conscious of that power.",
    "There is light in you that the darkness has been trying to negotiate with for years. Do not negotiate.",
    "Friendship is the most ancient technology for surviving the universe.",
    "You are made of resilience wearing a human costume.",
    "The dream is possible. The path exists. The timing is now.",
    "Your goals are not too big. The doubt is too small.",
    "Do good. Feel good. Pass it on.",
    "You are the universe's most ambitious project. Live up to it.",
    "Be relentless in your pursuit of the things that make you feel most alive.",
    "Not all who wander are lost. Some are just taking the scenic route to greatness.",
    "Your capacity for love is matched only by your capacity for greatness.",
    "The energy you bring changes the trajectory of the day. Choose it intentionally.",
    "You are not waiting for the right moment. You are creating it.",
    "The beautiful thing about momentum is that it feeds itself.",
    "Your best days are not behind you. They are queued up, waiting.",
    "Be unapologetically enthusiastic. The world needs more of it.",
    "You have something to offer that no one else can. The world needs it now.",
    "The universe invented joy specifically with you in mind.",
    "Start small. Build fast. Dream always.",
    "You carry stories inside you that need to be lived out loud.",
    "The biggest risk is playing it safe when you have a fire inside you.",
    "Go further. Beyond good enough lives extraordinary.",
    "Your life is your message to the world. Make sure it is inspiring.",
    "The people who love you are your most renewable resource.",
    "You were born at the perfect time to do exactly what you are meant to do.",
    "Courage is just stubbornness aimed at something noble.",
    "The universe takes notes when you decide to believe in yourself.",
    "Your light does not need a reason. It just needs permission.",
    "Start now. Improve forever.",
    "You are the sunrise that people did not know they were waiting for.",
    "The beautiful mess you are is somebody's definition of perfect.",
    "Act with the certainty of a river moving toward the sea.",
    "Your friendship is one of the most generous things you offer the world.",
    "Keep showing up. The universe keeps score.",
    "You are allowed to be both a work in progress and a masterpiece simultaneously.",
    "The fire does not ask if it is ready to warm you. It just does.",
    "Today is a perfect day to do the thing you have been almost doing.",
    "Your story is still being written. Do not let fear be the ghostwriter.",
    "You are the living evidence that human beings can be extraordinary.",
    "Go ahead and dream about it. Then go and do it. Then dream bigger.",
    "The world is a better place because you move through it with intention.",
    "You have the exact amount of time you need to do the things that truly matter.",
    "More love. More boldness. More now.",
    "The universe respects urgency combined with gratitude. Be both.",
    "You are not a finished product. You are a perpetual becoming.",
    "Your kindness is structural. It holds things together.",
    "Do the scary thing. Then tell your friends about it over something warm to drink.",
    "The best investment you will ever make is in the belief that you are worth investing in.",
    "You were not built for average. Average was not in the blueprints.",
    "Go full speed toward what sets your soul on fire.",
    "Every single person who believes in you is correct.",
    "Your imagination is a portal. Walk through it as often as possible.",
    "The vibration of gratitude is the fastest vehicle to everything you want.",
    "You are someone's answered prayer. Live like it.",
    "The obstacle in your path is not a stop sign. It is a detour to something better.",
    "Be gentle with beginnings. Everything spectacular was once terrifyingly new.",
    "You are the lighthouse and the sailor and the shore.",
    "There is magic in your ordinary. Especially your ordinary.",
    "The most radical thing you can do is believe in yourself without evidence.",
    "Your ambitions are not arrogance. They are architecture.",
    "Everything you have been through has been teaching you how to do this.",
    "The universe is not tired of your attempts. Keep attempting.",
    "Go be magnificent. It is the only appropriate response to being alive.",
    "You are a one-time occurrence in the history of the universe. Act accordingly.",
    "The bridge you need is the one you build while you walk.",
    "Your ability to start over is one of your greatest superpowers.",
    "Be wildly grateful. Then wildly active. In that sequence.",
    "The things worth doing are worth doing before you feel completely ready.",
    "You are a song in the key of possible.",
    "Today's effort is tomorrow's evidence.",
    "Live with so much enthusiasm that cynicism gives up and goes home.",
    "Your greatness is not an opinion. It is a fact awaiting demonstration.",
    "You are the plot twist that gives the story meaning.",
    "Go hard. Rest well. Rise again. That is the whole philosophy.",
    "The universe spent 13.8 billion years preparing the conditions for you to exist. Do not waste it being small.",
    "Your dreams are the universe asking you a question. Answer loudly.",
    "There is no version of your full potential that is not astounding.",
    "Act like you have already been chosen. Because you have.",
    "The river does not ask the ocean if it is worthy. It just flows.",
    "You are electrically, magnetically, cosmically here on purpose.",
    "Be the kind of person who makes other people feel like they can fly.",
    "Today's chaos is tomorrow's favorite chapter.",
    "You are not a supporting character in someone else's story. You are the main event.",
    "The distance between your dream and reality is spelled A-C-T-I-O-N.",
    "You have survived every hard day so far. Your record is perfect.",
    "The best thing you can do for the world is become the fullest version of yourself.",
    "Your enthusiasm is not extra. It is essential.",
    "Let today be so good that yesterday gets jealous.",
    "The universe does not recycle dreams. Each one is yours exclusively.",
    "You do not have to see the whole staircase. Step anyway.",
    "Your past is a launchpad, not a landing strip.",
    "Be so full of light that shadows cannot find a foothold.",
    "Friendship multiplies joy and divides sorrow. Invest heavily.",
    "You are the most important project you will ever work on.",
    "The voice that says you cannot is the one worth ignoring most passionately.",
    "You have arrived precisely on time for your own transformation.",
    "Do not dim for spaces that were not built for your brightness.",
    "Every single day that you try is a day the universe applauds.",
    "You are the kind of person the world was always going to need.",
    "Your tomorrow is being shaped by how you show up today.",
    "It is all working out. It really, truly is.",
    "The only people who never fail are the ones who never try hard enough.",
    "Be stubbornly, fiercely, absurdly hopeful.",
    "Your story is not over. In fact, it is just getting to the good part.",
    "You are not too much. You are exactly enough and more.",
    "The mountain sees you coming and it is already preparing to be climbed.",
    "You deserve every beautiful thing that is heading your way.",
    "Run toward the thing that scares you. It has been waiting for you specifically.",
    "Your frequency is changing the universe. Turn it up.",
    "Be aggressively, offensively, gloriously positive.",
    "The best time to start was yesterday. The second best time has been now for quite some time.",
    "You are a rare configuration of atoms that has never existed before and never will again. Maximize the experience.",
    "Everything is figure-outable. Especially by you.",
    "The universe is not testing you. It is training you.",
    "Your compassion is as powerful as your ambition. Use both.",
    "Today, love people so hard it confuses them.",
    "You are not waiting to be discovered. You are in the process of discovery.",
    "The world bends slightly toward determined people. Stay determined.",
    "You are the reason the word possible exists.",
    "Climb. Fall. Climb again, but higher. That is the whole game.",
    "Your wildest dream is shy compared to what the universe has planned.",
    "Be here, fully. The present moment is where all the good stuff happens.",
    "You have been underestimating yourself since the very beginning. Stop.",
    "The joy you feel is the universe giving you a high-five.",
    "You are not just a drop in the ocean. You are the entire ocean in a drop.",
    "Chase your dreams with the energy of someone who just had cosmic coffee.",
    "The universe wrote your name in the stars before you were born. Look up.",
    "Be outrageously kind in a world that rations it.",
    "You are the thunder that wakes people up and the warmth that keeps them going.",
    "The thing you have been putting off is the thing that will change everything.",
    "Your heart is wiser than your fear. Follow your heart.",
    "You were not built to stand still. Your bones are made of motion.",
    "The greatest act of self-love is believing you deserve to succeed.",
    "Go love someone with everything you have. Then come back and work harder.",
    "You are the manifestation of possibility itself.",
    "Your joy is an investment in the collective happiness of humanity.",
    "The universe does not have a backup plan for you because you do not need one.",
    "Be the first to believe in someone today. Including yourself.",
    "There are adventures waiting for you that do not even have names yet.",
    "You are permanently enrolled in the school of becoming extraordinary.",
    "The world was already better the moment you decided to try.",
    "Your courage is a seed that grows backward in time, making your past braver.",
    "Do things that matter with people who matter in places that matter.",
    "You are not a crisis. You are a catalyst.",
    "The universe has a crush on your potential.",
    "Be relentless in your gentleness. It takes more strength than aggression.",
    "Today is a day for big swings and open hearts.",
    "You are not searching for meaning. You are creating it.",
    "The same energy that powers the stars powers your ambitions. Channel it.",
    "Your life force is contagious. Spread it recklessly.",
    "There is glory in the attempt. Attempt gloriously.",
    "You are the answer, not the question.",
    "The universe is whispering something important to you right now. Be quiet enough to hear it.",
    "Be so alive that being around you feels like a spiritual experience.",
    "You carry wisdom from every version of yourself you have ever been.",
    "The sky is not the limit. The sky is just where you are passing through on the way up.",
    "Your love for what you do is your most reliable compass.",
    "Start again. As many times as it takes. The universe never deducts points for trying.",
    "You are a living proof that hope is a rational strategy.",
    "The bravest thing you can do is continue being exactly and fully yourself.",
    "Go make the universe proud today.",
    "You are the type of human the cosmos bragged about to other galaxies.",
    "Your next step is more important than your entire plan.",
    "Be so present that the past feels irrelevant and the future feels inevitable.",
    "You are not running out of time. You are running into your destiny.",
    "The people who love you are your greatest work of art.",
    "Act. Learn. Improve. Celebrate. Repeat until legendary.",
    "Your belief in others is one of the most generous gifts you give.",
    "The universe applauds action. Even imperfect, messy, terrified action.",
    "You are the spark. Everything else is just kindling.",
    "Live so fully that tomorrow is envious of today.",
    "You are the miracle you have been waiting for.",
    "The best is not yet to come. It is also right now. Enjoy both.",
    "You showed up today. That alone is everything."
  ];

  function renderFortune() {
    const wrap = document.getElementById('fortune-wrap');
    if (!wrap) return;
    const today  = new Date().toISOString().split('T')[0];
    const stored = JSON.parse(localStorage.getItem('qe_fortune') || 'null');
    if (stored && stored.date === today) {
      wrap.innerHTML = `
        <button class="fortune-cookie-btn" disabled title="${t('fortune_tmrw')}">&#127850;</button>
        <div class="fortune-msg-card">
          <div class="fortune-msg-text">
            <span class="fortune-open-quote">\u201C</span>${esc(stored.msg)}<span class="fortune-close-quote">\u201D</span>
          </div>
        </div>
        <div class="fortune-tomorrow">${t('fortune_tmrw')}</div>`;
    } else {
      wrap.innerHTML = `
        <button class="fortune-cookie-btn" onclick="clickFortune()" title="${t('fortune_hint')}">&#127850;</button>
        <div class="fortune-hint">${t('fortune_hint')}</div>`;
    }
  }

  function clickFortune() {
    const today  = new Date().toISOString().split('T')[0];
    const stored = JSON.parse(localStorage.getItem('qe_fortune') || 'null');
    if (stored && stored.date === today) return;
    const msg = FORTUNES[Math.floor(Math.random() * FORTUNES.length)];
    localStorage.setItem('qe_fortune', JSON.stringify({ date: today, msg }));
    renderFortune();
  }

  // ── Achievements ─────────────────────────────────────
  function renderAchievements() {
    const statsEl  = document.getElementById('ach-stats');
    const timeline = document.getElementById('ach-timeline');
    if (!statsEl || !timeline) return;

    const locale = LANG_LOCALE[currentLang] ?? 'en-US';

    // Collect closed items
    const allDoneItems = [];
    ['proj', 'qdr'].forEach(panel => {
      (data[panel] || []).filter(i => i.done && i.closedAt).forEach(i => {
        allDoneItems.push({ ...i, _panel: panel });
      });
    });
    const totalAll = ['proj', 'qdr'].reduce((s, p) => s + (data[p] || []).filter(i => i.done).length, 0);

    // Collect completed todos (with doneAt)
    const allDoneTodos = [];
    ['proj', 'qdr'].forEach(panel => {
      (data[panel] || []).forEach(item => {
        (item.todos || []).filter(td => td.done && td.doneAt).forEach(td => {
          allDoneTodos.push({ ...td, _itemName: item.name, _panel: panel, _itemId: item.id });
        });
      });
    });

    // Group items by date
    const itemsByDate = {};
    allDoneItems.forEach(i => {
      const d = i.closedAt.split('T')[0];
      if (!itemsByDate[d]) itemsByDate[d] = [];
      itemsByDate[d].push(i);
    });

    // Group todos by date
    const todosByDate = {};
    allDoneTodos.forEach(td => {
      const d = td.doneAt.split('T')[0];
      if (!todosByDate[d]) todosByDate[d] = [];
      todosByDate[d].push(td);
    });

    // Collect all active dates (items or todos)
    const allActiveDates = new Set([...Object.keys(itemsByDate), ...Object.keys(todosByDate)]);

    // Streak: consecutive workdays (Mon–Fri) ending from today
    // Weekends are transparent — a missed weekend never breaks the streak
    let streak = 0;
    const cur = new Date();
    while (true) {
      const ds  = cur.toISOString().split('T')[0];
      const dow = cur.getDay(); // 0=Sun, 6=Sat
      if (dow === 0 || dow === 6) {
        cur.setDate(cur.getDate() - 1); // skip weekend, keep going
        continue;
      }
      if (allActiveDates.has(ds)) { streak++; cur.setDate(cur.getDate() - 1); }
      else break;
    }

    statsEl.innerHTML = `
      <div class="ach-stat-card ach-stat-streak">
        <div class="ach-stat-icon">🔥</div>
        <div class="ach-stat-num">${streak}</div>
        <div class="ach-stat-label">${t('ach_streak_label')}</div>
      </div>
      <div class="ach-stat-card ach-stat-total">
        <div class="ach-stat-icon">🏆</div>
        <div class="ach-stat-num">${totalAll}</div>
        <div class="ach-stat-label">${t('ach_total_label')}</div>
      </div>`;

    if (allActiveDates.size === 0) {
      timeline.innerHTML = `
        <div class="ach-empty">
          <div class="ach-empty-icon">🌱</div>
          <div class="ach-empty-title">${t('ach_empty_title')}</div>
          <div class="ach-empty-sub">${t('ach_empty_sub')}</div>
        </div>`;
      return;
    }

    const sortedDates = [...allActiveDates].sort((a, b) => b.localeCompare(a));
    const today     = new Date().toISOString().split('T')[0];
    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

    timeline.innerHTML = sortedDates.map(d => {
      const items     = itemsByDate[d]  || [];
      const doneTodos = todosByDate[d]  || [];
      let dateLabel;
      if (d === today)          dateLabel = t('ach_today');
      else if (d === yesterday) dateLabel = t('ach_yesterday');
      else dateLabel = new Date(d + 'T00:00:00').toLocaleDateString(locale, { weekday: 'long', month: 'long', day: 'numeric' });

      const itemsHtml = items.map(item => {
        const closedTime = new Date(item.closedAt).toLocaleTimeString(locale, { hour: '2-digit', minute: '2-digit' });
        const todosDone  = (item.todos || []).filter(td => td.done).length;
        const todosTotal = (item.todos || []).length;
        return `<div class="ach-item ach-item--${item._panel}">
          <div class="ach-item-check">✓</div>
          <div class="ach-item-body">
            <div class="ach-item-name">${esc(item.name)}</div>
            <div class="ach-item-meta">
              <span class="ach-panel-badge ach-panel--${item._panel}">${esc(panelLabel(item._panel))}</span>
              ${todosTotal > 0 ? `<span class="ach-todo-stat">${todosDone}/${todosTotal} to-dos</span>` : ''}
            </div>
          </div>
          <div class="ach-item-time">${closedTime}</div>
        </div>`;
      }).join('');

      const todosHtml = doneTodos.length > 0 ? `
        <div class="ach-todos-section">
          <div class="ach-todos-header">
            <span class="ach-todos-label">${t('ach_todos_done')}</span>
            <span class="ach-todos-count">${doneTodos.length}</span>
          </div>
          ${doneTodos.map(td => `
            <div class="ach-todo-row">
              <span class="ach-todo-chk">✓</span>
              <span class="ach-todo-txt">${esc(td.text)}</span>
              <span class="ach-todo-from">${esc(td._itemName)}</span>
            </div>`).join('')}
        </div>` : '';

      return `<div class="ach-day">
        <div class="ach-day-header">
          <span class="ach-day-label">${dateLabel}</span>
          <span class="ach-day-sep"></span>
          <span class="ach-day-badge">${t('ach_n_done', items.length)}</span>
        </div>
        <div class="ach-day-items">${itemsHtml}</div>
        ${todosHtml}
      </div>`;
    }).join('');
  }

  // ── Open Todos ────────────────────────────────────────
  function renderOpenTodos() {
    const container = document.getElementById('ot-list');
    const statsEl   = document.getElementById('ot-stats');
    if (!container || !statsEl) return;

    const today = new Date().toISOString().split('T')[0];
    const locale = LANG_LOCALE[currentLang] ?? 'en-US';
    const groups = [];
    ['proj', 'qdr'].forEach(panel => {
      (data[panel] || []).filter(i => !i.done).forEach(item => {
        const open = (item.todos || []).filter(td => !td.done);
        if (open.length) groups.push({ item, panel, todos: open });
      });
    });

    // Sort: overdue cards first, then priority, then most todos
    groups.sort((a, b) => {
      const aOver = a.todos.some(td => td.dueDate && td.dueDate < today);
      const bOver = b.todos.some(td => td.dueDate && td.dueDate < today);
      if (aOver !== bOver) return aOver ? -1 : 1;
      if (a.item.priority !== b.item.priority) return a.item.priority ? -1 : 1;
      return b.todos.length - a.todos.length;
    });

    const total         = groups.reduce((s, g) => s + g.todos.length, 0);
    const overdueCount  = groups.reduce((s, g) => s + g.todos.filter(td => td.dueDate && td.dueDate < today).length, 0);

    statsEl.innerHTML = `
      <div class="ot-stat">
        <span class="ot-stat-num">${total}</span>
        <span class="ot-stat-lbl">${t('tab_open_todos')}</span>
      </div>
      ${overdueCount > 0 ? `<div class="ot-stat ot-stat--overdue"><span class="ot-stat-num">${overdueCount}</span><span class="ot-stat-lbl">${t('ot_overdue')}</span></div>` : ''}`;

    if (total === 0) {
      container.innerHTML = `
        <div class="ot-empty">
          <div class="ot-empty-icon">🎉</div>
          <div class="ot-empty-title">${t('ot_empty_title')}</div>
          <div class="ot-empty-sub">${t('ot_empty_sub')}</div>
        </div>`;
      return;
    }

    container.innerHTML = groups.map(({ item, panel, todos }) => `
      <div class="ot-group">
        <div class="ot-group-header ot-group-header--${panel}">
          <span class="ot-panel-badge ot-panel--${panel}">${esc(panelLabel(panel))}</span>
          <span class="ot-item-name">${esc(item.name)}</span>
          <span class="ot-count-badge">${todos.length}</span>
          <button class="ot-goto-btn" onclick="goToItem('${panel}','${item.id}')">→ Go</button>
        </div>
        <div class="ot-todos">
          ${todos.map(td => {
            let dateClass = '', dateStr = '';
            if (td.dueDate) {
              if      (td.dueDate < today)       { dateClass = 'overdue';   dateStr = t('ot_overdue'); }
              else if (td.dueDate === today)      { dateClass = 'due-today'; dateStr = t('ot_due_today'); }
              else dateStr = new Date(td.dueDate + 'T00:00:00').toLocaleDateString(locale, { month: 'short', day: 'numeric' });
            }
            return `<div class="ot-todo-row">
              <span class="ot-todo-dot"></span>
              <span class="ot-todo-text">${esc(td.text)}</span>
              ${td.dueDate ? `<span class="ot-todo-date ${dateClass}">${dateStr}</span>` : ''}
              ${td.link    ? `<a class="ot-todo-link" href="${esc(td.link)}" target="_blank" rel="noopener noreferrer">↗</a>` : ''}
            </div>`;
          }).join('')}
        </div>
      </div>`).join('');
  }

  let _appStarted = false;
  function startApp() {
    if (_appStarted) return;
    _appStarted = true;

    load();
    loadLang();
    loadColorMode();
    loadTheme();
    loadPanelNames();
    loadTodoDisplay();
    loadColorVision();
    loadQdrTarget();
    loadCalSettings();
    updateStaticStrings();
    renderAll();
    _updateSyncIndicator(firebaseReady ? 'synced' : 'offline');

    // If Firebase is fresh (no data yet), push local data up
    if (firebaseReady && dbRef) {
      dbRef.once('value').then(snap => {
        if (!snap.val() && (data.proj.length || data.qdr.length)) {
          dbRef.set(data);
        }
      });
    }
  }
</script>
</body>
</html>
